(function(){var e={3962:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_METHOD_RECV_DISCONNECT=t.CONNECT_METHOD_DISCONNECT=t.CONNECT_METHOD_BATCH_FETCHMSG=t.CONNECT_METHOD_FETCHMSG=t.CONNECT_METHOD_RECEIVE=t.CONNECT_METHOD_UNSUB=t.CONNECT_METHOD_SUB=t.CONNECT_METHOD_PUBLISH=t.CONNECT_METHOD_LOGIN=t.CONNECT_METHOD_PUSH=void 0,t.CONNECT_METHOD_PUSH="push",t.CONNECT_METHOD_LOGIN="login",t.CONNECT_METHOD_PUBLISH="publish",t.CONNECT_METHOD_SUB="subscribe",t.CONNECT_METHOD_UNSUB="unsubscribe",t.CONNECT_METHOD_RECEIVE="receive",t.CONNECT_METHOD_FETCHMSG="fetchMessages",t.CONNECT_METHOD_BATCH_FETCHMSG="batchFetchMessages",t.CONNECT_METHOD_DISCONNECT="disconnect",t.CONNECT_METHOD_RECV_DISCONNECT="receiveDisconnect"},2516:function(e,t,n){"use strict";n(4603),n(7566),n(8721);var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&o(n,t,r[s]);return i(n,t),n}}(),s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXWalletConnector=void 0;const c=n(9795),a=n(4942),l=n(8391),d=n(2581),u=n(8384),g=n(49),h=r(n(9323)),p=n(852),f=n(9467),O=(0,u.resolveWebSocketImplementation)();class v{constructor(e){if(this.events=new g.EventEmitter,this.state=c.ConnectorState.InitState,this.selectedUrlIndex=0,this.retryCount=0,this.timeOutLimit=8e3,!(0,u.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,this.heartbeatTimer=null,this.connectionTimeoutTimer=null,this.connectURLStorage=new l.Storage(a.OKXCONNECTOR_CACHE_KEY+a.OKXCONNECTOR_CACHE_KEY)}get connecting(){return this.state==c.ConnectorState.Connecting}onPayload(e){if("undefined"!==typeof e.data){if(h.logDebug("get received data"),h.logDebug(e),"string"===typeof e.data){let t=e.data;if("pong"===t)return void h.logDebug(`CONNECT: receive pong ${Date.now().toString()}`)}this.events.emit("payload",e.data)}}onClose(e){var t;h.logDebug("socket get closed: ",null===(t=this.socket)||void 0===t?void 0:t.url,e.code),this.socket=void 0,this.events.emit("close",e)}onError(e,t){const n={id:e,msg:t.toString()};this.events.emit("payload",n)}onopen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.state=c.ConnectorState.Connected,this.events.emit("open")}emitError(e){this.events.emit("fail",e)}heartbeat(){return s(this,void 0,void 0,(function*(){if(this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.state==c.ConnectorState.Connected||this.state==c.ConnectorState.OnError){if(this.socket){if(this.socket.readyState===WebSocket.OPEN)h.logDebug(`send ping heart beat: ${Date.now().toString()}, ${this.socket}`),this.socket.send("ping"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3);else if(h.logDebug("socket not ready"),this.state==c.ConnectorState.Connected||this.state==c.ConnectorState.OnError){h.logDebug("socket reconnect by heartbeat with state",this.state,this.socket.readyState);try{yield this.tryRegistOpen()}catch(e){h.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}}else if(h.logDebug("socket not exist"),this.state==c.ConnectorState.Connected||this.state==c.ConnectorState.OnError){h.logDebug("socket reconnect by heartbeat");try{yield this.tryRegistOpen()}catch(e){h.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}}else h.logDebug("heart beat close")}))}registOpen(e=this.url,t=!1){if(!(0,u.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,t||h.logDebug("Connection connect:",this.url,(new Date).toUTCString()),this.state=c.ConnectorState.Connecting;new URLSearchParams(e).get("origin");return new Promise(((t,n)=>{const o=new O(e,[]);h.logDebug("Connection connect Begin:",this.url,(new Date).toUTCString()),this.startTimeOutTimer(o),(0,u.hasBuiltInWebSocket)()?(h.logDebug("Add socket error handler"),o.onerror=()=>{n(new Error("socket error")),o.close()}):(h.logDebug("Add socket error handler"),o.on("error",(()=>{n(new Error("socket error")),o.close()}))),o.onopen=()=>{h.logDebug("socket opened"),this.resetTimeOutTimer(c.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.FINISHED),this.onopen(o),this.heartbeat(),t(o)}}))}checkMaxRetry(){return h.logDebug("current retry count:",this.retryCount,"of",c.OKXCONNECTOR_WS_URL_LIST.length),this.retryCount>3*c.OKXCONNECTOR_WS_URL_LIST.length}connectionTryNext(){return s(this,void 0,void 0,(function*(){if(!this.checkMaxRetry()){this.retryCount+=1;let e=this.getNextSelectUrl();return h.logDebug("Connection retry:",e,(new Date).toUTCString()),this.registOpen(e,!0)}h.logDebug("Max Connection retry ",this.retryCount,(new Date).toUTCString())}))}startTimeOutTimer(e){this.connectionTimeoutTimer&&this.resetTimeOutTimer(c.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.CANCELED),this.pendingSocket=e,this.connectionTimeoutTimer=setTimeout((()=>{this.pendingSocket&&this.resetTimeOutTimer(c.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.TIME_OUT)}),this.timeOutLimit)}resetTimeOutTimer(e){var t;if(e==c.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.TIME_OUT)throw clearTimeout(this.connectionTimeoutTimer),null===(t=this.pendingSocket)||void 0===t||t.close(),this.pendingSocket=void 0,h.reportEvent(f.OKXReportType.LOG,"timeout",this.retryCount.toString()),new Error("socket timeout");this.pendingSocket=void 0,clearTimeout(this.connectionTimeoutTimer)}cacheSuccessUrlSelect(){this.connectURLStorage.saveContent(this.selectedUrlIndex.toString(),a.OKXCONNECTOR_CACHE_KEY)}getNextSelectUrl(){return this.selectedUrlIndex+=1,this.selectedUrlIndex=this.selectedUrlIndex%c.OKXCONNECTOR_WS_URL_LIST.length,c.OKXCONNECTOR_WS_URL_LIST[this.selectedUrlIndex]}onVisibleChanged(){return s(this,void 0,void 0,(function*(){if("visible"!==document.visibilityState||(h.logDebug(`get changed ${this.state}, ${this.socket}`),this.state!=c.ConnectorState.Connected||"undefined"!==typeof this.socket));else{h.logDebug("CONNECTION need reopen");try{yield this.tryRegistOpen()}catch(e){h.logError("regist open failed")}}}))}tryRegistOpen(){return s(this,arguments,void 0,(function*(e=this.url){if(this.connecting)return h.logDebug("tryRegistOpen => connecting state"),new Promise(((e,t)=>{this.events.once("fail",(e=>(h.logDebug("tryRegistOpen => connecting fail listener",e),t(e)))),this.events.once("open",(()=>"undefined"==typeof this.socket?t(new Error("Connect lost")):e(this.socket)))}));h.logDebug("tryRegistOpen => try registOpen until retry limit is hit");let t=!1;while(!this.checkMaxRetry()&&!this.socket)try{h.logDebug("tryRegistOpen => call registOpen, try count:",this.retryCount,t),yield this.registOpen(e,t)}catch(n){h.logDebug("tryRegistOpen => registOpen failed",n),this.retryCount+=1,e=this.getNextSelectUrl(),t=!0}if(h.logDebug("tryRegistOpen => exit while loop",this.retryCount,this.socket),!this.socket&&this.checkMaxRetry())throw h.logDebug("tryRegistOpen => failed to open a socket",this.retryCount,this.socket),this.retryCount=0,this.state=c.ConnectorState.OnError,this.emitError(new Error("tryRegistOpen failed")),new p.OKXConnectError(p.OKX_CONNECT_ERROR_CODES.CONNECTION_ERROR,"Failed to connect")}))}connect(){return s(this,void 0,void 0,(function*(){try{yield this.tryRegistOpen(),document.removeEventListener("visibilitychange",this.onVisibleChanged.bind(this)),document.addEventListener("visibilitychange",this.onVisibleChanged.bind(this))}catch(e){throw h.logDebug("connect => failed to connect",e),e}}))}disconnect(){return s(this,void 0,void 0,(function*(){return this.state=c.ConnectorState.Disconnected,new Promise(((e,t)=>{"undefined"!==typeof this.socket?(this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close(),this.heartbeatTimer&&clearTimeout(this.heartbeatTimer)):e()}))}))}currentStatus(){return{state:this.state,url:this.url}}addListener(e,t,n,o,i){this.listenPayloadHandler&&this.events.removeListener("payload",this.listenPayloadHandler),this.listenPayloadHandler=r=>s(this,void 0,void 0,(function*(){var s;h.logDebug(`<<< get payload ${r}`);let c=(0,d.safeJsonParse)(r);if(c.params&&c.params.data){let a=null===(s=c.params.data)||void 0===s?void 0:s.message,l=!1;if(a&&i){let e=yield i(c.params.data);l=e.isSplitPackage&&!e.finalMessage,e.isSplitPackage&&(e.finalMessage&&e.finalMessage.length>0?(h.logDebug("CONNECT: update raw msg content"),a=e.finalMessage):(h.logDebug("CONNECT: skip raw msg content"),l=!0))}if(!l)try{let i=t(a);void 0===i?(h.logDebug("CONNECT: decrypt undefined"),o(e,"Decrypt undefined")):n(e,i)}catch(r){h.logDebug(`CONNECT: decrypt failed: ${r}`),o(e,r.message)}}})),this.events.on("payload",this.listenPayloadHandler),this.failHandler&&this.events.removeListener("fail",this.failHandler),this.failHandler=t=>{t?(h.logDebug(`CONNECT failed: ${t}`),o(e,t.message)):o(e,"Unkonow error")},this.events.on("fail",this.failHandler)}addPackageParse(e){this.payloadHandler&&this.events.removeListener("payload",this.payloadHandler),this.payloadHandler=t=>s(this,void 0,void 0,(function*(){h.logDebug(`CONNECTION @[${(new Date).toUTCString()}] <<<< received e:${t}`);let n=(0,d.safeJsonParse)(t);yield e(n)})),this.events.on("payload",this.payloadHandler)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}send(e,t){return s(this,void 0,void 0,(function*(){try{"undefined"===typeof this.socket&&(h.logDebug(`>>> send payload undefined ${t}`),yield e()),h.logDebug(`CONNECTION @[${(new Date).toUTCString()}]>>> send payload ${(0,d.safeJsonStringify)(t)}`),this.socket&&this.socket.send((0,d.safeJsonStringify)(t))}catch(n){this.onError(t.id,n)}}))}getMsgPayloadFromHistory(e){return s(this,void 0,void 0,(function*(){if("undefined"===typeof e)return;let t={params:{data:e}},n=(0,d.safeJsonStringify)(e);h.logDebug("get received data from history"),h.logDebug(n),n=(0,d.safeJsonStringify)(t),this.events.emit("payload",n)}))}onOpen(e){this.openHandler&&this.events.removeListener("open",this.openHandler),this.openHandler=()=>s(this,void 0,void 0,(function*(){h.logDebug(`CONNECTION @[${(new Date).toUTCString()}] >>> ws opened: `),yield e()})),this.events.on("open",this.openHandler),this.cacheSuccessUrlSelect()}}t.OKXWalletConnector=v},7829:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&o(n,t,r[s]);return i(n,t),n}}(),s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionManager=void 0;const c=n(2516),a=n(3962),l=n(4942),d=n(5534),u=n(9795),g=n(49),h=n(8391),p=n(8384),f=n(3372),O=n(5767),v=n(5058),_=r(n(9323)),C=n(9323),E=n(9467),y=n(1716),m=n(4531);class N{constructor(e=void 0){this.events=new g.EventEmitter,this.splitManager=new m.ConnectionSplitPackages("dapp"),this.connectorEnable=!1,this.connectStorage=new h.Storage(l.OKXCONNECTOR_CACHE_KEY_DAPP+e,l.OKXCONNECTOR_CACHE_KEY_DAPP),this.tonsdkConnectStorage=new h.Storage(l.OKXCONNECTOR_TON_KEY+e,l.OKXCONNECTOR_TON_KEY),this.crypto=new f.SessionCrypto;let t=(0,y.isInTMA)();if((0,C.logDebug)("do init:",t),_.reportLog("connection manager do init"),t)try{const e=this.getCachedCryptoKeyPair();(0,C.logDebug)("use same pk:",e),this.crypto=new f.SessionCrypto(e)}catch(n){this.connectStorage.clearCache(),_.reportEvent(E.OKXReportType.LOG,"cache_fail","cache failed")}this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new c.OKXWalletConnector(u.OKXCONNECTOR_WS_URL_1),this.packageId=Date.now(),this.connectedWalletPK="",this.currentTopic="",_.logDebug(`this.connectedWalletPK  constructor   ${this.connectedWalletPK}`)}refreshPackageId(){let e=Date.now();e==this.packageId&&(this.packageId=e+1),this.packageId=e}saveCryptoKeyPair(e){let t=(0,v.safeJsonStringify)(e);this.connectStorage.encryptStoreMsg(t,l.OKXCONNECTOR_CRYPTO_KEY)}getCachedCryptoKeyPair(){const e=this.connectStorage.getAndDecrypt(l.OKXCONNECTOR_CRYPTO_KEY),t=e;if("string"==typeof t){_.logDebug("get cached crypto key:"),_.logDebug(t);let e=(0,v.safeJsonParse)(t);return e}return this.connectStorage.clearCache(),null}saveJWTKeyPair(e){var t={publicKey:(0,p.toHexString)(e.publicKey),secretKey:(0,p.toHexString)(e.secretKey)};_.logDebug("save jwt kp");let n=(0,v.safeJsonStringify)(t);_.logDebug(n),this.connectStorage.encryptStoreMsg(n,l.OKXCONNECTOR_JWT_KEY)}getCachedJWTKeyPair(){try{const t=this.connectStorage.getAndDecrypt(l.OKXCONNECTOR_JWT_KEY),n=t;if("string"==typeof n){_.logDebug("get cached jwt kp:"),_.logDebug(n);let t=(0,v.safeJsonParse)(n);_.logDebug("save jwt kp"),_.logDebug(t);var e={publicKey:(0,p.hexToByteArray)(t.publicKey),secretKey:(0,p.hexToByteArray)(t.secretKey)};return e}return(0,O.generateKeyPair)()}catch(t){return _.reportEvent(E.OKXReportType.LOG,"cache_fail","cache failed"),(0,O.generateKeyPair)()}}isWalletPKReady(){return _.logDebug(`isWalletPKReady  ===> ${this.connectedWalletPK}`),this.connectedWalletPK.length>0}makeJWT(e){return s(this,void 0,void 0,(function*(){return yield(0,O.signJWT)(e,d.OKXCONNECTOR_JWT_SIDE,d.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)}))}parsePackage(e){return s(this,arguments,void 0,(function*(e,t=!1){var n,o,i,r,c,d,u,g,h,p,f,O,v;if(this.events.emit(e.id,e),!t){yield this.sendACK(e.id,!0);let t=null===(n=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE))||void 0===n?void 0:n.content;if(t){let n=e;if(null===(i=null===(o=n.params)||void 0===o?void 0:o.data)||void 0===i?void 0:i.messageId){n.method&&n.method===a.CONNECT_METHOD_PUSH&&((0,C.logDebug)("checkExpire: update expire when get push"),this.updateExpireLimit(t));let e=this.splitManager.tryParseMessageSplitPayload(null===(c=null===(r=n.params)||void 0===r?void 0:r.data)||void 0===c?void 0:c.message);if(e){let o={topicId:null===(u=null===(d=n.params)||void 0===d?void 0:d.data)||void 0===u?void 0:u.topic,messageId:null===(h=null===(g=n.params)||void 0===g?void 0:g.data)||void 0===h?void 0:h.messageId,messageObject:e,publishedAt:null===(f=null===(p=n.params)||void 0===p?void 0:p.data)||void 0===f?void 0:f.publishedAt},i=yield this.splitManager.onReceivedPackageCheck(o);i.completeMessageIdList&&i.completeMessageIdList.forEach((e=>s(this,void 0,void 0,(function*(){this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e,t)}))))}else this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),null===(v=null===(O=n.params)||void 0===O?void 0:O.data)||void 0===v?void 0:v.messageId,t)}}}}))}restoreConnect(e){return s(this,void 0,void 0,(function*(){if(_.reportLog("connection manager restore connection"),_.logDebug(`connectionManager  restoreConenct   ${e}`),"string"!==typeof e||0===e.length)throw new Error("CONNECTION: invalid topic");_.logDebug("connectionManager  restoreConenct   disconnect"),yield this.disconnect(!0),this.connectStorage.saveContent(e,l.OKXCONNECTOR_TOKEN_CACHE),_.logDebug("connectionManager  restoreConenct   conect"),yield this.connect(!0)}))}getConnectInfo(){var e=(0,p.generateTopic)();_.logDebug(`generate topic token: ${e}`),_.reportLog("connection manager generate connection info"),this.currentTopic=e;const t={channelId:e,clientId:this.crypto.stringifyKeypair().publicKey};return t}connect(){return s(this,arguments,void 0,(function*(e=!1){this.timeLog=(new Date).getTime(),(0,C.logDebug)("ConnectTime---enter->",this.timeLog),_.reportLog("connection manager begin connect");let t=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE);var n=this.currentTopic;if(_.logDebug(`generate topic token: ${n}`),e){"undefined"!==typeof t&&null!==t&&(_.logDebug(`read last connect id: ${t}`),n=t.content);var o=this.connectStorage.getItem(l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE);o&&(this.connectedWalletPK=o.content,(0,C.logDebug)(`connectionManager connect() this.connectedWalletPK : ${this.connectedWalletPK}`)),_.reportLog("connection manager do restore connection")}if(e)try{const e=this.getCachedCryptoKeyPair();e&&(this.crypto=new f.SessionCrypto(e))}catch(r){throw _.logError("get crypto key pair from cache failed"),_.reportEvent(E.OKXReportType.LOG,"cache_fail","cache failed"),this.connectStorage.clearCache(),new Error("crypto cache failed")}_.logDebug(`use crypto client id: ${this.crypto.stringifyKeypair().publicKey}`),this.connectStorage.saveContent(n,l.OKXCONNECTOR_TOKEN_CACHE);var i=yield this.makeJWT(n);return _.logDebug(`generate jwt token: ${i}`),this.connectStorage.saveContent(i,"jwt"),new Promise(((t,o)=>{this.connector.onOpen((()=>s(this,void 0,void 0,(function*(){_.logDebug("1. connector on open"),_.reportLog("1. connect ws open");const r=(new Date).getTime();(0,C.logDebug)("ConnectTime---open->",r-this.timeLog),this.events.once(this.packageId.toString(),(i=>s(this,void 0,void 0,(function*(){if(i&&i.error){_.logError("failed when login"),_.reportLog("2. connect login failed"),yield this.connector.disconnect();var r=new Error;r.message=i.error.message,r.name=i.error.code.toString(),o(r)}this.refreshPackageId(),this.events.once(this.packageId.toString(),(i=>s(this,void 0,void 0,(function*(){if(i&&i.error){_.logError("failed when subscribe"),_.reportLog("3. connect subscribe failed"),yield this.connector.disconnect();var r=new Error;r.message=i.error.message,r.name=i.error.code.toString(),o(r)}this.refreshPackageId(),_.logDebug(`4. subscribe callback then send fetch: ${this.packageId}`),_.reportLog("4. subscribe callback then send fetch");const s=(new Date).getTime();if((0,C.logDebug)("ConnectTime--subscribe callback->",s-this.timeLog),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),n),_.logDebug(`5. splitmanager init: ${this.packageId}`),_.reportLog("5. splitmanager init"),yield this.splitManager.init(this.sendRaw.bind(this)),e){let e=this.checkExpire(n);e?((0,C.logDebug)("disconnect From topic expire"),setTimeout((()=>{this.activateDisconnect()}),1e3)):((0,C.logDebug)("extends expire check"),this.updateExpireLimit(n))}t()})))),_.logDebug(`3. login callback then send subscribe: ${this.packageId}`),_.reportLog("3. connect subscribe failed");const c=(new Date).getTime();(0,C.logDebug)("ConnectTime---login callback->",c-this.timeLog),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){_.logDebug("CONNECT: reconnect before send"),yield this.connector.connect().catch((e=>{(0,C.logDebug)("ConnectionManager connect error",e),o(e)}))}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_SUB,params:{topic:n}})})))),_.logDebug("2. login called"),_.reportLog("2. connection manager connect call login"),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){_.logDebug("CONNECT: reconnect before send"),yield this.connector.connect().catch((e=>{(0,C.logDebug)("ConnectionManager connect error",e),o(e)}))}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_LOGIN,params:{token:i}}),this.connector.addPackageParse((e=>{var t;if(_.logDebug("connect: parse package"),_.logDebug(e),!("params"in e)||!("data"in e["params"]))return void this.parsePackage(e,!0);let n=null===(t=e.params.data)||void 0===t?void 0:t.message;if("undefined"!==typeof n&&n.length>0){n=n.replace(/'/g,'"');let e=(0,v.safeJsonParse)(n);"string"!==typeof e&&"clientId"in e&&e.clientId&&e.clientId.length>0&&(this.connectedWalletPK=e.clientId,_.logDebug(`this.connectedWalletPK  addPackageParse   ${this.connectedWalletPK}`),this.connectStorage.saveContent(this.connectedWalletPK,l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()))}this.parsePackage(e,e.method===a.CONNECT_METHOD_RECEIVE)}))})))),this.connector.connect().catch((e=>{(0,C.logDebug)("ConnectionManager connect error",e),o(e)})),this.connectorEnable=!0}))}))}sendSubscribe(e){return s(this,void 0,void 0,(function*(){this.refreshPackageId(),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_SUB,params:{topic:e}})}))}sendDisconnect(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>s(this,void 0,void 0,(function*(){if(this.refreshPackageId(),!this.connectorEnable)return _.logDebug("skip disconnect before connected relay"),void t();this.events.once(this.packageId.toString(),(e=>s(this,void 0,void 0,(function*(){_.logDebug("CONNECT: disconnect command send"),this.connectorEnable=!1,t()}))));const n={id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_DISCONNECT,params:{message:{topic:e,ttl:u.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){_.logDebug("CONNECT: skip reconnect send")}))),n)}))))}))}sendRecvDisconnect(e){return s(this,void 0,void 0,(function*(){this.refreshPackageId();const t={id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_RECV_DISCONNECT,params:{topic:e}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}))}disconnect(){return s(this,arguments,void 0,(function*(e=!1){try{yield this.sendDisconnect(this.currentTopic)}catch(t){_.logError("send disconnect command failed",t)}yield this.connector.disconnect(),_.reportLog("connect disconnect"),this.connectStorage.clearCache(l.OKXCONNECTOR_TOKEN_CACHE),e||(this.connectStorage.clearCache(l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.connectedWalletPK="",(0,C.logDebug)(`connectionManager disconnect() this.connectedWalletPK : ${this.connectedWalletPK}`))}))}updateProtocolVersion(e,t){this.splitManager.updateTopicSenderVersion(e,t)}addListener(e,t,n){this.connector.addListener((0,v.safeJsonStringify)(e),(e=>{if(e=e.replace(/'/g,'"'),_.logDebug(`addListener ===> ${e}`),"undefined"!==typeof e&&e.length>0){var t=(0,v.safeJsonParse)(e),n=t.message;let o;return n.trimStart().startsWith("{")?o=n:(t.clientId&&t.clientId.length>0&&(this.connectedWalletPK=t.clientId,this.connectStorage.saveContent(this.connectedWalletPK,l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),_.logDebug(`this.connectedWalletPK  addListener   ${this.connectedWalletPK}`),_.logDebug(`this.cryptoKey  addListener   ${(0,p.toHexString)(this.crypto.keyPair.publicKey)}`),this.saveCryptoKeyPair(this.crypto.stringifyKeypair())),o=this.crypto.decrypt(n,this.connectedWalletPK)),_.logDebug(`addListener ===> ${o}`),o}}),t,n,(e=>new Promise(((t,n)=>s(this,void 0,void 0,(function*(){let n=this.splitManager.tryParseMessageSplitPayload(e.message);if(n){let o={topicId:e.topic,messageId:null===e||void 0===e?void 0:e.messageId,messageObject:n,publishedAt:null===e||void 0===e?void 0:e.publishedAt},i=yield this.splitManager.onReceivedPackageCheck(o);t(i)}else t({isSplitPackage:!1})}))))))}sendRaw(e){return s(this,void 0,void 0,(function*(){_.logDebug(`message send =====> ${e}`),_.reportLog("connect send raw msg");let t=e;_.logDebug(`message send =====encrypt message.length>>>> ${t.length}`);let n=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE);_.logDebug(`message send =====topic>>>> ${null===n||void 0===n?void 0:n.content}`),this.refreshPackageId();const o={id:this.packageId.toString(),method:a.CONNECT_METHOD_PUBLISH,jsonrpc:u.CONNECT_JSONRPC_VER,params:{message:{topic:null===n||void 0===n?void 0:n.content,message:t,ttl:u.OKXCONNECTOR_MESSAGE_TTL}}};return this.events.once(this.packageId.toString(),(e=>s(this,void 0,void 0,(function*(){e&&e.error?_.logError(`@${(new Date).toUTCString()} >>> failed when send msg`):e&&!e.error&&_.logDebug(`CONNECTION @[${(new Date).toUTCString()}] >>> send msg with id ${this.packageId} successed`)})))),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o),this.packageId}))}sendEncryptedMsg(e,t){return s(this,arguments,void 0,(function*(e,t,n=u.OKXCONNECTOR_MESSAGE_TTL){this.refreshPackageId();const o={id:this.packageId.toString(),method:a.CONNECT_METHOD_PUBLISH,jsonrpc:u.CONNECT_JSONRPC_VER,params:{message:{topic:e,message:t,ttl:n}}};this.events.once(this.packageId.toString(),(e=>s(this,void 0,void 0,(function*(){e&&e.error?_.logError(`@${(new Date).toUTCString()} >>> failed when send msg`):e&&!e.error&&_.logDebug(`CONNECTION @[${(new Date).toUTCString()}] >>> send msg with id ${this.packageId} successed`)})))),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}send(e){return s(this,arguments,void 0,(function*(e,t=u.OKXCONNECTOR_MESSAGE_TTL){if(_.logDebug(`message send =====> ${e}`),_.reportLog("connect send msg"),!this.isWalletPKReady())throw new Error("connection not finish");let n=this.crypto.encrypt(e,this.connectedWalletPK);_.logDebug(`message send =====encrypt message.length>>>> ${n.length}`),_.reportEvent(E.OKXReportType.LOG,"msg_size",n.length.toString());let o=this.connectStorage.getItem(l.OKXCONNECTOR_TOKEN_CACHE);return _.logDebug(`message send =====topic>>>> ${null===o||void 0===o?void 0:o.content}`),yield this.splitManager.sendSplitPackages(null===o||void 0===o?void 0:o.content,n,this.sendEncryptedMsg.bind(this),this.sendRaw.bind(this)),this.packageId}))}sendACK(e,t){return s(this,arguments,void 0,(function*(e,t,n=void 0){if(!0===t){const t={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}else if(n){const t={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,error:{code:n.code,message:n.message}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}}))}sendReceive(e,t,n){return s(this,void 0,void 0,(function*(){const o={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:n}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}sendFetchAndConsumeMessages(e,t){return s(this,void 0,void 0,(function*(){this.events.once(e,(e=>s(this,void 0,void 0,(function*(){var n,o;if(e.result){var i=e.result.hasMore,r=e.result.data;const n=e.result.disconnectedTopics;if(n)try{for(let e=0;e<n.length;e++){const t=n[e];if(t.topic){(0,C.logDebug)("send receive disconnect:",t.topic),yield this.sendRecvDisconnect(t.topic);let e=(0,v.safeJsonStringify)({requestId:t.publishedAt.toString(),method:"disconnect"}),n={messageId:t.publishedAt.toString(),message:(0,v.safeJsonStringify)({message:e}),topic:t.topic,publishedAt:t.publishedAt};yield this.connector.getMsgPayloadFromHistory(n)}}}catch(s){_.logError("disconnect topic fails",s)}if(r)for(let e=0;e<r.length;e++){let n=r[e];if(n&&n.topic==t){let e=n.messageId;_.reportLog("5. get fetch result");let o=this.splitManager.tryParseMessageSplitPayload(n.message);o?(yield this.connector.getMsgPayloadFromHistory(n),_.logDebug("skip receive")):(yield this.connector.getMsgPayloadFromHistory(n),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e,t))}}i&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else _.logDebug(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(o=e.error)||void 0===o?void 0:o.message}`)})))),_.logDebug("5. send fetch more"),_.reportLog("5. send fetch more");const n=(new Date).getTime();(0,C.logDebug)("ConnectTime---5->",n-this.timeLog);const o={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return _.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}cleanCache(){_.reportLog("connection cache clean called"),this.connectStorage.clearCache()}saveSessionContent(e,t){t||this.connectStorage.clearCache(l.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let n=(0,v.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(n,l.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){try{let t=this.connectStorage.getAndDecrypt(l.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t){let e=(0,v.safeJsonParse)(t);return e}}catch(t){this.connectStorage.clearCache(l.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}}getCurrentConnectionReady(){let e=!1;try{const t=this.getCachedCryptoKeyPair();t&&(e=!0)}catch(t){_.logError("check connection ready failed")}return this.isWalletPKReady()&&e}getCryptoKeyEnable(){let e=!1;try{const t=this.getCachedCryptoKeyPair();t&&(e=!0)}catch(t){_.logError("check connection ready failed")}return e}checkExpire(e){let t=!1;if(0==e.length)return(0,C.logDebug)("checkExpire: invalid topic"),t;let n=this.getSessionContent(l.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE);if(n&&n.topic){let o=n.topic;o==e?Date.now()>n.timestamp&&((0,C.logDebug)("checkExpire: connection is Expired"),t=!0):((0,C.logDebug)("checkExpire: not same connection"),t=!1)}else(0,C.logDebug)("checkExpire: not topic records"),this.updateExpireLimit(e),t=!1;return t}updateExpireLimit(e){(0,C.logDebug)(`update expire limit for topic: ${e}`);let t={topic:e,timestamp:Date.now()+u.OKXCONNECTOR_SESSION_LIVE_TTL};this.saveSessionContent(l.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE,t)}activateDisconnect(){return s(this,void 0,void 0,(function*(){let e=(0,v.safeJsonStringify)({requestId:"",method:"disconnect"}),t={messageId:"",message:(0,v.safeJsonStringify)({message:e}),topic:this.currentTopic,publishedAt:0};yield this.connector.getMsgPayloadFromHistory(t)}))}}t.ConnectionManager=N},4531:function(e,t,n){"use strict";n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&o(n,t,r[s]);return i(n,t),n}}(),s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionSplitPackages=void 0;const a=n(4942),l=c(n(149)),d=n(8384),u=n(5058),g=r(n(9323)),h=n(9323),p=2,f=63e3,O="ConnectionReceiveKey",v="ConnectionSendKey",_="ConnectionSenderVersionKey";class C{constructor(e){this.splitMessageSendArray=new Map,this.splitMessageReceivedArray=new Map,this.splitMessageSenderVersionMap=new Map,this.splitPackageCache=l.default.createInstance({name:a.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE+e})}init(e){return s(this,void 0,void 0,(function*(){if(yield this.recoverFromCache(),this.splitMessageSendArray.size>0){for(const[n,o]of this.splitMessageSendArray.entries())for(let i=0;i<o.length;){const r=o[i];try{yield e((0,u.safeJsonStringify)(r),n),g.logDebug(`Successfully sent payload: ${(0,u.safeJsonStringify)(r)} to topic: ${n}`),o.splice(i,1)}catch(t){g.logError(`Failed to send payload: ${(0,u.safeJsonStringify)(r)} to topic: ${n}`,t),r.retryCount=(r.retryCount||0)+1,r.retryCount>3?(g.logError(`Payload failed after 3 retries: ${(0,u.safeJsonStringify)(r)}`),o.splice(i,1)):i++}}yield this.syncCache()}}))}tryParseMessageSplitPayload(e){var t;let n;try{if(e.trimStart().startsWith("{")){let o=(0,u.safeJsonParse)(e);if(o&&o.protocol_version&&o.protocol_version>=2){let e=o;e.package_group_id&&(null===(t=e.package_group_id)||void 0===t?void 0:t.length)>0&&(n=o)}}else(0,h.logDebug)("not split packages")}catch(o){(0,h.logDebug)("not split packages")}return n}updateTopicSenderVersion(e,t){return s(this,void 0,void 0,(function*(){this.splitMessageSenderVersionMap.set(e,t),yield this.syncCache(),(0,h.logDebug)("get update topic sender version: ",e,t)}))}sendSplitPackages(e,t,n,o){return s(this,void 0,void 0,(function*(){if(!e)return void g.logError("sendSplitPackages invalid topic");let i=this.splitMessageSenderVersionMap.get(e),r=t.length;try{if(r<f)throw new Error(`no need to split (size:${r})`);if(!i||i&&i<p)throw new Error(`version not support split (version: ${i})`);const n=[];let c=f;for(let e=0;e<t.length;e+=c)e+c<t.length?n.push(t.slice(e,e+c)):n.push(t.slice(e));let a=(0,d.generateGroupId)(),l=n.map(((t,o)=>{let i={topicId:e,protocol_version:p,total_count:n.length,package_index:o,package_group_id:a,content:t};return i}));this.mergePackageArray(!0,l);for(let t=0;t<l.length;){const n=l[t],i=(0,u.safeJsonStringify)(n);try{yield o(i,e),g.logDebug(`Successfully sent payload: ${i} to topic: ${e}`),l.splice(t,1)}catch(s){g.logError(`Failed to send payload: ${i} to topic: ${e}`,s),n.retryCount=(n.retryCount||0)+1,n.retryCount>3?(g.logError(`Payload failed after 3 retries: ${i}`),l.splice(t,1)):t++}}this.splitMessageSendArray.set(e,[]),yield this.syncCache()}catch(c){(0,h.logDebug)("send split packages no split"),(0,h.logDebug)(c),yield n(e,t)}}))}onReceivedPackageCheck(e){return s(this,void 0,void 0,(function*(){this.mergePackageArray(!1,[e]);let t=new Map,n=e.topicId;this.splitMessageReceivedArray.forEach(((n,o)=>{o==e.topicId&&n.forEach((e=>{if(e.messageObject.package_group_id){let n=t.get(e.messageObject.package_group_id);n||(n=new Array),n.push(e),t.set(e.messageObject.package_group_id,n)}}))})),(0,h.logDebug)("on received message, check message cache");let o={isSplitPackage:!1};if(e.messageObject.package_group_id){o.isSplitPackage=!0;let i=t.get(e.messageObject.package_group_id);if(null===i||void 0===i?void 0:i.length){let t=new Set;if(i.forEach((e=>{void 0!==e.messageObject.package_index&&t.add(e.messageObject.package_index)})),t.size==e.messageObject.total_count){i.sort(((e,t)=>!e.messageObject.package_index&&0!==e.messageObject.package_index||!t.messageObject.package_index&&0!==t.messageObject.package_index?0:e.messageObject.package_index-t.messageObject.package_index));let e=i.reduce(((e,t)=>(e.push(t.messageObject.content),e)),[]),t=i.reduce(((e,t)=>(e.push(t.messageId),e)),[]);o.isSplitPackage=!0,o.finalMessage=e.join(""),o.completeMessageIdList=t;let r=this.splitMessageReceivedArray.get(n);r&&(r=r.filter((e=>!t.includes(e.messageId))),this.splitMessageReceivedArray.set(n,r)),yield this.syncCache()}}}return o}))}mergePackageArray(e,t){return s(this,void 0,void 0,(function*(){if((0,h.logDebug)("append sending array"),e){let e=t,n=e.filter((e=>{let t=e.topicId,n=!0,o=this.splitMessageSendArray.get(t);return null===o||void 0===o||o.forEach((t=>{t.package_group_id==e.package_group_id&&t.total_count==e.total_count&&t.package_index==e.package_index&&(n=!1)})),n}));if(n.length>0){let e=n[0].topicId,t=this.splitMessageSendArray.get(e);t||(t=new Array),t=t.concat(n),this.splitMessageSendArray.set(e,t),(0,h.logDebug)("append sending array (after filted): ",t)}}else{let e=t,n=e.filter((e=>{let t=e.topicId,n=!0,o=this.splitMessageReceivedArray.get(t);return null===o||void 0===o||o.forEach((t=>{t.messageId==e.messageId&&(n=!1)})),n}));if(n.length>0){let e=n[0].topicId,t=this.splitMessageReceivedArray.get(e);t||(t=new Array),t=t.concat(n),this.splitMessageReceivedArray.set(e,t),(0,h.logDebug)("append received array (after filted): ",t)}}}))}syncCache(){return s(this,void 0,void 0,(function*(){(0,h.logDebug)("sync split message cache"),yield this.splitPackageCache.setItem(O,this.splitMessageReceivedArray),yield this.splitPackageCache.setItem(v,this.splitMessageSendArray),yield this.splitPackageCache.setItem(_,this.splitMessageSenderVersionMap)}))}recoverFromCache(){return s(this,void 0,void 0,(function*(){let e=yield this.splitPackageCache.getItem(O);this.splitMessageReceivedArray=e||new Map;let t=yield this.splitPackageCache.getItem(v);this.splitMessageSendArray=t||new Map;let n=yield this.splitPackageCache.getItem(_);this.splitMessageSenderVersionMap=n||new Map}))}}t.ConnectionSplitPackages=C},9795:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorState=t.CONNECT_PROTOCOL_VER=t.CONNECT_JSONRPC_VER=t.OKXCONNECTOR_SESSION_LIVE_TTL=t.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL=t.OKXCONNECTOR_MESSAGE_TTL=t.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE=t.OKXCONNECTOR_WS_URL_LIST=t.OKXCONNECTOR_WS_URL_IDX_KEY=t.OKXCONNECTOR_WS_URL_3=t.OKXCONNECTOR_WS_URL_2=t.OKXCONNECTOR_WS_URL_1=t.EVENT_EMITTER_MAX_LISTENERS=t.OKXCONNECTOR_PROTOCOL_VERSION=void 0,t.OKXCONNECTOR_PROTOCOL_VERSION=2,t.EVENT_EMITTER_MAX_LISTENERS=10,t.OKXCONNECTOR_WS_URL_1="wss://wsdexpri.okx.com/ws/v1/wallet-connect-relay",t.OKXCONNECTOR_WS_URL_2="wss://wsdexpri.okx.ac/ws/v1/wallet-connect-relay",t.OKXCONNECTOR_WS_URL_3="wss://wsdexpri.coinall.ltd/ws/v1/wallet-connect-relay",t.OKXCONNECTOR_WS_URL_IDX_KEY="wuik",t.OKXCONNECTOR_WS_URL_LIST=[t.OKXCONNECTOR_WS_URL_1,t.OKXCONNECTOR_WS_URL_2,t.OKXCONNECTOR_WS_URL_3],t.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE={TIME_OUT:3990,CANCELED:3991,FINISHED:3992},t.OKXCONNECTOR_MESSAGE_TTL=3e5,t.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL=864e5,t.OKXCONNECTOR_SESSION_LIVE_TTL=864e5,t.CONNECT_JSONRPC_VER="2.0",t.CONNECT_PROTOCOL_VER=2,t.ConnectorState={InitState:0,Connecting:1,Connected:2,Disconnected:3,OnError:4}},5062:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const i=n(852),r=n(9795),s=n(2581),c=n(1317),a=n(7829),l=n(8097),d=n(5953);class u{constructor(e){this.connectors=[],this.useConnector=void 0,this.sessionRetryTimer=null,this.connectionManager=new a.ConnectionManager(e),this.addConnectionListener()}getConnector(){if(this.useConnector)return this.useConnector}setAccountChangeListener(e){this.accountChangeListener=e,(0,s.logDebug)("setAccountChangeListener: engine",e);for(const t of this.connectors)t.setAccountChangeListener(e)}registerConnector(e){this.connectors=e;for(const t of e)t.setConnectionManager(this.connectionManager)}getAllConnectors(){return this.connectors}hasWsConnector(){for(const e of this.connectors)if(this.isWsConnector(e))return!0;return!1}isWsConnector(e){return!!e&&Object.values(c.CONNECTOR_TYPE.WS).includes(e.getType())}isInjectedConnector(e){return!!e&&(Object.values(c.CONNECTOR_TYPE.INJECT).includes(e.getType())||Object.values(c.CONNECTOR_TYPE.KEYLESS).includes(e.getType()))}universalConnect(e,t,n){return o(this,void 0,void 0,(function*(){return this.addConnectionListener(),new Promise(((r,a)=>o(this,void 0,void 0,(function*(){var o,u,g,h,p;try{(0,s.logDebug)("engine universalConnect request :",JSON.stringify(e)),(0,s.logDebug)("engine universalConnect sessionConfig :",JSON.stringify(t));let O=[];e.forEach((e=>{let t=e.name;(t.startsWith("requestAccounts")||t.startsWith("ton"))&&O.push(e)})),(0,s.logDebug)("engine universalConnect universalRequest :",JSON.stringify(O));const v=this.connectionManager.getConnectInfo(),_=Date.now().toString();let C=null!==(o=t.openUniversalUrl)&&void 0!==o&&o,E=null!==(u=t.openAppLinkType)&&void 0!==u?u:i.OpenAppLinkType.UniversalLink;const y={protocolVer:Number(i.tonConnectSdkVersion),topic:v.channelId,clientId:v.clientId,requestId:_,dAppInfo:this.fixDappName(t.dappInfo),requests:O,redirect:null!==(g=null===t||void 0===t?void 0:t.redirect)&&void 0!==g?g:"none"},m=(0,s.encodeConnectParams)(y);y.redirect=null!==(h=null===t||void 0===t?void 0:t.redirect)&&void 0!==h?h:"none",(0,s.logDebug)("engine universalConnect ==>>universalConnectRequest:",JSON.stringify(y));let N="",b="";if(C){let e=(0,s.getOKXLink)(y,t.useMini,t.tmaReturnUrl);N=e.universalLink,b=e.deepLink||"",(0,s.logDebug)("engine universalConnect ==>>openOKXLink:",N)}const T=()=>1==this.connectors.length&&this.isInjectedConnector(this.connectors[0])?this.connectors[0].openWallet({connectRequest:y},E):t.useMini?(0,s.openOKXTMAWalletlinkWithFallback)(N):(0,s.openOKXDeeplinkWithFallback)(b,N,E);(0,s.logDebug)("engine universalConnect ==>>openOKXLink:",N);const S=(0,s.isIos)();if(S&&C&&((0,s.logDebug)(`engine universalConnect ==>>isIOS: ${S}   openUniversalLink: ${C}`),T()),this.addOnConnectResultListener(((e,n)=>{var o,u,g,h;try{this.stopSendSessionRetry(),this.addOnConnectResultListener(void 0);let a=e;if("connect"==a.method){(0,s.logDebug)("engin  universalConnect success connectResponse:>>>",JSON.stringify(a));let e=(0,l.buildNameSpacesByConnectResponse)(a);if(!e)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);{let l;(null===(u=null===(o=a.payload)||void 0===o?void 0:o.responses)||void 0===u?void 0:u[0])&&"walletName"in a.payload.responses[0]&&(l=a.payload.responses[0]["walletName"]);let h=null===(g=a.payload)||void 0===g?void 0:g.wallet.appName;var p,f="";switch(h){case d.OKXWalletName:f=c.OKX_APP_WALLET;break;case d.OKXMiniWalletName:f=c.OKX_TG_WALLET;break}if(n?p=n:f&&(p=this.connectors.find((e=>e.getTag()===f))),!p)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);let O=Object.assign({topic:v.channelId,sessionConfig:t,namespaces:e},a.payload&&{wallet:Object.assign(Object.assign({},a.payload.wallet),{walletName:l})}),_=a.payload.responses.find((e=>"requestAccounts"===e.name));_&&_.connectRequestMethods&&(O.signResponse=_.connectRequestMethods),(0,s.logDebug)("engin  universalConnect success session:>>>",JSON.stringify(O)),this.isWsConnector(p)&&((0,s.logDebug)("engine update protocol version"),this.connectionManager.updateProtocolVersion(v.channelId,a.payload.wallet.maxProtocolVersion)),this.deviceInfo=Object.assign({},O.wallet),r(O),this.setUseConnector(p),(0,s.reportEvent)(s.OKXReportType.PAGE_IN,s.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,f)}}else if("connect_error"==a.method&&void 0!=(null===(h=a.payload)||void 0===h?void 0:h.code))throw new i.OKXConnectError(a.payload.code)}catch(O){a(O)}})),this.hasWsConnector()){yield null===(p=this.connectionManager)||void 0===p?void 0:p.disconnect(!1);try{yield this.connectionManager.connect()}catch(f){throw(0,s.logDebug)("Engine universalConnect error",f),f}(0,s.logDebug)("engin  universalConnect ==>> connectInfoAndUrl:",n),this.sendSession(m,y.topic,C)}if(!S&&C&&T(),(0,s.logDebug)("engin  universalConnect ==>> connectInfoAndUrl:",n),n){const e={connectRequest:y,redirect:t.redirect,tmaReturnUrl:t.tmaReturnUrl};(0,s.logDebug)("universalConnect connectInfoAndUrl info :",JSON.stringify(e)),n(e)}}catch(O){(0,s.logDebug)("Engine universalConnect catch error",O),a(O)}}))))}))}fixDappName(e){try{if("dapp portal"===e.name.toLowerCase()){let t=document.title;if(t||(t=this.getOGSiteName()),t)return Object.assign(Object.assign({},e),{name:e.name+" - "+t})}return e}catch(t){return e}}getOGSiteName(){let e=document.getElementsByTagName("meta"),t=["og:site_name","og:title","twitter:title"];for(let n of e){let e=n.getAttribute("property");for(let o of t)if(e==o)return n.getAttribute("content")}}addOnConnectResultListener(e){for(const t of this.connectors)this.isInjectedConnector(t)&&t.setOnConnectResultListener(e);this.connectResultListener=e}openWallet(e,t,n){var o;t?t.openWallet(e,n):null===(o=this.getConnector())||void 0===o||o.openWallet(e,n)}send(e,t,n){return o(this,void 0,void 0,(function*(){var n,o,r,c,a,l,d,u,g;let h;"chainId"in e&&null!=e.chainId&&(h=e.chainId.toString());try{if((0,s.reportEvent)(s.OKXReportType.LOG,s.Report_OKXConnectSDK_RequestStart_Log,"",null!==(o=null===(n=this.getConnector())||void 0===n?void 0:n.getTag())&&void 0!==o?o:"",e.method,null!==(c=null===(r=this.deviceInfo)||void 0===r?void 0:r.platform)&&void 0!==c?c:"",h),!this.getConnector())throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR);null===(a=this.getConnector())||void 0===a||a.send(e,{resolve:n=>{var o,i,r,c,a,l,d,u,g;null===(o=null===t||void 0===t?void 0:t.resolve)||void 0===o||o.call(t,n),"error"in n&&n.error?(0,s.reportEvent)(s.OKXReportType.LOG,s.Report_OKXConnectSDK_RequestError_Log,"",null!==(r=null===(i=this.getConnector())||void 0===i?void 0:i.getTag())&&void 0!==r?r:"",e.method,null!==(a=null===(c=this.deviceInfo)||void 0===c?void 0:c.platform)&&void 0!==a?a:"",h):(0,s.reportEvent)(s.OKXReportType.LOG,s.Report_OKXConnectSDK_RequestSuccess_Log,"",null!==(d=null===(l=this.getConnector())||void 0===l?void 0:l.getTag())&&void 0!==d?d:"",e.method,null!==(g=null===(u=this.deviceInfo)||void 0===u?void 0:u.platform)&&void 0!==g?g:"",h)},onAck:()=>{var e;null===(e=null===t||void 0===t?void 0:t.onAck)||void 0===e||e.call(t)}})}catch(p){throw(0,s.reportEvent)(s.OKXReportType.LOG,s.Report_OKXConnectSDK_RequestError_Log,"",null!==(d=null===(l=this.getConnector())||void 0===l?void 0:l.getTag())&&void 0!==d?d:"",e.method,null!==(g=null===(u=this.deviceInfo)||void 0===u?void 0:u.platform)&&void 0!==g?g:"",h),p}}))}clearData(){var e;null===(e=this.getConnector())||void 0===e||e.clearData()}addDisconnectListener(e){var t;null===(t=this.getConnector())||void 0===t||t.addDisconnectListener(e)}saveSessionContent(e,t){this.connectionManager.saveSessionContent(e,t)}getSessionContent(e){var t,n=this.connectionManager.getSessionContent(e);if(n){var o="";if("object"===typeof n&&(o=(0,c.getTagByappName)(null===(t=n.wallet)||void 0===t?void 0:t.appName)),this.connectors.find((e=>e.getTag()===o)))return n}}setConnectConnector(e){var t=(0,c.getTagByappName)(null===e||void 0===e?void 0:e.appName);t&&this.setUseConnector(this.connectors.find((e=>e.getTag()===t)))}setUseConnector(e){this.useConnector=e,this.isWsConnector(e)&&e.addConnectionListener()}setSessionConnectingListener(e){this.sessionConnectingListener=e}restoreconnect(e,t){return o(this,void 0,void 0,(function*(){this.getConnector()?this.getConnector().restoreconnect(e,(e=>{var n,o;t(e),e&&(this.deviceInfo=Object.assign({},e.wallet),(0,s.reportEvent)(s.OKXReportType.PAGE_IN,s.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,null!==(o=null===(n=this.getConnector())||void 0===n?void 0:n.getTag())&&void 0!==o?o:""))})):t(null)}))}restoreconnectFromTopic(e){return o(this,void 0,void 0,(function*(){this.isWsConnector(this.getConnector())&&(yield this.getConnector().restoreconnectFromTopic(e))}))}getCurrentConnectionReady(e){var t;return!!(null===(t=this.getConnector())||void 0===t?void 0:t.getCurrentConnectionReady(e))}connectManagerDisconnect(){return o(this,arguments,void 0,(function*(e=!1){var t,n;this.getConnector()?null===(t=this.getConnector())||void 0===t||t.connectManagerDisconnect(e):yield null===(n=this.connectors.find((e=>this.isWsConnector(e))))||void 0===n?void 0:n.connectManagerDisconnect(e),this.stopSendSessionRetry(),this.setUseConnector(void 0)}))}sendSession(e,t,n){return o(this,void 0,void 0,(function*(){(0,s.logDebug)("[Connect] sendSession called:",e);const i=Date.now().toString();let c={method:"session_info",params:{protocolVersion:r.CONNECT_PROTOCOL_VER,sessionInfo:e}};yield this.connectionManager.sendRaw(JSON.stringify(Object.assign(Object.assign({},c),{requestId:i}))),this.sessionRetryTimer&&clearInterval(this.sessionRetryTimer),n||(this.sessionRetryTimer=setInterval((()=>o(this,void 0,void 0,(function*(){const e=Date.now().toString();(0,s.logDebug)("[Connect] Retrying sendSession..."),yield this.connectionManager.sendSubscribe(t),yield this.connectionManager.sendRaw(JSON.stringify(Object.assign(Object.assign({},c),{requestId:e})))}))),r.OKXCONNECTOR_MESSAGE_TTL))}))}stopSendSessionRetry(){this.sessionRetryTimer&&(clearInterval(this.sessionRetryTimer),this.sessionRetryTimer=null,(0,s.logDebug)("[Connect] Stopped retry for session"))}addConnectionListener(){var e;null===(e=this.connectionManager)||void 0===e||e.addListener("sdk_response",((e,t)=>{var n=(0,s.safeJsonParse)(t);(0,s.logDebug)(`Engine ==>> addListener ==> success ==> ${n}`),"connect"===n.method?this.connectResultListener&&this.connectResultListener(n):"connect_error"===n.method?this.connectManagerDisconnect(!1).catch((()=>{})).finally((()=>{this.connectResultListener&&this.connectResultListener(n)})):"session_connecting"===n.method&&((0,s.logDebug)("Engine ==>> handleResponse_4  ===> sessionConnectingListener"),this.sessionConnectingListener&&((0,s.logDebug)("Engine ==>> handleResponse_4  ===> sessionConnectingListener not null"),this.sessionConnectingListener(),this.sessionConnectingListener=void 0))}),(function(){}))}}t.Engine=u},8530:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.Engine=t.WalletConnectionManager=t.ConnectionManager=t.OKXWalletConnector=void 0;var o=n(2516);Object.defineProperty(t,"OKXWalletConnector",{enumerable:!0,get:function(){return o.OKXWalletConnector}});var i=n(7829);Object.defineProperty(t,"ConnectionManager",{enumerable:!0,get:function(){return i.ConnectionManager}});var r=n(5178);Object.defineProperty(t,"WalletConnectionManager",{enumerable:!0,get:function(){return r.WalletConnectionManager}});var s=n(5062);Object.defineProperty(t,"Engine",{enumerable:!0,get:function(){return s.Engine}});var c=n(8391);Object.defineProperty(t,"Storage",{enumerable:!0,get:function(){return c.Storage}})},5767:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&o(n,t,r[s]);return i(n,t),n}}(),s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MULTICODEC_ED25519_LENGTH=t.MULTICODEC_ED25519_HEADER=t.MULTICODEC_ED25519_BASE=t.MULTICODEC_ED25519_ENCODING=t.DID_METHOD=t.DID_PREFIX=t.DID_DELIMITER=t.KEY_PAIR_SEED_LENGTH=t.DATA_ENCODING=t.JSON_ENCODING=t.JWT_ENCODING=t.JWT_DELIMITER=t.JWT_IRIDIUM_TYP=t.JWT_IRIDIUM_ALG=t.JWTHeaderType=void 0,t.generateKeyPair=p,t.decodeJSON=f,t.encodeJSON=O,t.encodeIss=v,t.decodeIss=_,t.encodeSig=C,t.decodeSig=E,t.encodeData=y,t.decodeData=m,t.encodeJWT=N,t.decodeJWT=b,t.signJWT=T,t.verifyJWT=S;const a=r(n(8091)),l=n(5058),d=n(8384),u=c(n(998)),g=r(n(9323)),h=n(8991);function p(){return u.default.sign.keyPair()}function f(e){return(0,l.safeJsonParse)((0,h.okxtoString)((0,h.okxfromString)(e,t.JWT_ENCODING),t.JSON_ENCODING))}function O(e){return(0,h.okxtoString)((0,h.okxfromString)((0,l.safeJsonStringify)(e),t.JSON_ENCODING),t.JWT_ENCODING)}function v(e){g.logDebug(`publicKey: ${(0,d.toHexString)(e)}`);var n=(0,h.okxtoString)(e,t.MULTICODEC_ED25519_ENCODING);return[t.DID_PREFIX,t.DID_METHOD,n].join(t.DID_DELIMITER)}function _(e){const[n,o,i]=e.split(t.DID_DELIMITER);if(n!==t.DID_PREFIX||o!==t.DID_METHOD)throw new Error('Issuer must be a DID with method "key"');if(void 0===i)throw new Error("multicodec is undefined");const r=(0,h.okxfromString)(i,t.MULTICODEC_ED25519_ENCODING);if(void 0===r||r.length!==t.MULTICODEC_ED25519_LENGTH)throw new Error("Issuer must be a public key with length 32 bytes");return r}function C(e){return(0,h.okxtoString)(e,t.JWT_ENCODING)}function E(e){return(0,h.okxfromString)(e,t.JWT_ENCODING)}function y(e){return(0,h.okxfromString)([O(e.header),O(e.payload)].join(t.JWT_DELIMITER),t.DATA_ENCODING)}function m(e){var n,o;const i=(0,h.okxtoString)(e,t.DATA_ENCODING).split(t.JWT_DELIMITER),r=f(null!==(n=i[0])&&void 0!==n?n:"{}"),s=f(null!==(o=i[1])&&void 0!==o?o:"{}");return{header:r,payload:s}}function N(e){return[O(e.header),O(e.payload),C(e.signature)].join(t.JWT_DELIMITER)}function b(e){var n,o,i;const r=e.split(t.JWT_DELIMITER),s=f(null!==(n=r[0])&&void 0!==n?n:"{}"),c=f(null!==(o=r[1])&&void 0!==o?o:"{}"),a=E(null!==(i=r[2])&&void 0!==i?i:"{}"),l=(0,h.okxfromString)(r.slice(0,2).join(t.JWT_DELIMITER),t.DATA_ENCODING);return{header:s,payload:c,signature:a,data:l}}function T(e,n,o,i){return s(this,arguments,void 0,(function*(e,n,o,i,r=Math.floor(Date.now())){const s={alg:t.JWT_IRIDIUM_ALG,typ:t.JWT_IRIDIUM_TYP},c=v(i.publicKey),a=r+o,l="authenticate user",d={iss:c,sub:e,aud:n,act:l,iat:r,exp:a},h=y({header:s,payload:d});g.logDebug(`get sec kp: ${i.secretKey} {${i.secretKey.length}}`);const p=u.default.sign.detached(h,i.secretKey);return N({header:s,payload:d,signature:p})}))}function S(e){return s(this,void 0,void 0,(function*(){const{header:n,payload:o,data:i,signature:r}=b(e);if(n.alg!==t.JWT_IRIDIUM_ALG||n.typ!==t.JWT_IRIDIUM_TYP)throw new Error("JWT must use EdDSA algorithm");const s=_(o.iss);return a.verify(s,i,r)}))}t.JWTHeaderType="dapp",t.JWT_IRIDIUM_ALG="EdDSA",t.JWT_IRIDIUM_TYP="JWT",t.JWT_DELIMITER=".",t.JWT_ENCODING="base64url",t.JSON_ENCODING="utf8",t.DATA_ENCODING="utf8",t.KEY_PAIR_SEED_LENGTH=32,t.DID_DELIMITER=":",t.DID_PREFIX="did",t.DID_METHOD="key",t.MULTICODEC_ED25519_ENCODING="base58btc",t.MULTICODEC_ED25519_BASE="z",t.MULTICODEC_ED25519_HEADER="K36",t.MULTICODEC_ED25519_LENGTH=32},5534:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_JWT_TTL=t.OKXCONNECTOR_JWT_WALLET_SIDE=t.OKXCONNECTOR_JWT_SIDE=void 0,t.OKXCONNECTOR_JWT_SIDE="wallet",t.OKXCONNECTOR_JWT_WALLET_SIDE="dapp",t.OKXCONNECTOR_JWT_TTL=864e5},8097:function(e,t,n){"use strict";n(4114),Object.defineProperty(t,"__esModule",{value:!0}),t.buildNameSpacesByConnectResponse=i,t.buildRequestAccountNameSpacesByConnectResponse=r,t.buildAccountNameSpaces=s;const o=n(9323);function i(e){let t=r(e);return t}function r(e){let t={};(0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse start connectResponse111>>",JSON.stringify(e));let n=e.payload.responses.find((e=>"requestAccounts"===e.name));if(n&&n.accounts){let e=[];for(const t of n.accounts)"ton"===t.namespace?t.data&&t.data.ton_addr&&t.data.ton_addr.address&&t.data.ton_addr.address.length>0&&((0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse start TON>>",JSON.stringify(t)),e.push(t)):((0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse start other>>",JSON.stringify(t)),e.push(t));n.accounts=e}const i=e.payload.responses.find((e=>"ton_addr"===e.name)),r=e.payload.responses.find((e=>"ton_proof"===e.name));if(i&&!n){(0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse adapt ton data >>");let e=i.address;e="ton:"+i.network+":"+e;let t={ton_addr:i};r&&(t.ton_proof=r),n={name:"requestAccounts",accounts:[{namespace:"ton",addresses:[e],methods:["ton_sendTransaction"],extra:{},data:t}]}}return(0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse end universalResponse>>>",JSON.stringify(n)),s(n.accounts,t),t}function s(e,t){e.forEach((e=>{var n=[],i=[];e.addresses.forEach((e=>{var t=e.split(":");if((0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse addressArr>>",t.length),t.length>=3){let r=t.slice(0,2).join(":");n.push(r),i.push(e),(0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse chain:>>",r,"addressItem:",e)}})),e.data&&e.data.ton_addr&&(e.data.ton_addr.name="ton_addr"),e.data&&e.data.ton_proof&&(e.data.ton_proof.name="ton_proof"),t[e.namespace]={chains:n,accounts:i,methods:e.methods,extra:e.extra,payload:e.data},(0,o.logDebug)("buildRequestAccountNameSpacesByConnectResponse result>>",JSON.stringify(t))}))}},8391:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&o(n,t,r[s]);return i(n,t),n}}(),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0;const c=n(4942),a=s(n(998)),l=n(8384),d=n(2581),u=r(n(9323)),g=n(2581),h=n(4473);class p{constructor(e,t=void 0){const n=(0,l.resolveLocalStorage)();this.storeKey="",this.cipherIV="",this.subKey=e,u.logDebug("--------get current local storage --------"),u.logDebug(n),this.synchronizedCache()}checkAndUpgradeCache(e,t){if(e&&e.length>0&&t&&t.length>0){u.logDebug("--------get current local storage --------"),u.logDebug(localStorage);const n=localStorage.getItem(p.cacheKey+e);if("undefined"===typeof n||null===n)return void u.logDebug("no pre cache content");u.logDebug(n),(null===n||void 0===n?void 0:n.length)>0&&(u.logDebug("write in cache content: ",e,"->",t),localStorage.setItem(p.cacheKey+t,n),u.logDebug("clean in cache content: ",e),localStorage.removeItem(p.cacheKey+e))}else u.logDebug("no pre cache key:",e)}saveContent(e,t,n="-"){let o={id:n,timestamp:Date.now().toString(),content:e};this.saveItem(o,t)}saveItem(e,t){let n=p.cacheKey+this.subKey;const o=(0,l.resolveLocalStorage)();u.logDebug(this.cache),u.logDebug(`get cache obj: ${this.cache}, ${t}, ${e}`),this.cache[t]=e;let i=(0,d.safeJsonStringify)(this.cache);u.logDebug(`STORAGE: ${t} @ ${this.cache}`),o.setItem(n,i)}getItem(e){return u.logDebug(`STORAGE >> getItem: ${e} @ ${this.cache}`),this.cache[e]}synchronizedCache(){const e=localStorage.getItem(p.cacheKey+this.subKey);if("undefined"===typeof e||null===e)return u.logDebug("with no cache"),void(this.cache={});if(u.logDebug(e),(null===e||void 0===e?void 0:e.length)>0){var t=(0,d.safeJsonParse)(e);this.cache=t}u.logDebug(`get cache obj: ${this.cache}`),"undefined"!==typeof this.cache&&null!=this.cache||(this.cache={})}getCachedPBKDF2InfoKey(){var e,t,n,o;const i=32,r=24;if(this.storeKey.length>0&&(null===(e=this.cipherIV)||void 0===e?void 0:e.length)>0)return{pw:this.storeKey,iv:this.cipherIV};let s=null===(t=this.getItem(c.OKXCONNECTOR_STORAGER_CRYPTO_SALT))||void 0===t?void 0:t.content;s||(s=(0,l.toHexString)(a.default.randomBytes(r)),this.saveContent(s,c.OKXCONNECTOR_STORAGER_CRYPTO_SALT));let d=null===(n=this.getItem(c.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD))||void 0===n?void 0:n.content;d||(d=(0,l.toHexString)(a.default.randomBytes(i)),this.saveContent(d,c.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD));let u=null===(o=this.getItem(c.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV))||void 0===o?void 0:o.content;if(!u){let e=a.default.randomBytes(16);u=(0,l.toHexString)(e),this.saveContent(u,c.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV)}return this.cipherIV=u,this.storeKey=(0,h.PBKDF2)(d,s,{iterations:10}).toString(),{pw:this.storeKey,iv:this.cipherIV}}encryptStoreMsg(e,t){(0,g.logDebug)(`encryptStoreMsg  encryptStoreMsg start ${Date.now()}`);let n=this.getCachedPBKDF2InfoKey();(0,g.logDebug)(`encryptStoreMsg  encryptStoreMsg mid ${Date.now()}`);var o=h.AES.encrypt(e,n.pw).toString();this.saveContent(o,t),(0,g.logDebug)(`encryptStoreMsg  encryptStoreMsg end ${Date.now()}`)}getAndDecrypt(e){(0,g.logDebug)(`encryptStoreMsg  getAndDecrypt start ${Date.now()}`);let t=this.getItem(e);if(t&&t.content){let e=this.getCachedPBKDF2InfoKey();(0,g.logDebug)(`encryptStoreMsg  getAndDecrypt mid ${Date.now()}`);let n=h.AES.decrypt(t.content,e.pw).toString(h.enc.Utf8);return(0,g.logDebug)(`encryptStoreMsg  getAndDecrypt end ${Date.now()}`),n}return null}clearCache(e=void 0){if(void 0===e){const e=(0,l.resolveLocalStorage)();this.cache={};let t=p.cacheKey+this.subKey;e.setItem(t,"")}else{let t=p.cacheKey+this.subKey;const n=(0,l.resolveLocalStorage)();u.logDebug(this.cache),this.cache[e]=null;let o=(0,d.safeJsonStringify)(this.cache);u.logDebug(`STORAGE: clean key ${e} @ ${this.cache}`),n.setItem(t,o)}}}t.Storage=p,p.cacheKey="OKXStorageKey"},4942:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE=t.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE=t.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE=t.OKXCONNECTOR_STORAGE_CIPHER_METHOD=t.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV=t.OKXCONNECTOR_STORAGER_CRYPTO_SALT=t.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD=t.OKXCONNECTOR_TON_KEY=t.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE=t.OKXCONNECTOR_TOKEN_CACHE=t.OKXCONNECTOR_JWT_KEY=t.OKXCONNECTOR_SESSION_PREFIX_KEY=t.OKXCONNECTOR_CRYPTO_KEY=t.OKXCONNECTOR_CACHE_KEY_DAPP=t.OKXCONNECTOR_CACHE_KEY=void 0,t.OKXCONNECTOR_CACHE_KEY="ck",t.OKXCONNECTOR_CACHE_KEY_DAPP="ck_dapp",t.OKXCONNECTOR_CRYPTO_KEY="cck_k",t.OKXCONNECTOR_SESSION_PREFIX_KEY="cspk_",t.OKXCONNECTOR_JWT_KEY="cjk_k",t.OKXCONNECTOR_TOKEN_CACHE="ct",t.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE="csp",t.OKXCONNECTOR_TON_KEY="OKXStorage_ctc",t.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD="scp",t.OKXCONNECTOR_STORAGER_CRYPTO_SALT="scs",t.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV="scpc",t.OKXCONNECTOR_STORAGE_CIPHER_METHOD="aes-256-cbc",t.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE="okx_connect_split_cache_key",t.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE="okx_connect_te_cache_key",t.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE="okx_connect_twe_cache_key"},1688:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletConnectionManagerEvent=t.WalletConnectionManagerTopicInfoCacheKey=void 0,t.WalletConnectionManagerTopicInfoCacheKey="wcmtic",t.WalletConnectionManagerEvent={RECEIVE_REQUEST:"payload"}},5178:function(e,t,n){"use strict";n(4114);var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r=e(t),s=0;s<r.length;s++)"default"!==r[s]&&o(n,t,r[s]);return i(n,t),n}}(),s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WalletConnectionManager=void 0;const c=n(2516),a=n(3962),l=n(4942),d=n(5534),u=n(9795),g=n(1688),h=n(4531),p=n(49),f=n(8391),O=n(8384),v=n(3372),_=n(5767),C=n(5058),E=r(n(9323)),y=n(9323),m=n(2581);class N{constructor(){this.events=new p.EventEmitter,this.communicateEvents=new p.EventEmitter,this.splitManager=new h.ConnectionSplitPackages("wallet"),E.logDebug("connect manager construct"),this.connectStorage=new f.Storage(l.OKXCONNECTOR_CACHE_KEY),this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new c.OKXWalletConnector(u.OKXCONNECTOR_WS_URL_1),this.packageId=Date.now(),this.sessionCryptoInfoMap=new Map,this.inLogin=!1,this.isLogined=!1}refreshPackageId(e=0){let t=Date.now()+e;t==this.packageId&&(this.packageId=t+1),this.packageId=t}saveCryptoKeyPair(e,t){let n=(0,C.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(n,l.OKXCONNECTOR_CRYPTO_KEY+e)}getCachedCryptoKeyPair(e){const t=this.connectStorage.getAndDecrypt(l.OKXCONNECTOR_CRYPTO_KEY+e),n=t;if("string"==typeof n){E.logDebug("get cached crypto key:"),E.logDebug(n);let e=(0,C.safeJsonParse)(n);return e}return this.connectStorage.clearCache(),null}saveJWTKeyPair(e){var t={publicKey:(0,O.toHexString)(e.publicKey),secretKey:(0,O.toHexString)(e.secretKey)};E.logDebug("save jwt kp");let n=(0,C.safeJsonStringify)(t);E.logDebug(n),this.connectStorage.encryptStoreMsg(n,l.OKXCONNECTOR_JWT_KEY),E.logDebug("after save jwt kp")}getCachedJWTKeyPair(){const e=this.connectStorage.getAndDecrypt(l.OKXCONNECTOR_JWT_KEY),t=e;if("string"==typeof t){E.logDebug("get cached jwt kp:"),E.logDebug(t);let e=(0,C.safeJsonParse)(t);E.logDebug("save jwt kp"),E.logDebug(e);var n={publicKey:(0,O.hexToByteArray)(e.publicKey),secretKey:(0,O.hexToByteArray)(e.secretKey)};return n}return(0,_.generateKeyPair)()}isTopicPublicKeyExist(e){return E.logDebug(`isTopicPublicKeyExist  ===> ${e}`),this.sessionCryptoInfoMap.get(e)}makeJWT(e){return s(this,void 0,void 0,(function*(){return yield(0,_.signJWT)(e,d.OKXCONNECTOR_JWT_WALLET_SIDE,d.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)}))}parseInternalMsg(e){try{let t=(0,C.safeJsonParse)(e),n=t["ivur-igbfft-ptjip"];if(n&&n.length>0){let e=(0,m.base64decode)(n,!0);return e.toString()}}catch(t){E.logError("parse internal msg",t)}}updateClientId(e,t){let n=this.sessionCryptoInfoMap.get(e);if((0,y.logDebug)("updateClientId",n,e,t),n&&t&&t.length>0){if(n.cid){let o=(0,O.getLastSixMd5Hash)(t);n.cid==o?n.dappPublicKey=t:E.logError("cid check failed",n,e,t)}else n.dappPublicKey=t;this.syncCacheSessionInfo()}return!1}parsePackage(e,t){return s(this,arguments,void 0,(function*(e,t,n=!1){var o,i,r,c,l,d,u,g,h,p,f,O,v,_,N,b,T;this.events.emit(t.id,t);let S=this.sessionCryptoInfoMap.get(e);E.logDebug("get sessionInfo for decrypt topic:",e),E.logDebug("get sessionInfo for decrypt:",t.id,e,S,this.sessionCryptoInfoMap);let w=!1;if(S&&t.params.data&&(null===(o=t.params.data)||void 0===o?void 0:o.message))if(null===(i=t.params.data)||void 0===i?void 0:i.isInternalData){let e=null===(r=t.params.data)||void 0===r?void 0:r.message,n=null===(c=t.params.data)||void 0===c?void 0:c.topic,o=this.parseInternalMsg(e);(0,y.logDebug)("parse internal origin: ",o),o&&o.length>0&&this.communicateEvents.emit("origin",o,n)}else try{let n=null===(l=t.params.data)||void 0===l?void 0:l.message;if(t.method&&t.method===a.CONNECT_METHOD_PUSH&&((0,y.logDebug)("checkExpire: update expire when get push"),this.updateExpireLimit(e)),n.trimStart().startsWith("{")){let o=this.splitManager.tryParseMessageSplitPayload(n);if(o){(0,y.logDebug)("parse split msg object: ",o),w=!0;let n={topicId:null===(u=null===(d=t.params)||void 0===d?void 0:d.data)||void 0===u?void 0:u.topic,messageId:null===(h=null===(g=t.params)||void 0===g?void 0:g.data)||void 0===h?void 0:h.messageId,messageObject:o,publishedAt:null===(f=null===(p=t.params)||void 0===p?void 0:p.data)||void 0===f?void 0:f.publishedAt},i=yield this.splitManager.onReceivedPackageCheck(n);if(i.completeMessageIdList&&i.completeMessageIdList.forEach((t=>s(this,void 0,void 0,(function*(){this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),t,e)})))),i.finalMessage){let t=S.crypto.decryptWallet(i.finalMessage,S.dappPublicKey);(0,y.logDebug)("<<< receive msg from split:",e,t),this.communicateEvents.emit(e,t)}}else{let t=(0,C.safeJsonParse)(n);if(t.method){if("session_info"==t.method){let n=t.params.sessionInfo,o=(0,m.base64decode)(n,!1);(0,y.logDebug)("wallet connection manager requset base64Content:",o),(0,y.logDebug)("base64Content:"+o);let i=o.toObject();this.updateClientId(e,i.clientId)}(0,y.logDebug)("<<< parse raw msg:",e,t),this.communicateEvents.emit(e,n)}}}else{let n=S.crypto.decryptWallet(null===(O=t.params.data)||void 0===O?void 0:O.message,S.dappPublicKey);(0,y.logDebug)("<<< receive msg:",e,n),this.communicateEvents.emit(e,n)}}catch(R){let n=S.crypto.decryptWallet(null===(v=t.params.data)||void 0===v?void 0:v.message,S.dappPublicKey);(0,y.logDebug)("<<< receive msg:",e,n),this.communicateEvents.emit(e,n)}if(!n&&(yield this.sendACK(t.id,!0),e&&!w)){let n=t;(null===(N=null===(_=n.params)||void 0===_?void 0:_.data)||void 0===N?void 0:N.messageId)&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),null===(T=null===(b=n.params)||void 0===b?void 0:b.data)||void 0===T?void 0:T.messageId,e))}}))}recovrySessionInfoFromCache(){let e=this.connectStorage.getAndDecrypt(g.WalletConnectionManagerTopicInfoCacheKey);if(E.logDebug("get cached sessionInfos:",e),e){let t=(0,C.safeJsonParse)(e);for(let e in t){let n=t[e];E.logDebug("make topicItem:",n);let o={topic:e,crypto:new v.SessionCrypto({publicKey:n.cryptoKeyPair.publicKey,secretKey:n.cryptoKeyPair.secretKey}),dappPublicKey:n.dappPublicKey,cid:n.cid};this.sessionCryptoInfoMap.set(e,o)}}E.logDebug("get cached sessionInfos map:",this.sessionCryptoInfoMap)}syncCacheSessionInfo(){let e={};for(let[n,o]of this.sessionCryptoInfoMap)E.logDebug("for each Keys",n),o&&(e[n]={cryptoKeyPair:o.crypto.stringifyKeypair(),dappPublicKey:o.dappPublicKey,cid:o.cid});let t=(0,C.safeJsonStringify)(e);E.logDebug("sync cache sessionInfos:",t),this.connectStorage.encryptStoreMsg(t,g.WalletConnectionManagerTopicInfoCacheKey)}cacheSessionInfo(e,t,n=!0){let o=t.dappPublicKey,i=[];for(let[r,s]of this.sessionCryptoInfoMap)E.logDebug("for each Keys",r),s.dappPublicKey==o&&(E.logDebug("duplicated dapp public key:",r,o),i.push(r));for(let[r,s]of this.sessionCryptoInfoMap)i.includes(r)&&this.sessionCryptoInfoMap.delete(r);return E.logDebug("cleaned connect session cache:",this.sessionCryptoInfoMap),this.sessionCryptoInfoMap.set(e,t),E.logDebug("cache sessionInfo:",e,t,this.sessionCryptoInfoMap),n&&this.syncCacheSessionInfo(),i}updateProtocolVersion(e,t){this.splitManager.updateTopicSenderVersion(e,t)}appendTopic(e,t,n){return s(this,void 0,void 0,(function*(){return(0,y.logDebug)("4.1. get append Topic:",e),new Promise(((o,i)=>s(this,void 0,void 0,(function*(){if(!this.isLogined){var r=new Error;return r.message="connection is not logined",r.name="append error",void i(r)}let s={topic:e,crypto:new v.SessionCrypto,dappPublicKey:t||"",cid:n},c=this.cacheSessionInfo(e,s,!1);yield this.subscribeTopics(Array.from([e])),this.refreshPackageId(),E.logDebug(`5. subscribe callback then fetch append message: ${this.packageId}, ${e}`),E.reportLog("5. subscribe callback then fetch append message");const a=(new Date).getTime();(0,y.logDebug)("Append --subscribe callback->",a-this.timeLog),o(c)}))))}))}confirmAppendingTopics(){this.syncCacheSessionInfo()}connect(){return s(this,void 0,void 0,(function*(){this.timeLog=(new Date).getTime(),(0,y.logDebug)("[Wallet] ConnectTime---enter->",this.timeLog),E.reportLog("wallet connect connect called");let e=Date.now().toString();var t=yield this.makeJWT(e);return E.logDebug(`generate jwt token: ${t}`),this.connectStorage.saveContent(t,"jwt"),this.recovrySessionInfoFromCache(),new Promise(((e,n)=>{this.inLogin=!0,this.connector.onOpen((()=>s(this,void 0,void 0,(function*(){E.logDebug("1. connector on open"),E.reportLog("1. wallet connect connect on open");const o=(new Date).getTime();(0,y.logDebug)("ConnectTime---open->",o-this.timeLog),this.events.once(this.packageId.toString(),(t=>s(this,void 0,void 0,(function*(){if(t&&t.error){E.logError("failed when login"),yield this.connector.disconnect();var o=new Error;o.message=t.error.message,o.name=t.error.code.toString(),n(o)}else this.isLogined=!0,e(),E.logDebug("3. subscribe cached topics",this.sessionCryptoInfoMap),E.reportLog("3. wallet connect connect subscribe cached topics"),this.sessionCryptoInfoMap.size>0&&(yield this.subscribeTopics(Array.from(this.sessionCryptoInfoMap.keys())))})))),E.logDebug("2. login called"),E.reportLog("2. wallet connect login called"),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_LOGIN,params:{token:t}})})))),this.connector.connect().catch((e=>{(0,y.logDebug)("WalletConnectionManager connect error",e),n(e)})),this.connector.addPackageParse((e=>{var t,n;E.logDebug("connect: parse package"),E.logDebug(e),"params"in e&&"data"in e["params"]?(null===(t=e.params.data)||void 0===t?void 0:t.topic)&&this.parsePackage(null===(n=e.params.data)||void 0===n?void 0:n.topic,e,e.method===a.CONNECT_METHOD_RECEIVE):this.parsePackage("",e,!0)}))}))}))}getSessionPublicKey(e){if(this.isTopicPublicKeyExist(e)){let t=this.sessionCryptoInfoMap.get(e);if(t)return(0,O.toHexString)(t.crypto.keyPair.publicKey)}}getCurrentCachedTopicIdList(){return Array.from(this.sessionCryptoInfoMap.keys())}sendDisconnect(e){return s(this,void 0,void 0,(function*(){this.refreshPackageId();const t={id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_DISCONNECT,params:{message:{topic:e,ttl:u.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}))}sendRecvDisconnect(e){return s(this,void 0,void 0,(function*(){this.refreshPackageId();const t={id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_RECV_DISCONNECT,params:{topic:e}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}))}disconnect(){return s(this,arguments,void 0,(function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(l.OKXCONNECTOR_TOKEN_CACHE),e||this.connectStorage.clearCache(l.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE)}))}sendRaw(e,t){return s(this,void 0,void 0,(function*(){t&&(yield this.sendMsg(t,e,u.OKXCONNECTOR_MESSAGE_TTL))}))}sendMsg(e,t,n){return s(this,void 0,void 0,(function*(){if(t){this.refreshPackageId();const o={id:this.packageId.toString(),method:a.CONNECT_METHOD_PUBLISH,jsonrpc:u.CONNECT_JSONRPC_VER,params:{message:{topic:e,message:t,ttl:n}}};this.events.once(this.packageId.toString(),(e=>s(this,void 0,void 0,(function*(){e&&e.error?E.logError(`@${(new Date).toUTCString()} >>> failed when send msg`):e&&!e.error&&E.logDebug(`CONNECTION @[${(new Date).toUTCString()}] >>> send msg with id ${this.packageId} successed`)})))),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}}))}send(e,t){return s(this,arguments,void 0,(function*(e,t,n=!1,o=u.OKXCONNECTOR_MESSAGE_TTL,i=!1){var r,s;if(E.logDebug(`message send =====> ${t}`),!this.isTopicPublicKeyExist(e))throw new Error("connection not finish");let c,a=null===(r=this.sessionCryptoInfoMap.get(e))||void 0===r?void 0:r.dappPublicKey,l=null===(s=this.sessionCryptoInfoMap.get(e))||void 0===s?void 0:s.crypto;i&&(c={message:t});let d=!1;if(l&&a&&!i){let e=l.encryptWallet(t,a);d=!0,c={message:e}}if(c){n&&l&&(c.clientId=(0,O.toHexString)(l.keyPair.publicKey));let t=(0,C.safeJsonStringify)(c);!i&&d?yield this.splitManager.sendSplitPackages(e,t,this.sendMsg.bind(this),this.sendRaw.bind(this)):yield this.sendMsg(e,t,o)}}))}sendACK(e,t){return s(this,arguments,void 0,(function*(e,t,n=void 0){if(!0===t){const t={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}else if(n){const t={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,error:{code:n.code,message:n.message}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}}))}sendReceive(e,t,n){return s(this,void 0,void 0,(function*(){const o={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:n}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}sendUnsubscribe(e){return s(this,void 0,void 0,(function*(){yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_UNSUB,params:{topic:e}});try{yield this.sendDisconnect(e)}catch(t){E.logError("send disconnect command failed",t)}this.sessionCryptoInfoMap.delete(e),this.syncCacheSessionInfo()}))}sendFetchAndConsumeMessages(e,t){return s(this,void 0,void 0,(function*(){this.events.once(e,(e=>s(this,void 0,void 0,(function*(){var n,o;if(e.result){var i=e.result.hasMore,r=e.result.data;if(r)for(let e=0;e<r.length;e++){let n=r[e];if(n&&n.topic==t){let e=n.messageId;yield this.connector.getMsgPayloadFromHistory(n),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e,t)}}i&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else E.logDebug(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(o=e.error)||void 0===o?void 0:o.message}`)})))),E.logDebug("5. send fetch more");const n=(new Date).getTime();(0,y.logDebug)("ConnectTime---5->",n-this.timeLog);const o={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}sendBatchFetchAndConsumeMessages(e,t){return s(this,void 0,void 0,(function*(){this.events.once(e,(e=>s(this,void 0,void 0,(function*(){var n,o;if(e.result){var i=e.result.hasMore,r=e.result.data;const n=e.result.disconnectedTopics;if(n)try{for(let e=0;e<n.length;e++){const t=n[e];if(t.topic){(0,y.logDebug)("send receive disconnect:",t.topic),yield this.sendRecvDisconnect(t.topic);let e=(0,C.safeJsonStringify)({requestId:t.publishedAt.toString(),method:a.CONNECT_METHOD_DISCONNECT}),n={messageId:t.publishedAt.toString(),message:(0,C.safeJsonStringify)({message:e}),topic:t.topic,publishedAt:t.publishedAt};yield this.connector.getMsgPayloadFromHistory(n)}}}catch(s){E.logError("disconnect topic fails",s)}if(r)for(let e=0;e<r.length;e++){let t=r[e];if(t&&t.topic){let n=this.splitManager.tryParseMessageSplitPayload(t.message);if(n)yield this.connector.getMsgPayloadFromHistory(t);else{let n=t.messageId;yield this.connector.getMsgPayloadFromHistory(t),this.refreshPackageId(e),yield this.sendReceive(this.packageId.toString(),n,t.topic)}}}i&&(this.refreshPackageId(),yield this.sendBatchFetchAndConsumeMessages(this.packageId.toString(),t))}else E.logDebug(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(o=e.error)||void 0===o?void 0:o.message}`)})))),E.logDebug("5. send fetch more"),E.reportLog("5. send fetch more");const n=(new Date).getTime();(0,y.logDebug)("ConnectTime---5->",n-this.timeLog);const o={id:e,jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_BATCH_FETCHMSG,params:{topics:t,withInternalData:!0}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}cleanCache(){return s(this,void 0,void 0,(function*(){this.connectStorage.clearCache()}))}saveSessionContent(e,t){t||this.connectStorage.clearCache(l.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let n=(0,C.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(n,l.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){let t=this.connectStorage.getAndDecrypt(l.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t){let e=(0,C.safeJsonParse)(t);return e}}subscribeTopics(e){return s(this,void 0,void 0,(function*(){(0,y.logDebug)("4. topicid list",e),E.reportLog("4. topicid list"),this.refreshPackageId();const t=(new Date).getTime();return(0,y.logDebug)("ConnectTime--subscribe callback->",t-this.timeLog),new Promise(((t,n)=>s(this,void 0,void 0,(function*(){let n=0;for(let o=0;o<e.length;++o){let i=e[o];this.refreshPackageId(o),this.events.once(this.packageId.toString(),(r=>s(this,void 0,void 0,(function*(){if(r&&r.error){E.logError("failed when subscribe"),yield this.connector.disconnect();var s=new Error;s.message=r.error.message,s.name=r.error.code.toString(),n+=1,n==e.length&&t()}this.refreshPackageId(o);const c=(new Date).getTime();if((0,y.logDebug)("ConnectTime--subscribe callback->",c-this.timeLog),n+=1,n==e.length){E.logDebug(`5. send fetch msg: ${this.packageId}, ${i}`),yield this.sendBatchFetchAndConsumeMessages(this.packageId.toString(),e),yield this.splitManager.init(this.sendRaw.bind(this));let n=this.checkExpire(i);n?((0,y.logDebug)("disconnect From topic expire"),yield this.activateDisconnect(i)):((0,y.logDebug)("extends expire check"),this.updateExpireLimit(i)),t()}})))),E.logDebug(`3. login callback then send subscribe: ${this.packageId}, ${i}`),E.reportLog("3. login callback then send subscribe");const r=(new Date).getTime();(0,y.logDebug)("ConnectTime---login callback->",r-this.timeLog),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){return E.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:u.CONNECT_JSONRPC_VER,method:a.CONNECT_METHOD_SUB,params:{topic:i}})}}))))}))}checkExpire(e){let t=!1;if(0==e.length)return(0,y.logDebug)("checkExpire: invalid topic"),t;let n=this.getSessionContent(l.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE);if(n&&n instanceof Object)try{let o=new Map(Object.entries(n)),i=o.get(e);i?Date.now()>i&&((0,y.logDebug)("checkExpire: connection is Expired"),t=!0):((0,y.logDebug)("checkExpire: not same connection"),t=!1)}catch(o){(0,y.logDebug)("checkExpire: cache error"),t=!1}else(0,y.logDebug)("checkExpire: not topic records"),this.updateExpireLimit(e),t=!1;return t}updateExpireLimit(e){(0,y.logDebug)(`update expire limit for topic: ${e}`);try{let t=this.getSessionContent(l.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE),n=new Map;t&&(n=new Map(Object.entries(t)));let o=Date.now()+u.OKXCONNECTOR_SESSION_LIVE_TTL;n.set(e,o),this.saveSessionContent(l.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE,Object.fromEntries(n))}catch(t){(0,y.logDebug)("update cache failed")}}activateDisconnect(e){return s(this,void 0,void 0,(function*(){let t=(0,C.safeJsonStringify)({requestId:"",method:a.CONNECT_METHOD_DISCONNECT}),n={messageId:"",message:(0,C.safeJsonStringify)({message:t}),topic:e,publishedAt:0};yield this.connector.getMsgPayloadFromHistory(n)}))}}t.WalletConnectionManager=N},5991:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.InjectConnector=void 0;const i=n(852),r=n(2581),s=n(1317);class c{constructor(){this.disconnectListener=[],this.providerMap=new Map,this.disconnectHandler=null,this.walletName="",this.icon="",this.walletNameKey="",this.enable=!0}setAccountChangeListener(e){(0,r.logDebug)("setAccountChangeListener: inject",e),this.accountChangeListener=e}setConnectionManager(e){this.connectionManager=e}getInjectProvider(e){if(e)for(const[t,n]of this.providerMap.entries())if(e.includes(t))return n}send(e,t){return o(this,void 0,void 0,(function*(){var n;try{(0,r.logDebug)("InjectEngine send  > request:",(0,r.safeJsonStringify)(e));let o=e;if("disconnect"===o.method)return yield this.disconnect(),this.disconnectListener.forEach((e=>e())),this.disconnectListener=[],void(null===(n=t.onAck)||void 0===n||n.call(t));yield this.checkWalletMatch();const s=this.getInjectProvider((0,r.getNamespaceKeyByChain)(o.chainId));if(s)return void s.send(o).then((e=>{var n;(0,r.logDebug)("InjectEngine ==>> send > result:",e),null===(n=t.resolve)||void 0===n||n.call(t,e)})).catch((n=>{var o;let s=n.code;4001===s&&(s=i.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR);let c={requestId:Date.now().toString(),method:e.method,error:{code:s,message:n.message}};(0,r.logDebug)("InjectEngine ==>> send > errorResponse:",JSON.stringify(c)),null===(o=t.resolve)||void 0===o||o.call(t,c)}));throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED)}catch(o){return(0,r.logDebug)("InjectEngine ==>> send  ===> error:",o),Promise.reject(o)}}))}checkWalletMatch(){return o(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{var n;let o=null===(n=this.connectionManager)||void 0===n?void 0:n.getSessionContent("connectSession");o||t(new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED)),this.restoreconnect(o,(n=>{n?e():t(new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED))}))}))}))}clearData(){this.connectResultListener=void 0}addDisconnectListener(e){this.disconnectListener.push(e)}setOnConnectResultListener(e){this.connectResultListener=e}connectManagerDisconnect(){return o(this,arguments,void 0,(function*(e=!1){}))}getCurrentConnectionReady(e){return!!e}getTag(){return s.OKX_INJECT_WALLET}toJSON(){return"inject-connector"}getSupportNameSpaces(){return Array.from(this.providerMap.keys())}}t.InjectConnector=c},2478:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppwalletConnector=void 0;const o=n(5138),i=n(1317),r=n(2581),s=n(2329),c=n(852);class a extends o.WsConnector{getType(){return i.CONNECTOR_TYPE.WS.OKX_APP_WALLET}constructor(){super(),this.walletName="OKX App",this.walletNameKey=""}getTag(){return i.OKX_APP_WALLET}openWallet(e,t){var n;let o=null!==t&&void 0!==t?t:c.OpenAppLinkType.UniversalLink;if(e&&e.connectRequest){(0,r.logDebug)(`appwallet-connector openwallet before useSHortLink engineConnectInfo.connectRequest JSON ${JSON.stringify(e)}`);let t=e.connectRequest;(0,r.useShortLink)()||(t=Object.assign(Object.assign({},e.connectRequest),{redirect:null!==(n=e.redirect)&&void 0!==n?n:"none"}));let{universalLink:i,deepLink:s}=(0,r.getOKXLink)(t);(0,r.openOKXDeeplinkWithFallback)(s,i,o)}else(0,r.isOS)("android")?(0,r.openDeeplinkWithFallback)(s.stackDeepLink,(()=>{})):(0,r.openOKXDeeplinkWithFallback)(s.standardDeeplink,s.shortUniversalLink,o)}}t.AppwalletConnector=a},1317:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECTOR_TYPE=t.STANDARD_INJECT_WALLET=t.OTHER_INJECT_WALLET=t.OKX_TG_WALLET=t.OKX_APP_WALLET=t.OKX_INJECT_WALLET=void 0,t.getTagByappName=r;const o=n(852),i=n(5953);function r(e){var n="";if(e)switch(e){case o.OKXWalletName:n=t.OKX_APP_WALLET;break;case i.OKXMiniWalletName:n=t.OKX_TG_WALLET;break;case i.OKXInjectWalletName:n=t.OKX_INJECT_WALLET}return n||e||""}t.OKX_INJECT_WALLET="okx_inject_wallet",t.OKX_APP_WALLET="okx_app_wallet",t.OKX_TG_WALLET="okx_tg_wallet",t.OTHER_INJECT_WALLET="other_inject_wallet",t.STANDARD_INJECT_WALLET="standard_inject_wallet",t.CONNECTOR_TYPE={WS:{OKX_APP_WALLET:100,OKX_TG_WALLET:110},INJECT:{OKX_INJECT_WALLET:200,STANDARD_INJECT_WALLET:210},KEYLESS:{APPLE_WALLET:300,GOOGLE_WALLET:310}}},4004:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ThirdpartInjectConnector=t.OkxwalletInjectTonsdkConnector=t.OkxwalletInjectConnector=t.WsConnector=t.TgwalletConnector=t.InjectConnector=t.AppwalletConnector=void 0;var r=n(2478);Object.defineProperty(t,"AppwalletConnector",{enumerable:!0,get:function(){return r.AppwalletConnector}}),i(n(1317),t);var s=n(5991);Object.defineProperty(t,"InjectConnector",{enumerable:!0,get:function(){return s.InjectConnector}});var c=n(3284);Object.defineProperty(t,"TgwalletConnector",{enumerable:!0,get:function(){return c.TgwalletConnector}});var a=n(5138);Object.defineProperty(t,"WsConnector",{enumerable:!0,get:function(){return a.WsConnector}});var l=n(9626);Object.defineProperty(t,"OkxwalletInjectConnector",{enumerable:!0,get:function(){return l.OkxwalletInjectConnector}});var d=n(6803);Object.defineProperty(t,"OkxwalletInjectTonsdkConnector",{enumerable:!0,get:function(){return d.OkxwalletInjectTonsdkConnector}});var u=n(1191);Object.defineProperty(t,"ThirdpartInjectConnector",{enumerable:!0,get:function(){return u.ThirdpartInjectConnector}})},9626:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OkxwalletInjectConnector=void 0;const i=n(5991),r=n(852),s=n(6673),c=n(108),a=n(1372),l=n(7475),d=n(8096),u=n(728),g=n(2581),h=n(5953),p=n(5961),f=n(8097),O=n(1317);class v extends i.InjectConnector{getType(){return O.CONNECTOR_TYPE.INJECT.OKX_INJECT_WALLET}constructor(){super(),this.walletName="OKX Wallet",this.walletNameKey="walletModal.mobileConnectionModal.connectInjected",this.providerMap.set(r.NameSpaceKeyEip155,new s.Eip155Provider),this.providerMap.set(r.NameSpaceKeySOL,new c.SolProvider),this.providerMap.set(r.NameSpaceKeyAptos,new a.AptosProvider),this.providerMap.set(r.NameSpaceKeyTON,new l.TONProvider),this.providerMap.set(r.NameSpaceKeySui,new d.SuiProvider),this.providerMap.set(r.NameSpaceKeyBtc,new u.BtcProvider)}openWallet(e,t){return o(this,void 0,void 0,(function*(){var t,n,o;if((0,g.logDebug)("InjectEngine connect begin:",JSON.stringify(e)),!e)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR);this.dappInfo=e.connectRequest.dAppInfo;var i=e.connectRequest;try{if(!window||!window.okxwallet)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR);if(i.requests){let e=i.requests.find((e=>"requestAccounts"===e.name)),c=yield window.okxwallet.getVersion(),a={method:"connect",requestId:i.requestId,payload:{wallet:{platform:null!==(t=navigator.platform)&&void 0!==t?t:"/",appName:h.OKXInjectWalletName,appVersion:null!==c&&void 0!==c?c:"1.0.0",maxProtocolVersion:1},responses:[]}},l={name:"requestAccounts",accounts:[]};a.payload.responses.push(l),yield this.disconnect();const d=null!==(n=e.requiredNamespaces)&&void 0!==n?n:[],u=null!==(o=e.optionalNamespaces)&&void 0!==o?o:[];let g=!0,f=!1;if(d.length+u.length===1&&!(0,p.isDevice)("mobile")){const e=1===d.length?d[0]:u[0],t=this.getInjectProvider(e.namespace);let n=yield null===t||void 0===t?void 0:t.singleConnect(e,this.dappInfo);n&&(f=!0,g=!1)}var s=yield this.getAccountByRequestWallets(g,!1,f,d,u);if(!s)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect requestWallets is null");if(l.accounts.push(...s),0===l.accounts.length)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect connectAccounts is null");this.connectResultListener&&(this.disconnectHandler&&window.okxwallet.removeListener("disconnect",this.disconnectHandler),this.disconnectHandler=()=>{console.log("window.okxwallet disconnect:"),this.disconnectListener.forEach((e=>e())),this.disconnectListener=[]},window.okxwallet.on("disconnect",this.disconnectHandler),this.connectResultListener(a,this))}}catch(a){var c=r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR;a instanceof r.OKXConnectError&&(c=a.code,a.message),this.connectResultListener&&this.connectResultListener({requestId:"-1",method:"connect_error",payload:{code:c}},this)}}))}checkAccountChanged(){return o(this,void 0,void 0,(function*(){var e;try{let t=null===(e=this.connectionManager)||void 0===e?void 0:e.getSessionContent("connectSession");if(!t)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);(0,g.logDebug)("inject-connector checkAccountChanged --sessionInfo:",JSON.stringify(t));let n=this.getRequireNameSpaceFromSession(t);(0,g.logDebug)("inject-connector checkAccountChanged --requiredNamespaces:",JSON.stringify(n));let o=yield this.getAccountByRequestWallets(!1,!0,!1,n,[]);if((0,g.logDebug)("inject-connector checkAccountChanged --accounts:",JSON.stringify(o)),!o)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect requestWallets is null");{let e={};(0,f.buildAccountNameSpaces)(o,e),this.compareAndModifyNamespaces(t.namespaces,e)||((0,g.logDebug)("inject-connector checkAccountChanged --result sessionLocal:",JSON.stringify(t)),this.accountChangeListener?((0,g.logDebug)("inject-connector checkAccountChanged -accountChangeListener:",this.accountChangeListener),this.accountChangeListener(t)):((0,g.logDebug)("inject-connector checkAccountChanged disconnect:"),yield this.disconnect()))}}catch(t){throw(0,g.logDebug)("inject-connector restoreconnect catch error",JSON.stringify(t)),t}}))}compareAndModifyNamespaces(e,t){let n=!0;for(const o in e)if(t[o]){const i=e[o],r=t[o];(0,g.logDebug)("inject-connector checkAccountChanged ns1:",JSON.stringify(i)),(0,g.logDebug)("inject-connector checkAccountChanged ns2:",JSON.stringify(r));const s=JSON.stringify([...i.accounts].sort())===JSON.stringify([...r.accounts].sort());s||(n=!1,i.accounts=[...r.accounts],i.extra=Object.assign({},r.extra),i.payload=Object.assign({},r.payload)),(0,g.logDebug)("inject-connector checkAccountChanged new ns1:",JSON.stringify(i))}return(0,g.logDebug)(`inject-connector checkAccountChanged compareAndModifyNamespaces ===> ${n}`),n}restoreconnect(e,t){var n;if(window.okxwallet){this.dappInfo=null===(n=e.sessionConfig)||void 0===n?void 0:n.dappInfo,(0,g.logDebug)("inject-connector restoreconnect --sessionInfo:",JSON.stringify(e));var o=this.getRequireNameSpaceFromSession(e);(0,g.logDebug)("inject-connector restoreconnect --requiredNamespaces:",JSON.stringify(o)),this.getAccountByRequestWallets(!1,!1,!1,o,[]).then((n=>{(0,g.logDebug)("inject-connector restoreconnect --accounts:",JSON.stringify(n));let o=!0;for(let t in e.namespaces){var i=n.find((e=>e.namespace===t)),s=e.namespaces[t].accounts;if(!i)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"resotreconnect error: accountItem error");let c=s;t===r.NameSpaceKeyAptos&&c&&c.length>0&&(c=s.map((e=>(0,g.replaceChainNameToChainId)(e))));const a=i.addresses.length===c.length&&i.addresses.slice().sort().every(((e,n)=>{if(t===r.NameSpaceKeyAptos){let t=c.slice().sort()[n];return(0,g.logDebug)("check aptos address -value and aptosAdd--",e,t),t===e}return e===c.slice().sort()[n]}));a||(o=!1)}if(!o)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"resotreconnect error: address not as same as session");t(e)})).catch((e=>{(0,g.logDebug)("inject-connector restoreconnect catch error",JSON.stringify(e)),t(null)}))}else t(null)}getRequireNameSpaceFromSession(e){var t,n,o=[];for(let i in e.namespaces){let s=e.namespaces[i],c={namespace:i,chains:s.chains};if(i===r.NameSpaceKeyAptos){let e=[];s.chains.forEach((t=>{let n=(0,g.replaceChainNameToChainId)(t);e.push(n)})),c={namespace:i,chains:e}}else if(i===r.NameSpaceKeyTON){let e,o;(null===(t=s.payload)||void 0===t?void 0:t.ton_proof)&&(e=null===(n=s.payload)||void 0===n?void 0:n.ton_proof,e.proof.payload&&(o={name:"ton_proof",payload:e.proof.payload})),c={namespace:i,chains:s.chains,params:{ton_addr:{name:"ton_addr"},ton_proof:o}}}o.push(c)}return o}getAccountByRequestWallets(e,t,n,i,s){return o(this,void 0,void 0,(function*(){try{var o=[],c=[];if((0,p.isDevice)("mobile")){var a=yield window.okxwallet.connectWallet(e,{requiredNamespaces:i,optionalNamespaces:s});o.push(a)}else o=yield window.okxwallet.requestWallets(e);var l=[...null!==i&&void 0!==i?i:[],...null!==s&&void 0!==s?s:[]];let d,u=o[0];if((0,g.logDebug)(" InjectEngine connect connectAccounts:",JSON.stringify(u)),l&&u&&u.address)for(const[o,i]of this.providerMap.entries()){let r=yield i.parseConnectResponse(e,t,n,l,u,this.dappInfo);r&&(d=o,c.push(r))}let h=i.every((e=>{let t=c.find((t=>t.namespace===e.namespace));if(t){let n=e.chains.every((e=>{let n=t.addresses.find((t=>t.startsWith(e+":")));return!!n}));return n}return!1}));if((0,g.logDebug)("InjectEngine connect requiredNamespaces:",JSON.stringify(i)),(0,g.logDebug)("InjectEngine connect accountResult:",JSON.stringify(c)),!h)throw yield this.disconnect(),new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED);return(0,p.isDevice)("mobile")||(this.configEventWithKey(d),yield window.okxwallet.requestWallets(e)),c}catch(d){if(d&&"object"===typeof d&&"code"in d&&4001===d.code)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR);throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR)}}))}configEventWithKey(e){var t,n;for(let o in this.providerMap)null===(t=this.providerMap.get(o))||void 0===t||t.removeListener();null===(n=this.getInjectProvider(e))||void 0===n||n.addAccountChangedListener((()=>{this.checkAccountChanged().catch((e=>{console.log("window.okxwallet configEventWithKey error: ",e)}))}))}disconnect(){return o(this,void 0,void 0,(function*(){(0,g.logDebug)("InjectEngine ==>> disconnect  okxwallet.disconnect()"),window.okxwallet&&(yield window.okxwallet.disconnect(),(0,g.logDebug)("InjectEngine ==>> disconnect end okxwallet.disconnect()"))}))}}t.OkxwalletInjectConnector=v},6803:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OkxwalletInjectTonsdkConnector=void 0;const i=n(852),r=n(2581),s=n(5961),c=n(9626),a=n(1317);class l extends c.OkxwalletInjectConnector{getType(){return a.CONNECTOR_TYPE.INJECT.OKX_INJECT_WALLET}constructor(){super(),this.walletName="OKX Wallet extension",this.walletNameKey="walletModal.mobileConnectionModal.connectInjected"}checkWalletMatch(){return o(this,void 0,void 0,(function*(){var e,t,n;null===(e=this.connectionManager)||void 0===e||e.tonsdkConnectStorage.synchronizedCache();let o=null===(t=this.connectionManager)||void 0===t?void 0:t.tonsdkConnectStorage.getItem("ton_connect_info_adapter_universal");if(!o||!(null===o||void 0===o?void 0:o.content))throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR);const c=null===o||void 0===o?void 0:o.content;let a,l=JSON.parse(c),d=l.connectEvent.payload.items.find((e=>"name"in e&&"ton_addr"===e.name));if(this.dappInfo=l.dappInfo,d&&"address"in d&&(a=d.address),!a)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);if((0,r.logDebug)(`inject-connector localTonaddress : ${a}`),(0,s.isDevice)("mobile")){let e;e={namespace:i.NameSpaceKeyTON,chains:[i.TON_CHAINS.MAINNET],params:{ton_addr:{name:"ton_addr"}}};let t=yield this.getAccountByRequestWallets(!1,!1,!1,[e],[]);if(t&&1==t.length){let e=t[0],o=null===(n=e.data)||void 0===n?void 0:n.ton_addr,i=null===o||void 0===o?void 0:o.address;if(a===i)return}}else{let e=yield window.okxTonWallet.tonconnect.restoreConnection();if("connect"===e.event){let t=e.payload.items.find((e=>"ton_addr"===e.name)).address;if(t==a)return}}throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED)}))}}t.OkxwalletInjectTonsdkConnector=l},3284:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TgwalletConnector=void 0;const o=n(5138),i=n(1317),r=n(2581);class s extends o.WsConnector{getType(){return i.CONNECTOR_TYPE.WS.OKX_TG_WALLET}constructor(){super(),this.walletName="OKX Mini Wallet",this.walletNameKey=""}getTag(){return i.OKX_TG_WALLET}openWallet(e,t){var n,o;e&&e.connectRequest&&(o=(0,r.encodeTWAConnectURLParams)(Object.assign(Object.assign({},e.connectRequest),{redirect:"none"})));var i=(0,r.getTelegramWalletTWAUrl)(o,null!==(n=null===e||void 0===e?void 0:e.tmaReturnUrl)&&void 0!==n?n:"back");(0,r.openOKXTMAWalletlinkWithFallback)(i)}}t.TgwalletConnector=s},1191:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ThirdpartInjectConnector=void 0;const i=n(5991),r=n(852),s=n(1317),c=n(2581);class a extends i.InjectConnector{getType(){return this.walletName===r.AptosGoogleWalletName?s.CONNECTOR_TYPE.KEYLESS.GOOGLE_WALLET:this.walletName===r.AptosAppleWalletName?s.CONNECTOR_TYPE.KEYLESS.APPLE_WALLET:s.CONNECTOR_TYPE.INJECT.STANDARD_INJECT_WALLET}constructor(e){super(),this.walletName=e.walletName,e.wallets.forEach(((e,t)=>{this.providerMap.set(t,e)})),this.icon=e.icon}registerWallet(e,t){this.providerMap.set(e,t)}getTag(){var e;return s.STANDARD_INJECT_WALLET+(null!==(e=this.walletName)&&void 0!==e?e:"")}getWalletVersion(){return o(this,void 0,void 0,(function*(){const e=this.providerMap.values().next().value;if(!e)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);return e.getVersion()}))}openWallet(e,t){return o(this,void 0,void 0,(function*(){var t,n;if((0,c.logDebug)("InjectEngine connect begin:",JSON.stringify(e)),!e)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR);this.dappInfo=e.connectRequest.dAppInfo;var o=e.connectRequest;try{if(o.requests){let e=o.requests.find((e=>"requestAccounts"===e.name));const i=null!==(t=e.requiredNamespaces)&&void 0!==t?t:[],s=null!==(n=e.optionalNamespaces)&&void 0!==n?n:[];let c;if(i.length+s.length===1){const e=1===i.length?i[0]:s[0],t=this.providerMap.get(e.namespace);if(this.addListener(e.namespace),!t)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"openWallet: provider not found");c=yield this.getResponseByConnect(t)}this.connectResultListener&&c&&this.connectResultListener(c,this)}}catch(s){var i=r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR;s instanceof r.OKXConnectError&&(i=s.code,s.message),this.connectResultListener&&this.connectResultListener({requestId:"-1",method:"connect_error",payload:{code:i}})}}))}getResponseByConnect(e){return o(this,void 0,void 0,(function*(){var t,n;let o={method:"connect",requestId:Date.now().toString(),payload:{wallet:{platform:null!==(t=navigator.platform)&&void 0!==t?t:"/",appName:s.STANDARD_INJECT_WALLET+this.walletName,appVersion:null!==(n=this.getWalletVersion())&&void 0!==n?n:"1.0.0",maxProtocolVersion:1},responses:[]}},i={name:"requestAccounts",accounts:[]};return o.payload.responses.push(i),i.accounts.push(yield this.getAccount(e)),o}))}getAccount(e){return o(this,void 0,void 0,(function*(){return e.getAccount()}))}disconnect(){return o(this,void 0,void 0,(function*(){yield Promise.all([...this.providerMap.values()].map((e=>e.disconnect())))}))}onDisconnect(){this.disconnectListener.forEach((e=>e())),this.disconnectListener=[]}restoreconnect(e,t){const n=Object.keys(e.namespaces),o=1===n.length;if(!o)return void t(null);const i=this.getInjectProvider(n[0]);if(!i)return t(null);i.getAccount().then((o=>{var i;let r=null!==(i=null===o||void 0===o?void 0:o.addresses)&&void 0!==i?i:[""];e.namespaces[n[0]].accounts[0].includes(r[0])?t(e):t(null)})).catch((e=>{t(null)}))}checkAccountChanged(e,t){return o(this,void 0,void 0,(function*(){var n,o;try{let i=null===(n=this.connectionManager)||void 0===n?void 0:n.getSessionContent("connectSession");if(t&&i.namespaces[e].accounts.includes(t))return;let r=this.getInjectProvider(e);if(r){let t=yield this.getResponseByConnect(r);if(t&&i){let n=t.payload.responses,r=n[0].accounts[0];i.namespaces[e].accounts=r.addresses,i.namespaces[e].extra=r.extra,i.namespaces[e].rpcMap=void 0,i.namespaces[e].methods=r.methods,null===(o=this.accountChangeListener)||void 0===o||o.call(this,i)}}}catch(i){yield this.disconnect()}}))}addListener(e){var t,n;for(let o in this.providerMap)null===(t=this.providerMap.get(o))||void 0===t||t.removeListener();null===(n=this.getInjectProvider(e))||void 0===n||n.addAccountChangedListener((t=>{t?this.checkAccountChanged(e,t).catch((e=>{})):this.onDisconnect()}))}supportNamespaceAndChains(e,t){let n=this.providerMap.get(e);return!!n&&n.supportChains(t)}}t.ThirdpartInjectConnector=a},5138:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WsConnector=void 0;const i=n(5058),r=n(9323);class s{constructor(){this.disconnectListener=[],this.walletName="",this.walletNameKey="",this.enable=!0,this.icon="",this.pendingRequests=new Map,(0,r.getDefaultReporter)().beginReport()}setAccountChangeListener(e){this.accountChangeListener=e}setConnectionManager(e){this.connectionManager=e}addConnectionListener(){var e;null===(e=this.connectionManager)||void 0===e||e.addListener("sdk_response",((e,t)=>{var n=(0,i.safeJsonParse)(t);(0,r.logDebug)(`Engine ==>> addListener ==> success ==> ${n}`),this.handleResponse(e,n)}),(function(){}))}addDisconnectListener(e){this.disconnectListener.push(e)}connectManagerDisconnect(){return o(this,arguments,void 0,(function*(e=!1){var t;yield null===(t=this.connectionManager)||void 0===t?void 0:t.disconnect(e)}))}openWallet(e,t){}bindRequestForPromise(e,t){this.pendingRequests.set(e,t)}send(e,t,n){return o(this,void 0,void 0,(function*(){var o,s;try{delete e.injectParams}catch(a){}(0,r.logDebug)("Engine ==>> send  request==>",JSON.stringify(e));const c=this.getRequestId();try{let a=yield null===(o=this.connectionManager)||void 0===o?void 0:o.send(JSON.stringify(Object.assign(Object.assign({},e),{requestId:c})),n);a&&(null===(s=this.connectionManager)||void 0===s||s.events.once(a.toString(),(e=>{var n;(0,r.logDebug)(`Engine ==> send => onAck => ${(0,i.safeJsonStringify)(e)}`),e&&e.result&&(null===(n=t.onAck)||void 0===n||n.call(t))}))),t.resolve&&this.bindRequestForPromise(c,t.resolve)}catch(a){return Promise.reject(a)}}))}restoreconnect(e,t){return o(this,void 0,void 0,(function*(){var n;yield null===(n=this.connectionManager)||void 0===n?void 0:n.restoreConnect(e.topic),t(e)}))}restoreconnectFromTopic(e){return o(this,void 0,void 0,(function*(){var t;yield null===(t=this.connectionManager)||void 0===t?void 0:t.restoreConnect(e)}))}getRequestId(){const e=Date.now().toString();return(0,r.logDebug)("Engine ==>> getRequestId ==>",e),e}handleResponse(e,t){if((0,r.logDebug)(`Engine ==>> handleResponse_1  ======>response: ${(0,i.safeJsonStringify)(t)}`,e),"requestId"in t){(0,r.logDebug)("Engine ==>> handleResponse_2  ===> in response");let e=t.requestId;const n=this.pendingRequests.get(e);n?((0,r.logDebug)("Engine ==>> handleResponse_3  ===> find resolve:",n),n(t),this.pendingRequests.delete(e)):((0,r.logDebug)("Engine ==>> handleResponse_3  ===> not find resolve:"),"disconnect"===t.method&&(this.disconnectListener.forEach((e=>e())),this.disconnectListener=[],this.clearData()))}}getCurrentConnectionReady(){var e;return!!(null===(e=this.connectionManager)||void 0===e?void 0:e.getCurrentConnectionReady())}saveSessionContent(e,t){var n;null===(n=this.connectionManager)||void 0===n||n.saveSessionContent(e,t)}getSessionContent(e){var t;return null===(t=this.connectionManager)||void 0===t?void 0:t.getSessionContent(e)}setOnConnectResultListener(e){this.connectResultListener=e}getTag(){return""}toJSON(){return"ws-connector"}clearData(){this.pendingRequests.clear()}}t.WsConnector=s},3372:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionCrypto=void 0;const i=o(n(998)),r=n(8384);class s{constructor(e=void 0){this.nonceLength=24,this.sessionKeyPair=e?this.createKeypairFromString(e):this.createKeypair()}createKeypair(){return i.default.box.keyPair()}createKeypairFromString(e){return{publicKey:(0,r.hexToByteArray)(e.publicKey),secretKey:(0,r.hexToByteArray)(e.secretKey)}}createNonce(){return i.default.randomBytes(this.nonceLength)}get keyPair(){return this.sessionKeyPair}encrypt(e,t){const n=(new TextEncoder).encode(e),o=this.createNonce(),s=i.default.box(n,o,(0,r.hexToByteArray)(t),this.keyPair.secretKey);let c=(0,r.concatUint8Arrays)(o,s);var a=(0,r.toHexString)(c),l=(new TextEncoder).encode(a);return(0,r.base64encode)(l,!1)}encryptWallet(e,t){const n=(new TextEncoder).encode(e),o=this.createNonce(),s=i.default.box(n,o,(0,r.hexToByteArray)(t),this.keyPair.secretKey);let c=(0,r.concatUint8Arrays)(o,s);return(0,r.base64encode)(c,!1)}decrypt(e,t){let n=(0,r.base64decode)(e,!0),o=n.toUint8Array();const[s,c]=(0,r.splitToUint8Arrays)(o,this.nonceLength),a=i.default.box.open(c,s,(0,r.hexToByteArray)(t),this.keyPair.secretKey);if(!a)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${(0,r.toHexString)(this.keyPair.publicKey)} \n keypair secretkey: ${(0,r.toHexString)(this.keyPair.secretKey)}`);return(new TextDecoder).decode(a)}decryptWallet(e,t){let n=(0,r.base64decode)(e,!0),o=(0,r.hexToByteArray)(n.toString());const[s,c]=(0,r.splitToUint8Arrays)(o,this.nonceLength),a=i.default.box.open(c,s,(0,r.hexToByteArray)(t),this.keyPair.secretKey);if(!a)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${(0,r.toHexString)(this.keyPair.publicKey)} \n keypair secretkey: ${(0,r.toHexString)(this.keyPair.secretKey)}`);return(new TextDecoder).decode(a)}stringifyKeypair(){return{publicKey:(0,r.toHexString)(this.keyPair.publicKey),secretKey:(0,r.toHexString)(this.keyPair.secretKey)}}}t.SessionCrypto=s},523:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(8530),t),i(n(852),t),i(n(2581),t),i(n(6673),t),i(n(4004),t)},1623:function(e,t){"use strict";function n(){return"undefined"!==typeof o("okxwallet")}function o(e){const t=(e,n)=>{const[o,...i]=n.split("."),r=e[o];if(r)return 0===i.length?r:t(r,i.join("."))};if("undefined"!==typeof window)return t(window,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.BtcMethods=t.SuiMethods=t.TONMethods=t.AptosMethods=t.SOLANAMethods=t.Eip55Methods=void 0,t.hasOKXInjectedProvider=n,t.Eip55Methods=["personal_sign","eth_signTypedData_v4","eth_sendTransaction","wallet_addEthereumChain","wallet_watchAsset","wallet_switchEthereumChain","eth_requestAccounts","eth_accounts","eth_chainId"],t.SOLANAMethods=["solana_signTransaction","solana_signMessage","solana_signAllTransactions","solana_signAndSendTransaction"],t.AptosMethods=["aptos_signMessage","aptos_signTransaction","aptos_signAndSubmitTransaction"],t.TONMethods=["ton_sendTransaction"],t.SuiMethods=["sui_signMessage","sui_signPersonalMessage","sui_signTransactionBlock","sui_signAndExecuteTransactionBlock"],t.BtcMethods=["btc_signMessage","btc_signPsbts","btc_send","btc_sendInscription","btc_signAndPushPsbt","btc_inscribeTransfer","btc_sendRunes"]},6673:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(1623),t),i(n(1987),t),i(n(8775),t),i(n(3639),t)},1372:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AptosProvider=void 0;const i=n(852),r=n(2581),s=n(1623),c=n(5961),a=n(149),l=Object.freeze(["637","70000060","70000066"]),d=new Map;d.set("aptos:637","Mainnet"),d.set("aptos:70000060","Movement Testnet"),d.set("aptos:70000066","Movement Mainnet");class u{send(e){return o(this,void 0,void 0,(function*(){try{(0,r.logDebug)("AptosProvider send request:",(0,r.safeJsonStringify)(e)),yield this.restoreConnect();let t=yield window.okxwallet.aptos.network(),n=this.searchChainIdToInjectChainName(e.chainId);if((0,r.logDebug)("AptosProvider send network and searchNetwork:",t,"-----",n),!t||!n||t.toLowerCase()!==n.toLowerCase())throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Please switch your wallet link to '${n}'`);const o=e.method;let s;switch(o){case"aptos_signMessage":if(e.injectParams){let t=yield window.okxwallet.aptos.signMessage(e.injectParams);return s={method:e.method,result:t.signature,injectResult:t},(0,r.logDebug)("AptosProvider send result:",(0,r.safeJsonStringify)(s)),s}throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${o}'`);case"aptos_signTransaction":{(0,r.logDebug)("AptosProvider Method>>>> :",o);let t=yield window.okxwallet.aptos.signTransaction(e.params);return s={method:e.method,result:t},(0,r.logDebug)("AptosProvider send result:",(0,r.safeJsonStringify)(s)),s}case"aptos_signAndSubmitTransaction":{(0,r.logDebug)("AptosProvider Method>>>> :",o);let t=yield window.okxwallet.aptos.signAndSubmitTransaction(e.params);return s={method:e.method,result:t.hash},(0,r.logDebug)("AptosProvider send result:",(0,r.safeJsonStringify)(s)),s}default:throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,` method: '${o}'`)}}catch(t){throw(0,r.logDebug)("AptosProvider send error:",t),t}}))}searchChainIdToInjectChainName(e){let t=e;return d.forEach(((n,o)=>{e.includes(o)&&(t=n)})),t}disconnect(){}restoreConnect(){return(0,c.isDevice)("mobile")?this.connect():Promise.resolve()}parseConnectResponse(e,t,n,a,d,u){return o(this,void 0,void 0,(function*(){let e=[];a.forEach((t=>{t.namespace===i.NameSpaceKeyAptos&&e.push(...t.chains)}));let t,n=[],o={};if((0,r.logDebug)("AptosProvider parseConnectResponse connectChain",JSON.stringify(e)),!(0,c.isDevice)("mobile")&&e&&e.length>0){let e=yield window.okxwallet.aptos.connect();t=e.publicKey}if(e.forEach((e=>{let i=d.address.find((t=>l.includes(t.chainId)&&637===t.coinType||t.namespaceChainId===e));i&&(n.push(e+":"+i.address),o[e]={publicKey:i.publicKey?i.publicKey:t})})),(0,r.logDebug)("AptosProvider parseConnectResponse addresses",JSON.stringify(n)),n&&n.length>0){let e={namespace:i.NameSpaceKeyAptos,addresses:n,methods:[...s.AptosMethods],extra:o};return e}}))}connect(){return o(this,void 0,void 0,(function*(){return window.okxwallet.aptos.connect()}))}singleConnect(){return this.connect()}addAccountChangedListener(e){window.okxwallet.aptos.onAccountChange((t=>{console.log("window.okxwallet configEventWithKey_aptos:",Date.now(),a.key,JSON.stringify(t)),t&&e()}))}removeListener(){}}t.AptosProvider=u},108:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SolProvider=void 0;const r=n(852),s=n(2581),c=i(n(4920)),a=n(5961),l=n(1623);class d{constructor(){this.accountChangedSolanaPublicKeyHandler=null}send(e){return o(this,void 0,void 0,(function*(){var t;try{yield this.restoreConnect(),(0,s.logDebug)("SolProvider send request:",JSON.stringify(e));const i=e.method;let a;if(!e.injectParams)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${i}'`);switch(i){case"solana_signMessage":if(e.injectParams&&"object"===typeof e.injectParams&&"message"in e.injectParams){var n=null===(t=e.injectParams)||void 0===t?void 0:t.message;const o=(new TextEncoder).encode(n),i=yield window.okxwallet.solana.signMessage(o,"utf8");return a={method:e.method,result:c.default.encode(i.signature)},(0,s.logDebug)("SolProvider send result:",JSON.stringify(i)),a}throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${i}'`);case"solana_signTransaction":{let t=yield window.okxwallet.solana.signTransaction(e.injectParams);return(0,s.logDebug)("SolProvider send bufferResult:",JSON.stringify(t)),a={method:e.method,injectResult:t},(0,s.logDebug)("SolProvider send result:",(0,s.safeJsonStringify)(a)),a}case"solana_signAllTransactions":{let t=yield window.okxwallet.solana.signAllTransactions(e.injectParams);return(0,s.logDebug)("SolProvider send result:",(0,s.safeJsonStringify)(t)),a={method:e.method,injectResult:t},a}case"solana_signAndSendTransaction":var o=yield window.okxwallet.solana.signAndSendTransaction(e.injectParams);return(0,s.logDebug)("SolProvider send result:",(0,s.safeJsonStringify)(o)),a={method:e.method,injectResult:o},a;default:throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`method: '${i}'`)}}catch(i){throw(0,s.logDebug)("SolProvider send error:",i),i}}))}disconnect(){}restoreConnect(){return(0,a.isDevice)("mobile")?this.connect():Promise.resolve()}parseConnectResponse(e,t,n,i,c,a){return o(this,void 0,void 0,(function*(){let e=[];i.forEach((t=>{t.namespace===r.NameSpaceKeySOL&&e.push(...t.chains)}));let t=[],n={},o={};if(e.forEach((e=>{let i=c.address.find((t=>"501"===t.chainId&&501===t.coinType||t.namespaceChainId===e));i&&(t.push(e+":"+i.address),n[e]=o&&"publicKey"in o?o:{publicKey:i.publicKey})})),t&&t.length>0){let e={namespace:r.NameSpaceKeySOL,addresses:t,methods:[...l.SOLANAMethods],extra:n};return(0,s.logDebug)("parseConnectResponse nameSpaceResponse :",JSON.stringify(e)),e}}))}connect(){return o(this,void 0,void 0,(function*(){return window.okxwallet.solana.connect()}))}singleConnect(){return this.connect()}addAccountChangedListener(e){console.log("window.okxwallet configEventWithKey:","sol"),this.accountChangedSolanaPublicKeyHandler=t=>{console.log("window.okxwallet configEventWithKey_solana:",Date.now(),"sol",t),t&&e()},window.okxwallet.solana.on("accountChanged",this.accountChangedSolanaPublicKeyHandler)}removeListener(){this.accountChangedSolanaPublicKeyHandler&&window.okxwallet.solana.removeListener("accountChanged",this.accountChangedSolanaPublicKeyHandler)}}t.SolProvider=d},7475:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TONProvider=void 0;const i=n(852),r=n(2581),s=n(5961),c=n(1623);class a{constructor(){this.signalChainConnectResult=void 0,this.accountChangedTONHandler=null}send(e){return o(this,void 0,void 0,(function*(){try{(0,r.logDebug)("TONProvider send request:",(0,r.safeJsonStringify)(e));let t=null;switch(e.method){case"ton_sendTransaction":e.params&&(t={method:"sendTransaction",params:[JSON.stringify(e.params)],id:Date.now().toString()},(0,r.logDebug)("TONProvider tonParams first:",JSON.stringify(t)));break;default:throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}if(t){const n=yield window.okxTonWallet.tonconnect.send(t);if((0,r.logDebug)("TONProvider send request result:",(0,r.safeJsonStringify)(n)),n.error)throw new i.OKXConnectError(n.error.code,n.error.message);return{result:n.result,method:e.method}}throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}catch(t){throw(0,r.logDebug)("TONProvider encountered an error:",t),t}}))}restoreConnect(){return Promise.resolve()}parseConnectResponse(e,t,n,a,l,d){return o(this,void 0,void 0,(function*(){try{let o=[];a.forEach((e=>{e.namespace===i.NameSpaceKeyTON&&o.push(...e.chains)}));let u=[],g={};if(o.forEach((e=>{(0,r.getChainId)(e);let t=l.address.find((t=>"607"===t.chainId&&607===t.coinType||t.namespaceChainId===e));t&&(u.push(e+":"+t.address),g[e]={publicKey:t.publicKey})})),(0,r.logDebug)("tonprovider parseConnectResponse needPop and addresses: ",e,JSON.stringify(u)),u&&u.length>0){let o,l=a.find((e=>e.namespace===i.NameSpaceKeyTON));if((0,r.logDebug)("tonprovider parseConnectResponse ton: ",JSON.stringify(l)),!(l&&l.params&&d&&d.manifestUrl))throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"manifestUrl is nil");{this.dappInfo=d;let n=[l.params.ton_addr],i={manifestUrl:d.manifestUrl,items:n},c=e||t;c&&l.params.ton_proof&&n.push(l.params.ton_proof),(0,r.logDebug)("parseConnectResponse ton connect params: ",JSON.stringify(i)),o=(0,s.isDevice)("mobile")||e||t?yield window.okxTonWallet.tonconnect.connect(2,i):yield window.okxTonWallet.tonconnect.restoreConnection()}if(n&&this.signalChainConnectResult&&(o=this.signalChainConnectResult,this.signalChainConnectResult=void 0),(0,r.logDebug)("parseConnectResponse ton connect result: ",JSON.stringify(o)),o&&l){if("connect_error"===o.event)throw new i.OKXConnectError(o.payload.code,o.payload.message);{let e=o.payload.items.find((e=>"ton_addr"===e.name)),t=o.payload.items.find((e=>"ton_proof"===e.name));(0,r.logDebug)("tonprovider connect isSignalChain: ",n);let s={namespace:i.NameSpaceKeyTON,addresses:u,methods:[...c.TONMethods],extra:g,data:{ton_addr:e,ton_proof:t,manifestUrl:d.manifestUrl}};return s}}}return}catch(o){throw(0,r.logDebug)("tonprovider parseConnectResponse error: ",JSON.stringify(o)),o}}))}connect(e,t){return o(this,void 0,void 0,(function*(){if(!(e&&t&&t.manifestUrl&&e.params))throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"manifestUrl or params is nil");{this.dappInfo=t;let o=[e.params.ton_addr],s={manifestUrl:t.manifestUrl,items:o};e.params.ton_proof&&o.push(e.params.ton_proof),(0,r.logDebug)("tonprovider connect params: ",JSON.stringify(s));try{let e=yield window.okxTonWallet.tonconnect.connect(2,s);return(0,r.logDebug)("tonprovider connect tonResult: ",JSON.stringify(e)),this.signalChainConnectResult=e,e}catch(n){throw(0,r.logDebug)("tonprovider connect error: ",JSON.stringify(n)),new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"tonconnect error")}}}))}singleConnect(e,t){return this.connect(e,t)}addAccountChangedListener(e){console.log("window.okxwallet configEventWithKey:","ton"),this.accountChangedTONHandler=()=>{console.log("window.okxwallet configEventWithKey_TON:",Date.now(),"ton"),e()},window.okxTonWallet.tonconnect.on("accountChanged",this.accountChangedTONHandler)}removeListener(){this.accountChangedTONHandler&&window.okxTonWallet.tonconnect.off("accountChanged",this.accountChangedTONHandler)}}t.TONProvider=a},728:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BtcProvider=void 0;const i=n(852),r=n(2581),s=n(1623),c=n(5961);class a{constructor(){this.accountChangedBtcHandler=null}connect(){return window.okxwallet.unisat.connect()}switchChain(e){return o(this,void 0,void 0,(function*(){let t=window.okxwallet.unisat;switch(e){case i.BTC_CHAINS.MAINNET:yield t.switchChain("BITCOIN_MAINNET");break;case i.BTC_CHAINS.FRACTAL:yield t.switchChain("FRACTAL_BITCOIN_MAINNET");break}}))}parseConnectResponse(e,t,n,r,c){return o(this,void 0,void 0,(function*(){try{let e=[];r.forEach((t=>{t.namespace===i.NameSpaceKeyBtc&&e.push(...t.chains)}));let t=[],n={};if(0==e.length)return;const a=(e,t)=>e.find((e=>{const n="bitcoin"===e.name&&t===i.BTC_CHAINS.MAINNET||"fractalbitcoin"===e.name&&t===i.BTC_CHAINS.FRACTAL;return 0===e.coinType&&n||e.namespaceChainId===t})),l=e=>o(this,void 0,void 0,(function*(){let o=a(c.address,e);if(!o)return;t.push(e+":"+o.address);let i=yield this.connect();n[e]={publicKey:i.publicKey,compressedPublicKey:i.compressedPublicKey}})),d=e.map(l);if(yield Promise.all(d),t&&t.length>0){let e={namespace:i.NameSpaceKeyBtc,addresses:t,methods:[...s.BtcMethods],extra:n};return e}return}catch(e){throw e}}))}restoreConnect(){return o(this,void 0,void 0,(function*(){return(0,c.isDevice)("mobile")?this.connect():Promise.resolve()}))}send(e){return o(this,void 0,void 0,(function*(){try{(0,r.logDebug)("btcProvider send request:",JSON.stringify(e));const t=e.method,n=e.chainId;if(yield this.restoreConnect(),yield this.switchChain(n),!e.params)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,`param is error method: '${t}'`);switch(t){case"btc_signMessage":{const{signStr:t,type:n}=e.params||{},o=yield window.okxwallet.unisat.signMessage(t,n);return{method:e.method,result:o}}case"btc_send":{const{from:t,to:n,value:o,satBytes:i}=e.params||{},r=yield window.okxwallet.unisat.send({from:t,to:n,value:o,satBytes:i});return{method:e.method,result:r}}case"btc_signPsbts":{const{psbtHexs:t,options:n}=e.params||{};let o;if(Array.isArray(t)&&1===t.length){let e;e=Array.isArray(n)?yield window.okxwallet.unisat.signPsbt(t[0],n.length>0&&"object"===typeof n[0]?n[0]:void 0):yield window.okxwallet.unisat.signPsbt(t[0]),o=[e]}else o=yield window.okxwallet.unisat.signPsbts(t,n);return{method:e.method,result:(0,r.safeJsonStringify)(o)}}case"btc_signAndPushPsbt":{const{psbtHex:t,options:n}=e.params||{},o=yield window.okxwallet.unisat.signPsbt(t,n),i=yield window.okxwallet.unisat.pushPsbt(o);return{method:e.method,result:(0,r.safeJsonStringify)({signedPsbt:o,txHash:i})}}case"btc_sendInscription":{const{address:t,inscriptionId:n,options:o}=e.injectParams||{},i=yield window.okxwallet.unisat.sendInscription(t,n,o);return{method:e.method,result:i}}case"btc_inscribeTransfer":if(this.hasFunction("inscribeTransfer")){const{ticker:t,amount:n}=e.params||{},o=yield window.okxwallet.unisat.inscribeTransfer(t,n);return{method:e.method,result:o}}case"btc_sendRunes":if(this.hasFunction("sendRunes")){const{address:t,runeid:n,amount:o,options:i}=e.injectParams||{},r=yield window.okxwallet.unisat.sendRunes(t,n,o,i);return{method:e.method,result:r}}default:throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`method: '${t}' not support`)}}catch(t){throw(0,r.logDebug)("BtcProvider send error:",t),t}}))}hasFunction(e){return!(!window.okxwallet||!window.okxwallet.unisat||"function"!==typeof window.okxwallet.unisat[e])}singleConnect(e){return o(this,void 0,void 0,(function*(){return 1==e.chains.length&&this.connect()}))}addAccountChangedListener(e){this.accountChangedBtcHandler=t=>{console.log("window.okxwallet btc:",Date.now(),"btc",t),t&&t.length>0&&e()},window.okxwallet.unisat.on("accountsChanged",this.accountChangedBtcHandler)}removeListener(){window.okxwallet.unisat.removeListener("accountsChanged",this.accountChangedBtcHandler)}}t.BtcProvider=a},4257:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Eip155Provider=void 0;const i=n(852),r=n(2581),s=n(5961),c=n(1623);class a{constructor(){this.accountChangedEVMHandler=null}send(e){return o(this,void 0,void 0,(function*(){var t;try{(0,r.logDebug)("Eip155Provider send request:",(0,r.safeJsonStringify)(e)),yield this.restoreConnect();let n=null;switch(e.method){case"personal_sign":e.params&&"message"in e.params&&(n={method:e.method,params:[e.params.message,e.address]});break;case"eth_sendTransaction":case"wallet_addEthereumChain":case"wallet_switchEthereumChain":e.params&&(n={method:e.method,params:[e.params]});break;case"eth_signTypedData_v4":e.params&&"typedDataJson"in e.params&&(null===(t=e.params)||void 0===t?void 0:t.typedDataJson)&&"string"===typeof e.params.typedDataJson&&(n={method:e.method,params:[e.address,e.params.typedDataJson]});break;case"wallet_watchAsset":e.params&&(n={method:e.method,params:e.params});break;default:n={method:e.method,params:e.injectParams}}if(!n)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);if(("wallet_switchEthereumChain"===e.method||"wallet_addEthereumChain"===e.method)&&e.params&&"chainId"in e.params){(0,r.logDebug)("Eip155Provider send request switch requestParams:",(0,r.safeJsonStringify)(n));const t=parseInt(e.params.chainId,16).toString();yield window.okxwallet.request(n);const o=`eip155:${t}:${e.address}`;return(0,r.logDebug)("Eip155Provider send request switch result:",o),{result:o,method:e.method}}{const t=(0,r.getChainId)(e.chainId),o=`0x${Number(t).toString(16)}`;if((0,r.logDebug)("Eip155Provider current chainId:",t,o),o){yield window.okxwallet.request({method:"wallet_switchEthereumChain",params:[{chainId:o}]}),(0,r.logDebug)("Eip155Provider send request requestParams:",o,(0,r.safeJsonStringify)(n));const t=yield window.okxwallet.request(n);return(0,r.logDebug)("Eip155Provider send request result:",(0,r.safeJsonStringify)(t)),{result:t,method:e.method}}}}catch(n){throw(0,r.logDebug)("Eip155Provider encountered an error:",n),n}}))}restoreConnect(){return(0,s.isDevice)("mobile")?window.okxwallet.request({method:"eth_requestAccounts"}):Promise.resolve()}parseConnectResponse(e,t,n,s,a,l){return o(this,void 0,void 0,(function*(){try{let e=[];s.forEach((t=>{t.namespace===i.NameSpaceKeyEip155&&e.push(...t.chains)}));let t=[],n={};if(e.forEach((e=>{let o=(0,r.getChainId)(e),i=a.address.find((t=>t.chainId===o&&60===t.coinType||t.namespaceChainId===e));i&&(t.push(e+":"+i.address),n[e]={publicKey:i.publicKey})})),t&&t.length>0){let e={namespace:i.NameSpaceKeyEip155,addresses:t,methods:[...c.Eip55Methods],extra:n};return e}return}catch(e){throw e}}))}connect(){return o(this,void 0,void 0,(function*(){return window.okxwallet.request({method:"eth_requestAccounts"})}))}singleConnect(){return this.connect()}addAccountChangedListener(e){console.log("window.okxwallet configEventWithKey: eip155"),this.accountChangedEVMHandler=t=>{console.log("window.okxwallet configEventWithKey_evm:",Date.now(),"eip155",t),t&&t.length>0&&e()},window.okxwallet.on("accountsChanged",this.accountChangedEVMHandler)}removeListener(){this.accountChangedEVMHandler&&window.okxwallet.removeListener("accountsChanged",this.accountChangedEVMHandler)}}t.Eip155Provider=a},1987:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(4257),t)},8096:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SuiProvider=void 0;const i=n(852),r=n(2581),s=n(5961),c=n(1623);class a{constructor(e=window.okxwallet.sui){this.accountChangedHandler=null,this.wallet=e}getSuiPublicKey(){return o(this,void 0,void 0,(function*(){const e=yield this.connect();let t=e.accounts[0].publicKey;return t}))}parseConnectResponse(e,t,n,s,a,l){return o(this,void 0,void 0,(function*(){try{let e=[];s.forEach((t=>{t.namespace===i.NameSpaceKeySui&&e.push(...t.chains)}));let t=[],n={};if(0==e.length)return;const o=yield this.getSuiPublicKey();if(e.forEach((e=>{var i;(0,r.getChainId)(e);let s=a.address.find((t=>784===t.coinType||t.namespaceChainId===e));s&&(t.push(e+":"+s.address),n[e]={publicKey:null!==(i=s.publicKey)&&void 0!==i?i:o})})),t&&t.length>0){let e={namespace:i.NameSpaceKeySui,addresses:t,methods:[...c.SuiMethods],extra:n};return e}return}catch(e){throw e}}))}restoreConnect(){return(0,s.isDevice)("mobile")?this.connect():Promise.resolve()}getSuiWallet(){return this.wallet}send(e){return o(this,void 0,void 0,(function*(){try{yield this.restoreConnect(),(0,r.logDebug)("suiProvider send request:",JSON.stringify(e));const t=e.method;let n;if(e.injectParams&&this.getSuiWallet()){let o=e.injectParams;switch(t){case"sui_signTransactionBlock":let e;if(this.getSuiWallet().features["sui:signTransaction"])e=yield this.getSuiWallet().features["sui:signTransaction"].signTransaction(o);else{if(!this.getSuiWallet().features["sui:signTransactionBlock"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);e=yield this.getSuiWallet().features["sui:signTransactionBlock"].signTransactionBlock(o)}n={method:"sui_signTransactionBlock",result:null===e||void 0===e?void 0:e.signature};break;case"sui_signAndExecuteTransactionBlock":let t;if(this.getSuiWallet().features["sui:signAndExecuteTransaction"])t=yield this.getSuiWallet().features["sui:signAndExecuteTransaction"].signAndExecuteTransaction(o);else{if(!this.getSuiWallet().features["sui:signAndExecuteTransactionBlock"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);t=yield this.getSuiWallet().features["sui:signAndExecuteTransactionBlock"].signAndExecuteTransactionBlock(o)}n={method:"sui_signAndExecuteTransactionBlock",result:t.digest};break;case"sui_signMessage":const r=yield this.getSuiWallet().features["sui:signMessage"].signMessage(o);n={method:"sui_signMessage",result:r.signature};break;case"sui_signPersonalMessage":const s=yield this.getSuiWallet().features["sui:signPersonalMessage"].signPersonalMessage(o);n={method:"sui_signPersonalMessage",result:s.signature};break}}return n}catch(t){throw(0,r.logDebug)("suiProvider send error:",t),t}}))}connect(){return o(this,void 0,void 0,(function*(){var e;return null===(e=this.getSuiWallet())||void 0===e?void 0:e.features["standard:connect"].connect()}))}singleConnect(){return this.connect()}addStandardEventListener(e){var t,n;(null===(t=this.getSuiWallet())||void 0===t?void 0:t.features["standard:events"])?((0,r.logDebug)("sui-provider standard:events change"),null===(n=this.getSuiWallet())||void 0===n||n.features["standard:events"].on("change",(t=>{e(t)}))):(0,r.logDebug)("sui-provider standard:events null")}addAccountChangedListener(e){var t;console.log("configEventWithKey:","sui"),this.getSuiWallet().on&&(this.accountChangedHandler=t=>{console.log("configEventWithKey_sui:",Date.now(),"sui",t),t&&e()},null===(t=this.getSuiWallet())||void 0===t||t.on("accountChanged",this.accountChangedHandler))}removeListener(){var e;this.accountChangedHandler&&(null===(e=this.getSuiWallet())||void 0===e||e.removeListener("accountChanged",this.accountChangedHandler))}}t.SuiProvider=a},3708:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),n(4979);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AptosStandardProvider=void 0;const i=n(852),r=n(2581),s=n(1001);class c{constructor(e){this.wallet=e,this.mainNetWorkInfo={chainId:"1",name:s.AptosNetwork.MAINNET}}getVersion(){return this.wallet.version}supportChains(e){return 1===e.length&&e[0]===i.APTOS_CHAINS.MAINNET}send(e){return o(this,void 0,void 0,(function*(){var t,n,o,c,a;try{try{(0,r.logDebug)("AptosStandardProvider send request:",JSON.stringify(e))}catch(l){}yield this.confirmNetwrok(e.chainId);const d=e.method;let u;if(e.injectParams&&this.wallet){let r=e.injectParams;switch(d){case"aptos_signTransaction":let l;if(!this.wallet.features["aptos:signTransaction"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);if("rawTransaction"in r){yield this.wallet.features["aptos:signTransaction"].signTransaction(r);l=(0,s.getArgs)(u)}else{if("1.1"!==this.wallet.features["aptos:signTransaction"].version)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);{const e=r,i={payload:e.data,expirationTimestamp:null===(t=e.options)||void 0===t?void 0:t.expirationTimestamp,expirationSecondsFromNow:null===(n=e.options)||void 0===n?void 0:n.expirationSecondsFromNow,gasUnitPrice:null===(o=null===e||void 0===e?void 0:e.options)||void 0===o?void 0:o.gasUnitPrice,maxGasAmount:null===(c=null===e||void 0===e?void 0:e.options)||void 0===c?void 0:c.maxGasAmount,sequenceNumber:null===(a=null===e||void 0===e?void 0:e.options)||void 0===a?void 0:a.accountSequenceNumber,sender:e.sender};yield this.wallet.features["aptos:signTransaction"].signTransaction(i);l=(0,s.getArgs)(u)}}u={method:"aptos_signTransaction",injectResult:l};break;case"aptos_signMessage":let d;if(!this.wallet.features["aptos:signMessage"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);{let e=yield this.wallet.features["aptos:signMessage"].signMessage(r);d=(0,s.getArgs)(e)}u={method:"aptos_signMessage",injectResult:d};break;case"aptos_signAndSubmitTransaction":let g;if(!this.wallet.features["aptos:signAndSubmitTransaction"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);if("1.0.0"==this.wallet.features["aptos:signAndSubmitTransaction"].version){if("standardV1Transaction"in r){let e=yield this.wallet.features["aptos:signAndSubmitTransaction"].signAndSubmitTransaction(r.standardV1Transaction);g=(0,s.getArgs)(e)}}else{if("1.1.0"!=this.wallet.features["aptos:signAndSubmitTransaction"].version)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);if("standardV11Transaction"in r){e.params;let t=yield this.wallet.features["aptos:signAndSubmitTransaction"].signAndSubmitTransaction(r.standardV11Transaction);g=(0,s.getArgs)(t)}}u={method:"aptos_signAndSubmitTransaction",result:g.hash.toString()};break}}return u}catch(d){throw(0,r.logDebug)("aptosProvider send error:",d),d}}))}removeListener(){this.wallet.features["aptos:onAccountChange"]&&this.wallet.features["aptos:onAccountChange"].onAccountChange((e=>{}))}addAccountChangedListener(e){this.accountChangedListener=e}setAccountChangedListener(){if(this.wallet.features["aptos:onAccountChange"]&&this.accountChangedListener)try{this.wallet.features["aptos:onAccountChange"].onAccountChange((e=>{var t,n;try{this.accountChangedListener(null===(n=null===(t=(0,s.getArgs)(e))||void 0===t?void 0:t.address)||void 0===n?void 0:n.toString())}catch(o){this.accountChangedListener(void 0)}}))}catch(e){(0,r.logDebug)(`aptosStandardProvider addAccountChangedListener: error ${e.toString()}`)}}connect(){return o(this,void 0,void 0,(function*(){return this.wallet.features["aptos:connect"].connect()}))}getAccount(){return o(this,void 0,void 0,(function*(){let e=(0,s.getArgs)(yield this.connect()),t=e.address;"object"===typeof t&&t.toString&&(t=t.toString()),t instanceof Uint8Array&&(t=this.normalizeUint8Array(t),t=btoa(String.fromCharCode(...t)));let n=e.publicKey.toString();this.setAccountChangedListener();let o={};return o[i.APTOS_CHAINS.MAINNET]={publicKey:n},{namespace:i.NameSpaceKeyAptos,addresses:[`${i.APTOS_CHAINS.MAINNET}:${t}`],methods:[],extra:o}}))}normalizeUint8Array(e){return 33===e.length&&0===e[0]?e.slice(1):e}disconnect(){return o(this,void 0,void 0,(function*(){if(this.wallet.features["aptos:disconnect"])return this.wallet.features["aptos:disconnect"].disconnect()}))}confirmNetwrok(e){return o(this,void 0,void 0,(function*(){if(e!==r.chainName2IdMap.get(i.APTOS_CHAINS.MAINNET))throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED);if(!this.wallet.features["aptos:network"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);{let e=yield this.wallet.features["aptos:network"].network();if(1==e.chainId&&e.name.toLowerCase()==s.AptosNetwork.MAINNET)return Promise.resolve();yield this.changeMainNetwork()}}))}changeMainNetwork(){return o(this,void 0,void 0,(function*(){if(!this.wallet.features["aptos:changeNetwork"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);{let e=yield this.wallet.features["aptos:changeNetwork"].changeNetwork(this.mainNetWorkInfo),t=(0,s.getArgs)(e);if(t.success)return Promise.resolve()}}))}}t.AptosStandardProvider=c},1086:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AptosThirdpartInjectProvider=void 0;const i=n(852),r=n(8586),s=n(2581),c=n(1001);class a{constructor(e){this.walletAdapter=e}disconnect(){return o(this,void 0,void 0,(function*(){yield this.walletAdapter.disconnect()}))}getVersion(){return this.walletAdapter.version}getAccount(){return o(this,void 0,void 0,(function*(){yield this.walletAdapter.connect();let e=this.walletAdapter.publicAccount,t=e.address,n=e.publicKey.toString(),o={};return o[i.APTOS_CHAINS.MAINNET]={publicKey:n},{namespace:i.NameSpaceKeyAptos,addresses:[`${i.APTOS_CHAINS.MAINNET}:${t}`],methods:[],extra:o}}))}supportChains(e){return this.walletAdapter.readyState===r.WalletReadyState.Installed&&(1===e.length&&e[0]===i.APTOS_CHAINS.MAINNET)}send(e){return o(this,void 0,void 0,(function*(){try{try{(0,s.logDebug)("AptosStandardProvider send request:",JSON.stringify(e))}catch(t){}this.confirmNetwrok(e.chainId);const n=e.method;let o;if(e.injectParams&&this.walletAdapter){let t=e.injectParams;switch(n){case"aptos_signTransaction":let n=yield this.walletAdapter.signTransaction(e.params);o={method:"aptos_signTransaction",result:n};break;case"aptos_signMessage":let i=yield this.walletAdapter.signMessage(t);"object"===typeof i&&"signature"in i&&(i=i.signature),o={method:"aptos_signMessage",result:i};break;case"aptos_signAndSubmitTransaction":let r=yield this.walletAdapter.signAndSubmitTransaction(e.params);o={method:"aptos_signAndSubmitTransaction",result:r.hash};break}}return o}catch(t){throw(0,s.logDebug)("aptosProvider send error:",t),t}}))}removeListener(){}addAccountChangedListener(e){this.walletAdapter.onAccountChange((t=>{null===e||void 0===e||e(null===t||void 0===t?void 0:t.address)}))}confirmNetwrok(e){var t;if(e!==s.chainName2IdMap.get(i.APTOS_CHAINS.MAINNET))throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED);let n=this.walletAdapter.network;if((null===(t=n.name)||void 0===t?void 0:t.toLowerCase())!=c.AptosNetwork.MAINNET)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED)}}t.AptosThirdpartInjectProvider=a},5773:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(3708),t),i(n(1086),t),i(n(8586),t)},1001:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AptosNetwork=t.UserResponseStatus=void 0,t.getArgs=s;const o=n(852);var i,r;function s(e){if("object"===typeof e&&null!==e&&"status"in e){if(e.status===i.REJECTED)throw new o.OKXConnectError(o.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR);return e.args}return e}(function(e){e["APPROVED"]="Approved",e["REJECTED"]="Rejected"})(i||(t.UserResponseStatus=i={})),function(e){e["MAINNET"]="mainnet",e["TESTNET"]="testnet",e["DEVNET"]="devnet"}(r||(t.AptosNetwork=r={}))},8255:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.WalletReadyState=void 0,function(e){e["Installed"]="Installed",e["NotDetected"]="NotDetected",e["Loadable"]="Loadable",e["Unsupported"]="Unsupported"}(n||(t.WalletReadyState=n={}))},4438:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAptosWalletAdapter=void 0;const o=n(49);class i extends o.EventEmitter{get connected(){return!!this.publicAccount.publicKey}}t.BaseAptosWalletAdapter=i},8586:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(8255),t),i(n(8304),t),i(n(4224),t)},8304:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MartainWalletAdapter=void 0;const i=n(4438),r=n(8255),s=n(852),c=n(8384),a=n(2581);class l extends i.BaseAptosWalletAdapter{get readyState(){throw new Error("Method not implemented.")}constructor(){super(),this.name="Martian",this.icon="https://raw.githubusercontent.com/hippospace/aptos-wallet-adapter/main/logos/martian.png",this.url="",this._version="unknown",this._readyState="undefined"===typeof window||"undefined"===typeof document?r.WalletReadyState.Unsupported:r.WalletReadyState.NotDetected,this._provider="undefined"!==typeof window?window.martian:void 0,this._network=void 0,this._connecting=!1,this._wallet=null,"undefined"!==typeof window&&this._readyState!==r.WalletReadyState.Unsupported&&(0,c.scopePollingDetectionStrategy)((()=>!!window.martian&&(this._readyState=r.WalletReadyState.Installed,this.emit("readyStateChange",this._readyState),!0)))}get publicAccount(){var e,t,n;return{publicKey:(null===(e=this._wallet)||void 0===e?void 0:e.publicKey)||null,address:(null===(t=this._wallet)||void 0===t?void 0:t.address)||null,authKey:(null===(n=this._wallet)||void 0===n?void 0:n.authKey)||null}}get connecting(){return this._connecting}get version(){return this._version}get network(){return{name:this._network,chainId:this._chainId}}onAccountChange(e){return o(this,void 0,void 0,(function*(){try{const e=this._wallet,t=this._provider||window.martian;if(!e||!t)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);const n=e=>o(this,void 0,void 0,(function*(){const{publicKey:n}=yield null===t||void 0===t?void 0:t.account();this._wallet=Object.assign(Object.assign({},this._wallet),{address:e,publicKey:n})}));yield null===t||void 0===t?void 0:t.onAccountChange(n)}catch(e){e.message;throw e}(0,a.logDebug)("MartainWalletAdapter.onAccountChange()")}))}onNetworkChange(){return o(this,void 0,void 0,(function*(){(0,a.logDebug)("MartainWalletAdapter.onNetworkChange()")}))}connect(){return o(this,void 0,void 0,(function*(){try{if(this._readyState!==r.WalletReadyState.Loadable&&this._readyState!==r.WalletReadyState.Installed)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);if(this.connecting)return;if(this.connected)return void(yield this.initNetWork());this._connecting=!0;const e=this._provider||window.martian,t=yield null===e||void 0===e?void 0:e.isConnected();t&&(yield null===e||void 0===e?void 0:e.disconnect());const n=yield null===e||void 0===e?void 0:e.connect();if(!n)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);yield this.initNetWork()}catch(e){throw e}finally{this._connecting=!1}}))}initNetWork(){return o(this,void 0,void 0,(function*(){const e=this._provider||window.martian,t=yield null===e||void 0===e?void 0:e.account();if(t){this._wallet=Object.assign(Object.assign({},t),{isConnected:!0});const n=yield null===e||void 0===e?void 0:e.network(),{chainId:o}=yield e.getChainId();this._network=n,this._chainId=o.toString()}}))}disconnect(){return o(this,void 0,void 0,(function*(){const e=this._wallet,t=this._provider||window.martian;if(e){this._wallet=null;try{yield null===t||void 0===t?void 0:t.disconnect()}catch(n){}}}))}signAndSubmitTransaction(e,t){return o(this,void 0,void 0,(function*(){try{const n=this._wallet,o=this._provider||window.martian;if(!n||!o)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);const i=yield o.generateTransaction(n.address||"",e,t);if(!i)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"generate transaction error");const r=yield null===o||void 0===o?void 0:o.signAndSubmitTransaction(i);if(!r)throw new Error("No response");return{hash:r}}catch(n){throw n}}))}signTransaction(e,t){return o(this,void 0,void 0,(function*(){try{const n=this._wallet,o=this._provider||window.martian;if(!n||!o)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);const i=yield o.generateTransaction(n.address||"",e,t);if(!i)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"generate transaction error");const r=yield null===o||void 0===o?void 0:o.signTransaction(i);if(!r)throw new Error("No response");return r}catch(n){throw n}}))}signMessage(e){return o(this,void 0,void 0,(function*(){try{const t=this._wallet,n=this._provider||window.martian;if(!t||!n)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);if("object"!==typeof e||!e.nonce)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"Invalid signMessage Payload");const o=yield null===n||void 0===n?void 0:n.signMessage(e);if(o)return o;throw new Error("Sign Message failed")}catch(t){throw t}}))}}t.MartainWalletAdapter=l},4224:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PetraWalletAdapter=void 0;const i=n(4438),r=n(8255),s=n(8384),c=n(852);class a extends i.BaseAptosWalletAdapter{get readyState(){return this._readyState}getPerta(){var e;if(this._provider)return this._provider;if(!window.petra)return;let t=window.petra;return t&&(t.isOKExWallet||t.isOkxWallet||(null===(e=window.okxwallet)||void 0===e?void 0:e.aptos)===t)?void 0:(this._provider=t,t)}constructor(){super(),this.name="Petra",this.icon="https://raw.githubusercontent.com/hippospace/aptos-wallet-adapter/main/logos/petra.png",this.url="",this._version="unknown",this._readyState="undefined"===typeof window||"undefined"===typeof document?r.WalletReadyState.Unsupported:r.WalletReadyState.NotDetected,this._network=void 0,this._connecting=!1,this._wallet=null,"undefined"!==typeof window&&this._readyState!==r.WalletReadyState.Unsupported&&(0,s.scopePollingDetectionStrategy)((()=>!!this.getPerta()&&(this._readyState=r.WalletReadyState.Installed,!0)))}get publicAccount(){var e,t,n;return{publicKey:(null===(e=this._wallet)||void 0===e?void 0:e.publicKey)||null,address:(null===(t=this._wallet)||void 0===t?void 0:t.address)||null,authKey:(null===(n=this._wallet)||void 0===n?void 0:n.authKey)||null}}get connecting(){return this._connecting}get version(){return this._version}get network(){return{name:this._network}}connect(){return o(this,void 0,void 0,(function*(){try{if(this._readyState!==r.WalletReadyState.Loadable&&this._readyState!==r.WalletReadyState.Installed)throw new c.OKXConnectError(c.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);if(this.connected)return void(yield this.initNetWork());this._connecting=!0;const e=this.getPerta(),t=yield null===e||void 0===e?void 0:e.connect();this._wallet={address:null===t||void 0===t?void 0:t.address,publicKey:null===t||void 0===t?void 0:t.publicKey,isConnected:!0},yield this.initNetWork()}catch(e){throw e}finally{this._connecting=!1}}))}initNetWork(){return o(this,void 0,void 0,(function*(){const e=this.getPerta(),t=yield null===e||void 0===e?void 0:e.network();this._network=t}))}disconnect(){return o(this,void 0,void 0,(function*(){const e=this._wallet,t=this.getPerta();if(e){this._wallet=null;try{yield null===t||void 0===t?void 0:t.disconnect()}catch(n){}}}))}signAndSubmitTransaction(e,t){return o(this,void 0,void 0,(function*(){try{const n=this._wallet,o=this.getPerta();if(!n||!o)throw new c.OKXConnectError(c.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);const i=yield o.signAndSubmitTransaction(e,t);if(i.code)throw new Error(i.message);return i}catch(n){throw n}}))}signTransaction(e,t){return o(this,void 0,void 0,(function*(){try{const t=this._wallet,n=this.getPerta();if(!t||!n)throw new c.OKXConnectError(c.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);const o=yield null===n||void 0===n?void 0:n.signTransaction(e);if(o.code)throw new Error(o.message);return o}catch(t){throw t}}))}signMessage(e){return o(this,void 0,void 0,(function*(){try{const t=this._wallet,n=this.getPerta();if(!t||!n)throw new c.OKXConnectError(c.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);const o=yield null===n||void 0===n?void 0:n.signMessage(e);if(o)return o;throw new Error("Sign Message failed")}catch(t){throw t}}))}onAccountChange(e){return o(this,void 0,void 0,(function*(){try{this._wallet;const t=this.getPerta(),n=n=>o(this,void 0,void 0,(function*(){var o,i,r,s,c,a;if(null===n||void 0===n?void 0:n.publicKey)this._wallet=Object.assign(Object.assign({},this._wallet),{publicKey:n.publicKey||(null===(o=this._wallet)||void 0===o?void 0:o.publicKey),authKey:n.authKey||(null===(i=this._wallet)||void 0===i?void 0:i.authKey),address:n.address||(null===(r=this._wallet)||void 0===r?void 0:r.address)});else{const e=yield null===t||void 0===t?void 0:t.connect();this._wallet=Object.assign(Object.assign({},this._wallet),{authKey:(null===e||void 0===e?void 0:e.authKey)||(null===(s=this._wallet)||void 0===s?void 0:s.authKey),address:(null===e||void 0===e?void 0:e.address)||(null===(c=this._wallet)||void 0===c?void 0:c.address),publicKey:(null===e||void 0===e?void 0:e.publicKey)||(null===(a=this._wallet)||void 0===a?void 0:a.publicKey)})}null===e||void 0===e||e(this._wallet)}));null===t||void 0===t||t.onAccountChange(n)}catch(t){throw t}}))}onNetworkChange(){return o(this,void 0,void 0,(function*(){try{this._wallet,this.getPerta()}catch(e){throw e}}))}}t.PetraWalletAdapter=a},3639:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(991),t),i(n(5773),t)},991:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),n(4979);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SuiStandardProvider=void 0;const i=n(852),r=n(2581),s=n(5961);class c{constructor(e){this.wallet=e}getVersion(){return this.wallet.version}supportChains(e){return 1===e.length&&e[0]===i.SUI_CHAINS.MAINNET}send(e){return o(this,void 0,void 0,(function*(){try{(0,r.logDebug)("suiProvider send request:",JSON.stringify(e));const t=e.method;let n;if(e.injectParams&&this.wallet){let o=e.injectParams;switch(t){case"sui_signTransactionBlock":let e;if(this.wallet.features["sui:signTransaction"])e=yield this.wallet.features["sui:signTransaction"].signTransaction(o);else{if(!this.wallet.features["sui:signTransactionBlock"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);e=yield this.wallet.features["sui:signTransactionBlock"].signTransactionBlock(o)}n={method:"sui_signTransactionBlock",result:null===e||void 0===e?void 0:e.signature};break;case"sui_signAndExecuteTransactionBlock":let t;if(this.wallet.features["sui:signAndExecuteTransaction"])t=yield this.wallet.features["sui:signAndExecuteTransaction"].signAndExecuteTransaction(o);else{if(!this.wallet.features["sui:signAndExecuteTransactionBlock"])throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED);t=yield this.wallet.features["sui:signAndExecuteTransactionBlock"].signAndExecuteTransactionBlock(o)}n={method:"sui_signAndExecuteTransactionBlock",result:t.digest};break;case"sui_signMessage":const r=yield this.wallet.features["sui:signMessage"].signMessage(o);n={method:"sui_signMessage",result:r.signature};break;case"sui_signPersonalMessage":const s=yield this.wallet.features["sui:signPersonalMessage"].signPersonalMessage(o);n={method:"sui_signPersonalMessage",result:s.signature};break}}return n}catch(t){throw(0,r.logDebug)("suiProvider send error:",t),t}}))}addAccountChangedListener(){}removeListener(){}disconnect(){return o(this,void 0,void 0,(function*(){}))}connect(){return o(this,void 0,void 0,(function*(){return this.wallet.features["standard:connect"].connect()}))}restoreConnect(){return(0,s.isDevice)("mobile")?this.connect():Promise.resolve()}getAccount(){return o(this,void 0,void 0,(function*(){var e,t;let n=yield this.connect();if(!n)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);e=null===n||void 0===n?void 0:n.address;let o=null!==(t=null===n||void 0===n?void 0:n.publicKey)&&void 0!==t?t:"";o instanceof Uint8Array&&(o=this.normalizeUint8Array(o),o=btoa(String.fromCharCode(...o)));let r={};return r[i.SUI_CHAINS.MAINNET]={publicKey:o},{namespace:i.NameSpaceKeySui,addresses:[`${i.SUI_CHAINS.MAINNET}:${n.address}`],methods:n.features,extra:r}}))}normalizeUint8Array(e){return 33===e.length&&0===e[0]?e.slice(1):e}}t.SuiStandardProvider=c},5095:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3527:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8775:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(3527),t),i(n(5095),t)},3008:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NAMES_CHAINS=t.TON_CHAINS=t.COSMOS_CHAINS=t.APTOS_CHAINS=t.SUI_CHAINS=t.SOLANA_CHAINS=t.BTC_CHAINS=void 0;const o=n(6710);t.BTC_CHAINS={MAINNET:"btc:mainnet",FRACTAL:"fractal:mainnet"},t.SOLANA_CHAINS={MAINNET:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",TESTNET:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",SONIC_TESTNET:"sonic:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"},t.SUI_CHAINS={MAINNET:"sui:mainnet"},t.APTOS_CHAINS={MAINNET:"aptos:mainnet",MOVEMENT_MAINNET:"movement:mainnet",MOVEMENT_TESTNET:"movement:testnet"},t.COSMOS_CHAINS={COSMOS_MAINNET:"cosmos:cosmoshub-4"},t.TON_CHAINS={MAINNET:"ton:-239"},t.NAMES_CHAINS={[o.NameSpaceKeyBtc]:Object.values(t.BTC_CHAINS),[o.NameSpaceKeySOL]:Object.values(t.SOLANA_CHAINS),[o.NameSpaceKeyTON]:Object.values(t.TON_CHAINS),[o.NameSpaceKeySui]:Object.values(t.SUI_CHAINS),[o.NameSpaceKeyAptos]:Object.values(t.APTOS_CHAINS),[o.NameSpaceKeyCosmos]:Object.values(t.COSMOS_CHAINS)}},2664:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IEngine=t.ISignClient=t.ISignClientEvents=t.IEngineEvents=void 0;const i=o(n(49));class r extends i.default{constructor(){super()}}t.IEngineEvents=r;class s extends i.default{constructor(){super()}}t.ISignClientEvents=s;class c{constructor(e){this.data=e}}t.ISignClient=c;class a{constructor(e){this.client=e}}t.IEngine=a},5653:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ISignClientEvents=t.IEngine=t.IEngineEvents=t.ISignClient=t.getBigIntRpcId=t.formatJsonRpcRequest=t.isJsonRpcError=t.isJsonRpcResponse=t.parseConnectionError=t.isHttpUrl=t.formatJsonRpcError=void 0;var r=n(2541);Object.defineProperty(t,"formatJsonRpcError",{enumerable:!0,get:function(){return r.formatJsonRpcError}}),Object.defineProperty(t,"isHttpUrl",{enumerable:!0,get:function(){return r.isHttpUrl}}),Object.defineProperty(t,"parseConnectionError",{enumerable:!0,get:function(){return r.parseConnectionError}}),Object.defineProperty(t,"isJsonRpcResponse",{enumerable:!0,get:function(){return r.isJsonRpcResponse}}),Object.defineProperty(t,"isJsonRpcError",{enumerable:!0,get:function(){return r.isJsonRpcError}}),Object.defineProperty(t,"formatJsonRpcRequest",{enumerable:!0,get:function(){return r.formatJsonRpcRequest}}),Object.defineProperty(t,"getBigIntRpcId",{enumerable:!0,get:function(){return r.getBigIntRpcId}});var s=n(2664);Object.defineProperty(t,"ISignClient",{enumerable:!0,get:function(){return s.ISignClient}}),Object.defineProperty(t,"IEngineEvents",{enumerable:!0,get:function(){return s.IEngineEvents}}),Object.defineProperty(t,"IEngine",{enumerable:!0,get:function(){return s.IEngine}}),Object.defineProperty(t,"ISignClientEvents",{enumerable:!0,get:function(){return s.ISignClientEvents}}),i(n(4856),t),i(n(5953),t)},2541:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};function i(e){return"object"===typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function r(e){return i(e)&&"method"in e}function s(e){return i(e)&&(c(e)||a(e))}function c(e){return"result"in e}function a(e){return"error"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonRpcPayload=i,t.isJsonRpcRequest=r,t.isJsonRpcResponse=s,t.isJsonRpcResult=c,t.isJsonRpcError=a,t.payloadId=p,t.getBigIntRpcId=f,t.formatJsonRpcRequest=O,t.formatJsonRpcResult=v,t.formatJsonRpcError=_,t.isReservedErrorCode=C,t.getError=E,t.getErrorByCode=y,t.formatErrorMessage=m,t.isHttpUrl=T,t.isWsUrl=S,t.parseConnectionError=w;const l=n(4028),d=o(n(998));class u{constructor(e){this.i=1;8===e?new Uint8Array(1):16===e?new Uint16Array(1):new Uint32Array(1);this.initialValue=e?d.default.randomBytes(e/8)[0]:0}getNextValue(){return this.initialValue+this.i++}}const g=new u(8),h=new u(16);function p(){const e=1e3*Date.now(),t=g.getNextValue();return e+t}function f(){const e=BigInt(Date.now())*BigInt(1e6),t=BigInt(h.getNextValue());return e+t}function O(e,t,n){return{id:n||p(),jsonrpc:"2.0",method:e,params:t}}function v(e,t){return{id:e,jsonrpc:"2.0",result:t}}function _(e,t,n){return{id:e,jsonrpc:"2.0",error:m(t,n)}}function C(e){return l.RESERVED_ERROR_CODES.includes(e)}function E(e){return Object.keys(l.STANDARD_ERROR_MAP).includes(e)?l.STANDARD_ERROR_MAP[e]:l.STANDARD_ERROR_MAP[l.DEFAULT_ERROR]}function y(e){const t=Object.values(l.STANDARD_ERROR_MAP).find((t=>t.code===e));return t||l.STANDARD_ERROR_MAP[l.DEFAULT_ERROR]}function m(e,t){return"undefined"===typeof e?E(l.INTERNAL_ERROR):("string"===typeof e&&(e=Object.assign(Object.assign({},E(l.SERVER_ERROR)),{message:e})),"undefined"!==typeof t&&(e.data=t),C(e.code)&&(e=y(e.code)),e)}function N(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}function b(e,t){const n=N(e);return"undefined"!==typeof n&&new RegExp(t).test(n)}function T(e){return b(e,"^https?:")}function S(e){return b(e,"^wss?:")}function w(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}},6952:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_ITEM_ERROR_CODES=void 0,function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(n||(t.CONNECT_ITEM_ERROR_CODES=n={}))},5983:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TONCHAIN=void 0,function(e){e["MAINNET"]="-239"}(n||(t.TONCHAIN=n={}))},4856:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_ITEM_ERROR_CODES=t.TONCHAIN=void 0;var o=n(5983);Object.defineProperty(t,"TONCHAIN",{enumerable:!0,get:function(){return o.TONCHAIN}});var i=n(6952);Object.defineProperty(t,"CONNECT_ITEM_ERROR_CODES",{enumerable:!0,get:function(){return i.CONNECT_ITEM_ERROR_CODES}})},5953:function(e,t){"use strict";function n(){return{appName:"okxAppWallet",name:t.OKXWalletName,imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png"}}function o(){return{appName:"okxMiniApp",name:t.OKXMiniWalletName,imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png"}}function i(){return{appName:"okxInjectWallet",name:t.OKXInjectWalletName,imageUrl:""}}Object.defineProperty(t,"__esModule",{value:!0}),t.AptosAppleWalletName=t.AptosGoogleWalletName=t.OKXInjectWalletName=t.OKXMiniWalletName=t.OKXWalletName=void 0,t.creatOKXWalletInfo=n,t.creatOKXMiniAppWalletInfo=o,t.creatOKXInjectWalletInfo=i,t.OKXWalletName="OKX Wallet",t.OKXMiniWalletName="OKX Mini Wallet",t.OKXInjectWalletName="OKX Inject Wallet",t.AptosGoogleWalletName="Continue with Google",t.AptosAppleWalletName="Continue with Apple"},2329:function(e,t,n){"use strict";function o(){return window.okxTesttwaUrl}function i(){return window.okxTestTgtwaUrl}function r(e){const t=new URL(e),n=t.pathname.split("/").filter(Boolean);if(n.length>=2){const e=n[0],t=n[1];return{botName:e,appName:t}}}n(4603),n(7566),n(8721),Object.defineProperty(t,"__esModule",{value:!0}),t.OKX_MINI_WALLET_NAME=t.OKX_APP_WALLET_NAME=t.stackDeepLink=t.tgwalletAppName=t.tgwalletName=t.tonConnectSdkVersion=t.standardDeeplink=t.downloadUrl=t.shortUniversalLink=t.standardUniversalLink=t.okxDeeplink=void 0,t.getTestTwaUrl=o,t.getTestTgTwaUrl=i,t.getBotNameAndAppName=r,t.okxDeeplink="okx://web3",t.standardUniversalLink="undefined"!==typeof window&&window.location.hostname.includes("okx.com")?"https://link.okx.com/download":"https://www.okx.com/download",t.shortUniversalLink="undefined"!==typeof window&&window.location.hostname.includes("okx.com")?"https://link.okx.com/ul/connect":"https://www.okx.com/ul/connect",t.downloadUrl="https://www.okx.com/download",t.standardDeeplink=`${t.okxDeeplink}/wallet/connect`,t.tonConnectSdkVersion="1",t.tgwalletName="OKX_WALLET_BOT",t.tgwalletAppName="start",t.stackDeepLink="okx://web3?stack=true",t.OKX_APP_WALLET_NAME="OKX Wallet",t.OKX_MINI_WALLET_NAME="OKX Mini Wallet"},3917:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKX_CONNECT_ERROR_CODES=t.OKXConnectError=void 0;var o=n(4028);Object.defineProperty(t,"OKXConnectError",{enumerable:!0,get:function(){return o.OKXConnectError}}),Object.defineProperty(t,"OKX_CONNECT_ERROR_CODES",{enumerable:!0,get:function(){return o.OKX_CONNECT_ERROR_CODES}})},4028:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ERROR=t.STANDARD_ERROR_MAP=t.SERVER_ERROR_CODE_RANGE=t.RESERVED_ERROR_CODES=t.SERVER_ERROR=t.INTERNAL_ERROR=t.INVALID_PARAMS=t.METHOD_NOT_FOUND=t.INVALID_REQUEST=t.PARSE_ERROR=t.OKX_CONNECT_ERROR_CODES=t.OKXConnectError=void 0;class n extends Error{constructor(e,t){void 0==t&&(t=o(e)),super(t),this.code=e,this.message=`${n.prefix} ${t?"\n"+t:""}`,Object.setPrototypeOf(this,n.prototype)}toJSON(){return{message:this.message,code:this.code}}}function o(e){return e==i.UNKNOWN_ERROR?"unknown error":e==i.BAD_REQUEST_ERROR?"bad request error":e==i.ALREADY_CONNECTED_ERROR?"already connected error":e==i.NOT_CONNECTED_ERROR?"not connected error":e==i.UNKNOWN_APP_ERROR?"unknown app error":e==i.USER_REJECTS_ERROR?"user rejects error":e==i.USER_REJECTS_ERROR_CAUSE_REGISTER?"wallet address are registering":e==i.METHOD_NOT_SUPPORTED?"method not supported":e==i.CONNECTION_ERROR?"connect error":e==i.CHAIN_NOT_SUPPORTED?"chain not supported":"unknown error"}var i;t.OKXConnectError=n,n.prefix="[OKX_CONNECT_SDK_ERROR]",function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["ALREADY_CONNECTED_ERROR"]=11]="ALREADY_CONNECTED_ERROR",e[e["NOT_CONNECTED_ERROR"]=12]="NOT_CONNECTED_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["USER_REJECTS_ERROR"]=300]="USER_REJECTS_ERROR",e[e["USER_REJECTS_ERROR_CAUSE_REGISTER"]=301]="USER_REJECTS_ERROR_CAUSE_REGISTER",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED",e[e["CHAIN_NOT_SUPPORTED"]=500]="CHAIN_NOT_SUPPORTED",e[e["WALLET_NOT_SUPPORTED"]=600]="WALLET_NOT_SUPPORTED",e[e["CONNECTION_ERROR"]=700]="CONNECTION_ERROR"}(i||(t.OKX_CONNECT_ERROR_CODES=i={})),t.PARSE_ERROR="PARSE_ERROR",t.INVALID_REQUEST="INVALID_REQUEST",t.METHOD_NOT_FOUND="METHOD_NOT_FOUND",t.INVALID_PARAMS="INVALID_PARAMS",t.INTERNAL_ERROR="INTERNAL_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603],t.SERVER_ERROR_CODE_RANGE=[-32e3,-32099],t.STANDARD_ERROR_MAP={[t.PARSE_ERROR]:{code:-32700,message:"Parse error"},[t.INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[t.METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[t.INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[t.INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[t.SERVER_ERROR]:{code:-32e3,message:"Server error"}},t.DEFAULT_ERROR=t.SERVER_ERROR},852:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.NAMES_CHAINS=t.TON_CHAINS=t.COSMOS_CHAINS=t.APTOS_CHAINS=t.SUI_CHAINS=t.SOLANA_CHAINS=t.BTC_CHAINS=t.shortUniversalLink=t.downloadUrl=t.okxDeeplink=t.tonConnectSdkVersion=t.standardDeeplink=t.standardUniversalLink=t.OpenAppLinkType=t.NameSpaceKeyStarknet=t.NameSpaceKeyTron=t.NameSpaceKeyCosmos=t.NameSpaceKeyAptos=t.NameSpaceKeyBtc=t.NameSpaceKeySui=t.NameSpaceKeyTON=t.NameSpaceKeySOL=t.NameSpaceKeyEip155=void 0,i(n(3917),t);var r=n(6710);Object.defineProperty(t,"NameSpaceKeyEip155",{enumerable:!0,get:function(){return r.NameSpaceKeyEip155}}),Object.defineProperty(t,"NameSpaceKeySOL",{enumerable:!0,get:function(){return r.NameSpaceKeySOL}}),Object.defineProperty(t,"NameSpaceKeyTON",{enumerable:!0,get:function(){return r.NameSpaceKeyTON}}),Object.defineProperty(t,"NameSpaceKeySui",{enumerable:!0,get:function(){return r.NameSpaceKeySui}}),Object.defineProperty(t,"NameSpaceKeyBtc",{enumerable:!0,get:function(){return r.NameSpaceKeyBtc}}),Object.defineProperty(t,"NameSpaceKeyAptos",{enumerable:!0,get:function(){return r.NameSpaceKeyAptos}}),Object.defineProperty(t,"NameSpaceKeyCosmos",{enumerable:!0,get:function(){return r.NameSpaceKeyCosmos}}),Object.defineProperty(t,"NameSpaceKeyTron",{enumerable:!0,get:function(){return r.NameSpaceKeyTron}}),Object.defineProperty(t,"NameSpaceKeyStarknet",{enumerable:!0,get:function(){return r.NameSpaceKeyStarknet}}),Object.defineProperty(t,"OpenAppLinkType",{enumerable:!0,get:function(){return r.OpenAppLinkType}});var s=n(2329);Object.defineProperty(t,"standardUniversalLink",{enumerable:!0,get:function(){return s.standardUniversalLink}}),Object.defineProperty(t,"standardDeeplink",{enumerable:!0,get:function(){return s.standardDeeplink}}),Object.defineProperty(t,"tonConnectSdkVersion",{enumerable:!0,get:function(){return s.tonConnectSdkVersion}}),Object.defineProperty(t,"okxDeeplink",{enumerable:!0,get:function(){return s.okxDeeplink}}),Object.defineProperty(t,"downloadUrl",{enumerable:!0,get:function(){return s.downloadUrl}}),Object.defineProperty(t,"shortUniversalLink",{enumerable:!0,get:function(){return s.shortUniversalLink}}),i(n(5653),t);var c=n(3008);Object.defineProperty(t,"BTC_CHAINS",{enumerable:!0,get:function(){return c.BTC_CHAINS}}),Object.defineProperty(t,"SOLANA_CHAINS",{enumerable:!0,get:function(){return c.SOLANA_CHAINS}}),Object.defineProperty(t,"SUI_CHAINS",{enumerable:!0,get:function(){return c.SUI_CHAINS}}),Object.defineProperty(t,"APTOS_CHAINS",{enumerable:!0,get:function(){return c.APTOS_CHAINS}}),Object.defineProperty(t,"COSMOS_CHAINS",{enumerable:!0,get:function(){return c.COSMOS_CHAINS}}),Object.defineProperty(t,"TON_CHAINS",{enumerable:!0,get:function(){return c.TON_CHAINS}}),Object.defineProperty(t,"NAMES_CHAINS",{enumerable:!0,get:function(){return c.NAMES_CHAINS}})},6710:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.NameSpaceKeyStarknet=t.NameSpaceKeyTron=t.NameSpaceKeyCosmos=t.NameSpaceKeyAptos=t.NameSpaceKeyBtc=t.NameSpaceKeySui=t.NameSpaceKeyTON=t.NameSpaceKeySOL=t.NameSpaceKeyEip155=t.OpenAppLinkType=void 0,function(e){e["UniversalLink"]="universallink",e["DeepLink"]="deeplink"}(n||(t.OpenAppLinkType=n={})),t.NameSpaceKeyEip155="eip155",t.NameSpaceKeySOL="solana",t.NameSpaceKeyTON="ton",t.NameSpaceKeySui="sui",t.NameSpaceKeyBtc="btc",t.NameSpaceKeyAptos="aptos",t.NameSpaceKeyCosmos="cosmos",t.NameSpaceKeyTron="tron",t.NameSpaceKeyStarknet="starknet"},6229:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};function o(e,t){return n(this,void 0,void 0,(function*(){var n,o;const r=null!==(n=null===t||void 0===t?void 0:t.attempts)&&void 0!==n?n:3,s=null!==(o=null===t||void 0===t?void 0:t.delayMs)&&void 0!==o?o:800;if("function"!==typeof e)throw new Error("Expected a function, got "+typeof e);let c,a=0;while(a<r)try{return yield e()}catch(l){c=l,a++,a<r&&(yield i(s))}throw c}))}function i(e,t){return n(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{var i,r;if(null===(i=null===t||void 0===t?void 0:t.signal)||void 0===i?void 0:i.aborted)return void o(new Error("Delay aborted"));const s=setTimeout((()=>n()),e);null===(r=null===t||void 0===t?void 0:t.signal)||void 0===r||r.addEventListener("abort",(()=>{clearTimeout(s),o(new Error("Delay aborted"))}))}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.callForSuccess=o,t.delay=i},2581:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.getNamespaceKeyByChain=t.chainName2IdMap=t.replaceChainIdToChainName=t.replaceChainNameToChainId=t.checkMetaData=t.versionCompare=t.isBrowser=t.isOS=t.isMobileUserAgent=t.openDeeplinkWithFallback=t.openLinkBlank=t.openLink=t.getChainId=t.useShortLink=t.toSafeBase64FromBase64=t.isValidObject=t.isIos=t.base64decode=t.base64encode=t.splitToUint8Arrays=t.concatUint8Arrays=t.toHexString=t.hexToByteArray=t.getOKXLink=t.getAppWalletShortDeepLink=t.encodeTWAConnectURLParams=t.encodeConnectParams=t.openOKXTMAWalletlinkWithFallback=t.getTelegramWalletTWAUrl=t.getAppWalletDeepLink=t.encodeTelegramUrlParameters=t.isTelegramUrl=t.openOKXDeeplinkWithFallback=t.openOKXDeeplink=t.getUniversalLink=t.safeJsonStringify=t.safeJsonParse=t.getDefaultReporter=t.reportEvent=t.reportLog=t.logWarning=t.logError=t.logDebug=t.callForSuccess=void 0;var r=n(6229);Object.defineProperty(t,"callForSuccess",{enumerable:!0,get:function(){return r.callForSuccess}});var s=n(9323);Object.defineProperty(t,"logDebug",{enumerable:!0,get:function(){return s.logDebug}}),Object.defineProperty(t,"logError",{enumerable:!0,get:function(){return s.logError}}),Object.defineProperty(t,"logWarning",{enumerable:!0,get:function(){return s.logWarning}}),Object.defineProperty(t,"reportLog",{enumerable:!0,get:function(){return s.reportLog}}),Object.defineProperty(t,"reportEvent",{enumerable:!0,get:function(){return s.reportEvent}}),Object.defineProperty(t,"getDefaultReporter",{enumerable:!0,get:function(){return s.getDefaultReporter}}),i(n(5266),t),i(n(9467),t);var c=n(5058);Object.defineProperty(t,"safeJsonParse",{enumerable:!0,get:function(){return c.safeJsonParse}}),Object.defineProperty(t,"safeJsonStringify",{enumerable:!0,get:function(){return c.safeJsonStringify}});var a=n(1716);Object.defineProperty(t,"getUniversalLink",{enumerable:!0,get:function(){return a.getUniversalLink}}),Object.defineProperty(t,"openOKXDeeplink",{enumerable:!0,get:function(){return a.openOKXDeeplink}}),Object.defineProperty(t,"openOKXDeeplinkWithFallback",{enumerable:!0,get:function(){return a.openOKXDeeplinkWithFallback}}),Object.defineProperty(t,"isTelegramUrl",{enumerable:!0,get:function(){return a.isTelegramUrl}}),Object.defineProperty(t,"encodeTelegramUrlParameters",{enumerable:!0,get:function(){return a.encodeTelegramUrlParameters}}),Object.defineProperty(t,"getAppWalletDeepLink",{enumerable:!0,get:function(){return a.getAppWalletDeepLink}}),Object.defineProperty(t,"getTelegramWalletTWAUrl",{enumerable:!0,get:function(){return a.getTelegramWalletTWAUrl}}),Object.defineProperty(t,"openOKXTMAWalletlinkWithFallback",{enumerable:!0,get:function(){return a.openOKXTMAWalletlinkWithFallback}}),Object.defineProperty(t,"encodeConnectParams",{enumerable:!0,get:function(){return a.encodeConnectParams}}),Object.defineProperty(t,"encodeTWAConnectURLParams",{enumerable:!0,get:function(){return a.encodeTWAConnectURLParams}}),Object.defineProperty(t,"getAppWalletShortDeepLink",{enumerable:!0,get:function(){return a.getAppWalletShortDeepLink}}),Object.defineProperty(t,"getOKXLink",{enumerable:!0,get:function(){return a.getOKXLink}});var l=n(8384);Object.defineProperty(t,"hexToByteArray",{enumerable:!0,get:function(){return l.hexToByteArray}}),Object.defineProperty(t,"toHexString",{enumerable:!0,get:function(){return l.toHexString}}),Object.defineProperty(t,"concatUint8Arrays",{enumerable:!0,get:function(){return l.concatUint8Arrays}}),Object.defineProperty(t,"splitToUint8Arrays",{enumerable:!0,get:function(){return l.splitToUint8Arrays}}),Object.defineProperty(t,"base64encode",{enumerable:!0,get:function(){return l.base64encode}}),Object.defineProperty(t,"base64decode",{enumerable:!0,get:function(){return l.base64decode}}),Object.defineProperty(t,"isIos",{enumerable:!0,get:function(){return l.isIos}}),Object.defineProperty(t,"isValidObject",{enumerable:!0,get:function(){return l.isValidObject}}),Object.defineProperty(t,"toSafeBase64FromBase64",{enumerable:!0,get:function(){return l.toSafeBase64FromBase64}}),Object.defineProperty(t,"useShortLink",{enumerable:!0,get:function(){return l.useShortLink}}),Object.defineProperty(t,"getChainId",{enumerable:!0,get:function(){return l.getChainId}});var d=n(8534);Object.defineProperty(t,"openLink",{enumerable:!0,get:function(){return d.openLink}}),Object.defineProperty(t,"openLinkBlank",{enumerable:!0,get:function(){return d.openLinkBlank}}),Object.defineProperty(t,"openDeeplinkWithFallback",{enumerable:!0,get:function(){return d.openDeeplinkWithFallback}}),Object.defineProperty(t,"isMobileUserAgent",{enumerable:!0,get:function(){return d.isMobileUserAgent}}),Object.defineProperty(t,"isOS",{enumerable:!0,get:function(){return d.isOS}}),Object.defineProperty(t,"isBrowser",{enumerable:!0,get:function(){return d.isBrowser}});var u=n(8294);Object.defineProperty(t,"versionCompare",{enumerable:!0,get:function(){return u.versionCompare}});var g=n(2432);Object.defineProperty(t,"checkMetaData",{enumerable:!0,get:function(){return g.checkMetaData}});var h=n(8384);Object.defineProperty(t,"replaceChainNameToChainId",{enumerable:!0,get:function(){return h.replaceChainNameToChainId}}),Object.defineProperty(t,"replaceChainIdToChainName",{enumerable:!0,get:function(){return h.replaceChainIdToChainName}}),Object.defineProperty(t,"chainName2IdMap",{enumerable:!0,get:function(){return h.chainName2IdMap}}),Object.defineProperty(t,"getNamespaceKeyByChain",{enumerable:!0,get:function(){return h.getNamespaceKeyByChain}})},9323:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.logVersion=void 0,t.getDefaultReporter=a,t.logDebug=u,t.logError=g,t.logWarning=h,t.reportEvent=p,t.reportLog=f;const i=!1,r=!1,s=n(9467),c=new s.OKXReporter;function a(){return c}const l=n(3636),d=l.version;function u(...e){if("undefined"!=typeof console)try{(i||(null===window||void 0===window?void 0:window.okxLogDebug))&&console.log(`[OKX_CONNECT_SDK1] ${d} `,...e)}catch(t){}}function g(...e){if("undefined"!=typeof console)try{if((i||(null===window||void 0===window?void 0:window.okxLogDebug))&&console.error(`[OKX_CONNECT_SDK1] ${d} `,...e),r||!i){let t="";t+=[...e].reduce(((e,t)=>{"string"==typeof t?","+t:"object"==typeof t&&JSON.stringify(t)})),c.sendRecordContent(t,s.OKXReportType.LOG,"")}}catch(t){}}function h(...e){if("undefined"!=typeof console)try{(i||(null===window||void 0===window?void 0:window.okxLogDebug))&&console.warn(`[OKX_CONNECT_SDK1] ${d} `,...e)}catch(t){}}function p(e,t,n){return o(this,arguments,void 0,(function*(e,t,n,o=void 0,i=void 0,r=void 0,s=void 0,a=void 0,l=void 0){try{yield c.sendRecordContent(n,e,t,o,i,r,s,a,l)}catch(d){}}))}function f(e){return o(this,arguments,void 0,(function*(e,t="default"){}))}t.logVersion=d},5961:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaNotTouch=t.mediaTouch=t.maxWidth=void 0,t.isDevice=c,t.media=a,t.mediaMin=l,t.mediaMax=d,t.mediaMinMax=u;const o=n(8534),i=n(8294),r=n(1716),s=n(9323);function c(e){var n;const c=(0,r.getWindow)();if(!c)return"desktop"===e;if((0,i.isTmaPlatform)("weba"))return!0;const a=c.innerWidth;switch(e){case"desktop":return a>t.maxWidth.tablet;case"tablet":return a>t.maxWidth.mobile;default:case"mobile":let e=a<=t.maxWidth.mobile||(0,o.isOS)("ios","android","ipad");if(e){const t=!!(null===(n=(0,r.getWindow)())||void 0===n?void 0:n.TelegramWebviewProxy),o=navigator.maxTouchPoints||0;t&&0===o&&(e=!1),(0,s.logDebug)("isDevice mobile isTelegram and maxTouchPoints:",e,t,o)}return e}}function a(e){switch(e){case"mobile":return`@media (max-width: ${t.maxWidth.mobile}px)`;case"tablet":return`@media (max-width: ${t.maxWidth.tablet}px) (min-width: ${t.maxWidth.mobile}px)`;default:case"desktop":return`@media (min-width: ${t.maxWidth.tablet}px)`}}function l(e){return`@media (min-width: ${e}px)`}function d(e){return`@media (max-width: ${e}px)`}function u(e,t){return`@media (min-width: ${e}px) and (max-width: ${t}px)`}t.maxWidth={mobile:440,tablet:1020},t.mediaTouch="@media (hover: none)",t.mediaNotTouch="@media not all and (hover: none)"},9467:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXReporter=t.OKXReportSide=t.OKXReportType=t.versionStr=void 0;const r=i(n(7240)),s=n(9323),c=n(1716),a=n(2581),l=i(n(149));t.versionStr="1.8.6";const d=["https://www.okx.com/dappstat/wallet-connect","https://www.okx.ac/dappstat/wallet-connect"],u="OKX_RP_CK",g="OKX_RP_UUID_CK",h=100,p={Accept:"*/*","Content-Type":"text/plain"},f="POST",O={headers:p,method:f};t.OKXReportType={PAGE_IN:"page_in",PAGE_OUT:"page_out",CLICK:"click",LOG:"log"},t.OKXReportSide={DAPP:"dapp",WALLET:"wallet"};const v=(e,...t)=>o(void 0,[e,...t],void 0,(function*(e,t={},n=5e3){for(const i of e)try{const e=new AbortController,o=e.signal,s=(0,r.default)(i,Object.assign(Object.assign({},t),{signal:o})),c=new Promise(((t,o)=>setTimeout((()=>{e.abort(),o(new Error("Request timed out"))}),n))),a=yield Promise.race([s,c]);if(a.ok)return a;if(502==a.status)return console.error("Fetch error status 502",i),a}catch(o){console.error(`Fetch error for ${i}:`,o)}throw console.error("'All fetch attempts failed.'"),new Error("All fetch attempts failed.")}));class _{constructor(){this.currentSide=t.OKXReportSide.DAPP,this.currentVersion=t.versionStr,this.storage=l.default.createInstance({name:"OKXReporter"}),this.recordList=new Array,this.currentUUID="fjdkakfjsadkfklasdkfsdjkljfklsdjklfioruer3239084dkskfsa"}configVersionAndSide(e,t,n){this.currentVersion=e+s.logVersion,this.currentSide=t,this.appName=n}get recordCacheKey(){return u+"@"+this.appName}get reportPlatform(){return(0,a.isMobileUserAgent)()?(0,a.isIos)()?"iOS":"android":"pc"}beginReport(){return o(this,void 0,void 0,(function*(){this.startErrorCatching();let e=yield this.storage.getItem(this.recordCacheKey),t=yield this.storage.getItem(g);t?this.currentUUID=t:this.storage.setItem(g,this.currentUUID),e&&(this.recordList=e,(0,s.logDebug)("resume records from cache length: ",this.recordList.length),yield this.sendCachedRecords())}))}startErrorCatching(){let e=(0,c.getWindow)();e&&(0,s.logDebug)("begin capture console error")}cachedErrors(){return this.recordList}sendRecord(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,n)=>o(this,void 0,void 0,(function*(){try{const o=JSON.stringify(e);(0,s.logDebug)("[REPORT] record: ",o);const i=yield v(d,Object.assign(Object.assign({},O),{body:o}));(0,s.logDebug)("[REPORT] get rsp:",i),i&&i.status&&200==i.status?(this.recordList=this.recordList.filter((t=>t.timestamp!=e.timestamp||t.content!=e.content)),yield this.storage.setItem(this.recordCacheKey,this.recordList),t(!0)):n(!1)}catch(o){(0,s.logDebug)("send record error:",o),t(!0)}}))))}))}sendRecordContent(e,t,n){return o(this,arguments,void 0,(function*(e,t,n,o=void 0,i=void 0,r=void 0,s=void 0,a=void 0,l=void 0){var d,u,g,h;let p=null===(d=(0,c.getWindow)())||void 0===d?void 0:d.location.pathname,f=null===(u=(0,c.getWindow)())||void 0===u?void 0:u.location.origin;p&&f&&(f+=p);let O=null===(g=(0,c.getWindow)())||void 0===g?void 0:g.navigator.language,v=null===(h=(0,c.getWindow)())||void 0===h?void 0:h.navigator.userAgent,_=this.reportPlatform,C={uuid:this.currentUUID,version:this.currentVersion,content:e,action:n,side:this.currentSide,timestamp:(new Date).getTime(),url:f,lang:O,type:t,platform:_,"user-agent":v,reverved1:o,reverved2:i,reverved3:r,reverved4:s,reverved5:a,reverved6:l};yield this.markRecordItem(C),yield this.sendRecord(C)}))}sendCachedRecords(){return o(this,void 0,void 0,(function*(){return new Promise(((e,t)=>o(this,void 0,void 0,(function*(){let n=this.recordList.map((e=>this.sendRecord(e)));(0,s.logDebug)("[REPORT] submit & clean recorded caches begin @",(new Date).toUTCString()),Promise.allSettled(n).then((n=>{(0,s.logDebug)("[REPORT] submit & clean recorded caches ends @",(new Date).toUTCString());let o=[];n.forEach(((e,t)=>{"rejected"==e.status&&o.push(t)})),this.recordList=this.recordList.filter(((e,t)=>!o.includes(t))),this.storage.setItem(this.recordCacheKey,this.recordList).then((function(t){e()})).catch((function(e){t(e)}))}))}))))}))}markRecordItem(e){return o(this,void 0,void 0,(function*(){if(this.recordList.push(e),this.recordList.length>h){let e=this.recordList.length-h;this.recordList.splice(0,e)}return new Promise(((t,n)=>{this.storage.setItem(this.recordCacheKey,this.recordList).then((function(n){t(e)})).catch((function(e){n(e)}))}))}))}}t.OKXReporter=_},5266:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Report_WalletType_Key=t.Report_OKXConnectSDK_RequestError_Log=t.Report_OKXConnectSDK_RequestSuccess_Log=t.Report_OKXConnectSDK_RequestStart_Log=t.Report_OKXConnectSDKExtension_ConnectDapp_Button_Click=t.Report_OKXConnectSDKExtension_Module_Retry_Click=t.Report_ConnectDapp_ConnectAndSign_Click=t.Report_Proceed_QRCode_Click=t.Report_ChooseType_Download_Click=t.Report_ChooseType_ConnectWallet_Click=t.Report_Proceed_Retry_Click=t.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View=t.Report_OKXConnectSDKExtension_ConnectDapp_Page_View=t.Report_ChooseType_ConnectWallet_View=t.Report_Loading_ConnectWallet_View=t.Report_Proceed_QRCode_View=t.Report_Proceed_Proceed_View=void 0,t.Report_Proceed_Proceed_View="OKXConnectSDK_Proceed_Proceed_View",t.Report_Proceed_QRCode_View="OKXConnectSDK_Proceed_QRCode_View",t.Report_Loading_ConnectWallet_View="OKXConnectSDK_Loading_ConnectWallet_View",t.Report_ChooseType_ConnectWallet_View="OKXConnectSDK_ChooseType_ConnectWallet_View",t.Report_OKXConnectSDKExtension_ConnectDapp_Page_View="OKXConnectSDKExtension_ConnectDapp_Page_View",t.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View="OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View",t.Report_Proceed_Retry_Click="OKXConnectSDK_Proceed_Retry_Click",t.Report_ChooseType_ConnectWallet_Click="OKXConnectSDK_ChooseType_ConnectWallet_Click",t.Report_ChooseType_Download_Click="OKXConnectSDK_ChooseType_Download_Click",t.Report_Proceed_QRCode_Click="OKXConnectSDK_Proceed_QRCode_Click",t.Report_ConnectDapp_ConnectAndSign_Click="OKXConnectSDK_ConnectDapp_ConnectAndSign_Click",t.Report_OKXConnectSDKExtension_Module_Retry_Click="OKXConnectSDKExtension_Module_Retry_Click",t.Report_OKXConnectSDKExtension_ConnectDapp_Button_Click="OKXConnectSDKExtension_ConnectDapp_Button_Click",t.Report_OKXConnectSDK_RequestStart_Log="Report_OKXConnectSDK_RequestStart_View",t.Report_OKXConnectSDK_RequestSuccess_Log="Report_OKXConnectSDK_RequestSuccess_View",t.Report_OKXConnectSDK_RequestError_Log="Report_OKXConnectSDK_RequestError_View",t.Report_WalletType_Key="wallet_type"},2432:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkMetaData=i;const o=n(852);function i(e){if(!e)throw new o.OKXConnectError(o.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"You have to specify a `dappMetaData`in the options.");if(!e.name)throw new o.OKXConnectError(o.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"dappName is required");return!0}},5058:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=s,t.safeJsonStringify=c;const o=n(9323),i=e=>JSON.stringify(e,((e,t)=>"bigint"===typeof t?t.toString()+"n":t)),r=e=>{const t=/:(\b\d{17,}|\b(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\}\]]|$)/g,n=e.replace(t,((e,t)=>`:"${t}n"`));try{return JSON.parse(n,((e,t)=>{const n="string"===typeof t&&t.match(/^\d+n$/);return n?BigInt(t.substring(0,t.length-1)):t}))}catch(o){return JSON.parse(e)}};function s(e){if("string"!==typeof e)throw(0,o.logDebug)(e),new Error("Cannot safe json parse value of type "+typeof e);try{return r(e)}catch(t){return console.error("safeJsonParse error:",t),e}}function c(e){return"string"===typeof e?e:i(e)||""}},8991:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),Object.defineProperty(t,"__esModule",{value:!0}),t.okxfromString=r,t.okxtoString=s,t.alloc=c,t.allocUnsafe=a;const o=n(2188),i=n(9323);function r(e,t="utf8"){const n=g[t];if((0,i.logDebug)("okxfromstring ====> "),!n)throw new Error(`Unsupported encoding "${t}"`);return n.decoder.decode(`${n.prefix}${e}`)}function s(e,t="utf8"){const n=g[t];if((0,i.logDebug)("okxtoString ====> "),!n)throw new Error(`Unsupported encoding "${t}"`);return n.encoder.encode(e).substring(1)}function c(e=0){return new Uint8Array(e)}function a(e=0){return new Uint8Array(e)}function l(e,t,n,o){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:o}}}const d=l("utf8","u",(e=>{const t=new TextDecoder("utf8");return"u"+t.decode(e)}),(e=>{const t=new TextEncoder;return t.encode(e.substring(1))})),u=l("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++){let o=e[n];o&&String.fromCharCode(o)&&(t+=String.fromCharCode(o))}return t}),(e=>{e=e.substring(1);const t=a(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),g=Object.assign({utf8:d,"utf-8":d,hex:o.bases.base16,latin1:u,ascii:u,binary:u},o.bases)},8294:function(e,t,n){"use strict";var o,i,r,s,c,a,l;n(4603),n(7566),n(8721),Object.defineProperty(t,"__esModule",{value:!0}),t.isTmaPlatform=v,t.isInTMA=_,t.inTg=C,t.isInTelegramBrowser=E,t.sendExpand=y,t.sendOpenTelegramLink=m,t.versionCompare=R;const d=n(1716),u=n(9323),g=n(852),h=n(8534);let p={};try{let e=location.hash.toString();p=T(e)}catch(P){}let f="unknown";if((null===p||void 0===p?void 0:p.tgWebAppPlatform)&&(f=null!==(o=p.tgWebAppPlatform)&&void 0!==o?o:"unknown"),"unknown"===f){const e=(0,d.getWindow)();f=null!==(s=null===(r=null===(i=null===e||void 0===e?void 0:e.Telegram)||void 0===i?void 0:i.WebApp)||void 0===r?void 0:r.platform)&&void 0!==s?s:"unknown"}let O="6.0";if((null===p||void 0===p?void 0:p.tgWebAppVersion)&&(O=p.tgWebAppVersion),!O){const e=(0,d.getWindow)();O=null!==(l=null===(a=null===(c=null===e||void 0===e?void 0:e.Telegram)||void 0===c?void 0:c.WebApp)||void 0===a?void 0:a.version)&&void 0!==l?l:"6.0"}function v(...e){return e.includes(f)}function _(){var e;return"unknown"!==f||!!(null===(e=(0,d.getWindow)())||void 0===e?void 0:e.TelegramWebviewProxy)}function C(){return E()||_()}function E(){var e;const t=!!(null===(e=(0,d.getWindow)())||void 0===e?void 0:e.TelegramWebview);return(_()||t)&&"unknown"===f}function y(){b("web_app_expand",{})}function m(e,t){const n=new URL(e);if("http:"!==n.protocol&&"https:"!==n.protocol){if(t)return t();throw new g.OKXConnectError(g.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Url protocol is not supported: ${n}`)}if("t.me"!==n.hostname){if(t)return t();throw new g.OKXConnectError(g.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Url host is not supported: ${n}`)}const o=n.pathname+n.search;N()||D("6.1")?b("web_app_open_tg_link",{path_full:o}):(0,h.openLinkBlank)("https://t.me"+o)}function N(){try{const e=(0,d.getWindow)();return!!e&&(null!=e.parent&&e!==e.parent)}catch(P){return!1}}function b(e,t){try{const n=(0,d.getWindow)();if(!n)throw new g.OKXConnectError(g.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Can't post event to parent window: window is not defined");if(void 0!==n.TelegramWebviewProxy)(0,u.logDebug)("postEvent",e,t),n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));else if(n.external&&"notify"in n.external)(0,u.logDebug)("postEvent",e,t),n.external.notify(JSON.stringify({eventType:e,eventData:t}));else{if(!N())throw new g.OKXConnectError(g.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Can't post event to TMA");{const o="*",i=JSON.stringify({eventType:e,eventData:t});(0,u.logDebug)("postEvent",e,t),n.parent.postMessage(i,o)}}}catch(P){(0,u.logError)(`Can't post event to parent window: ${P}`)}}function T(e){e=e.replace(/^#/,"");let t={};if(!e.length)return t;if(e.indexOf("=")<0&&e.indexOf("?")<0)return t._path=S(e),t;let n=e.indexOf("?");if(n>=0){let o=e.substr(0,n);t._path=S(o),e=e.substr(n+1)}let o=w(e);for(let i in o)t[i]=o[i];return t}function S(e){try{return e=e.replace(/\+/g,"%20"),decodeURIComponent(e)}catch(P){return e}}function w(e){let t={};if(!e.length)return t;let n,o,i,r,s=e.split("&");for(n=0;n<s.length;n++)o=s[n].split("="),i=S(o[0]),r=null==o[1]?null:S(o[1]),t[i]=r;return t}function R(e,t){"string"!==typeof e&&(e=""),"string"!==typeof t&&(t="");let n,o,i,r,s=e.replace(/^\s+|\s+$/g,"").split("."),c=t.replace(/^\s+|\s+$/g,"").split(".");for(n=Math.max(s.length,c.length),o=0;o<n;o++)if(i=parseInt(s[o])||0,r=parseInt(c[o])||0,i!==r)return i>r?1:-1;return 0}function D(e){return R(O,e)>=0}},1716:function(e,t,n){"use strict";var o,i,r,s;n(4979),n(4603),n(7566),n(8721),Object.defineProperty(t,"__esModule",{value:!0}),t.removeUrlLastSlash=h,t.addPathToUrl=p,t.getUniversalLink=f,t.openOKXDeeplink=O,t.openOKXDeeplinkWithFallback=v,t.getWindow=_,t.isTelegramUrl=C,t.encodeTelegramUrlParameters=E,t.encodeConnectParams=y,t.encodeTWAConnectURLParams=m,t.getAppWalletDeepLink=N,t.getAppWalletShortDeepLink=b,t.getTelegramWalletTWAUrl=T,t.openOKXTMAWalletlinkWithFallback=S,t.isInTMA=I,t.isInTelegramBrowser=K,t.getOKXLink=A;const c=n(852),a=n(9323),l=n(2329),d=n(8384),u=n(8294),g=n(9795);function h(e){return"/"===e.slice(-1)?e.slice(0,-1):e}function p(e,t){return h(e)+"/"+t}function f(e,t=!1){console.log("getUniversalLink deeplinkUrl:",e,", useStandardUniversalLink:",t);const n=encodeURIComponent(e);return console.log("getUniversalLink standardUniversalLink:",c.standardUniversalLink),console.log("getUniversalLink standardUniversalLink:",`${c.standardUniversalLink}?deeplink=${n}`),`${c.standardUniversalLink}?deeplink=${n}`}function O(e,t,n){v(e,t,n,!1)}function v(e,t,n,o=!0){var i;const r=!!(null===(i=_())||void 0===i?void 0:i.TelegramWebviewProxy);console.log("openOKXDeeplinkWithFallback fullUrl:",t);let s=!1;const a=3e3;c.standardUniversalLink;console.log("openOKXDeeplinkWithFallback standardUniversalLink:",c.standardUniversalLink);let l=null,u=()=>{console.log("fallbackToDownloadPage :empty")},g=!1;if(g=n===c.OpenAppLinkType.UniversalLink?(0,d.isInIOSChrome)()||(0,d.isInIOSLine)()||(0,d.isInIOSLark)()||(0,d.isInIOSWeChat)():!1===r&&(0,d.isIos)(),o&&((0,d.isIos)()?g&&(u=()=>{console.log("windowOpen --\x3e fallbackToDownloadPage --",s),s||(console.log("windowOpen --\x3e fallbackToDownloadPage universal link"),window.open(t,"_self"))}):u=()=>{s||(l?l.open(t,"_self"):window.open(t,"_blank"))}),!(0,d.isIos)()||g){if(r?l=window.open(e,"_blank"):(console.log("windowOpen --\x3e deeplinkUrl"),window.location.href=e),o){setTimeout(u,a);let e=0,t=setInterval((()=>{e++,console.log("windowOpen --\x3e interval:",e,document.hidden,document.visibilityState),document.hidden&&(s=!0),(e>10||document.hidden)&&(clearInterval(t),console.log("windowOpen :cleat: ${count}"))}),200);window.addEventListener("blur",(()=>{console.log("windowOpen :blur"),s=!0}),{once:!0}),document.addEventListener("visibilitychange",(()=>{console.log("windowOpen :visibilitychange:",document.visibilityState),"hidden"===document.visibilityState&&(s=!0)}))}}else r?window.open(t,"_blank"):(console.log("windowOpen[before]: ",Date.now()),(null===window||void 0===window?void 0:window.okxLogDebug)?window.open(t,"_blank"):window.open(t,"_self"),console.log("windowOpen[after]: ",Date.now()))}function _(){if("undefined"!==typeof window)return window}function C(e){if(!e)return!1;const t=new URL(e);return"tg:"===t.protocol||"t.me"===t.hostname}function E(e){let t=e;return t=t.replace(/\./g,"%2E"),t=t.replace(/-/g,"%2D"),t=t.replace(/_/g,"%5F"),t=t.replace(/&/g,"-"),t=t.replace(/=/g,"__"),t=t.replace(/%/g,"--"),t}function y(e){let t=Object.assign(Object.assign({},e),{protocolVersion:g.CONNECT_PROTOCOL_VER});const n=JSON.stringify(t);(0,a.logDebug)("url encodeConnectParams connectRequestStr ",n);const o=(new TextEncoder).encode(n),i=btoa(String.fromCharCode(...o));return(0,a.logDebug)("url encodeConnectParams base64Encoded ",i),i}function m(e){const t=JSON.stringify({topic:e.topic,clientId:e.clientId});(0,a.logDebug)("url encodeConnectParams connectRequestStr",t);const n=(new TextEncoder).encode(t),o=btoa(String.fromCharCode(...n));return o}function N(e){return`${c.standardDeeplink}?param=${e}`}function b(e,t){return`${l.shortUniversalLink}?topic=${e}${(0,d.getLastSixMd5Hash)(t)}`}function T(e,t){let n={okxconnect:"",redirect:"",extraparams:"",fromtg:!1};e&&(n.okxconnect=e),t&&(n.redirect=t),I()?n.fromtg=!0:n.fromtg=!1,(0,a.logDebug)("getTelegramWalletTWAUrl redirect:",n.redirect);let o=JSON.stringify(n);const i=(new TextEncoder).encode(o),r=btoa(String.fromCharCode(...i)),s=(0,d.toSafeBase64FromBase64)(r);if((0,a.logDebug)("[TWA] open link:",n,r),e||t){if(I())return(0,l.getTestTgTwaUrl)()?`${(0,l.getTestTgTwaUrl)()}?startapp=${s}`:`https://t.me/${l.tgwalletName}/start?startapp=${s}`;if((0,l.getTestTwaUrl)())return`${(0,l.getTestTwaUrl)()}?tgWebAppStartParam=${s}`;if((0,l.getTestTgTwaUrl)()){let e=(0,l.getBotNameAndAppName)((0,l.getTestTgTwaUrl)());if(e){let{botName:t,appName:n}=e;return`tg://resolve?domain=${t}&appname=${n}&startapp=${s}`}return`tg://resolve?domain=${l.tgwalletName}&appname=${l.tgwalletAppName}&startapp=${s}`}return`tg://resolve?domain=${l.tgwalletName}&appname=${l.tgwalletAppName}&startapp=${s}`}if(I())return(0,l.getTestTgTwaUrl)()?`${(0,l.getTestTgTwaUrl)()}`:`https://t.me/${l.tgwalletName}/start`;if((0,l.getTestTwaUrl)())return`${(0,l.getTestTwaUrl)()}`;if((0,l.getTestTgTwaUrl)()){let e=(0,l.getBotNameAndAppName)((0,l.getTestTgTwaUrl)());if(e){let{botName:t,appName:n}=e;return`tg://resolve?domain=${t}&appname=${n}`}return`tg://resolve?domain=${l.tgwalletName}&appname=${l.tgwalletAppName}`}return`tg://resolve?domain=${l.tgwalletName}&appname=${l.tgwalletAppName}`}function S(e){var t,n,o,i,r;(0,a.logDebug)("[TWA] open link:",e,"isInTMA ==> ",I()),I()?(null===(n=null===(t=_())||void 0===t?void 0:t.Telegram)||void 0===n?void 0:n.WebApp)?null===(r=null===(i=null===(o=_())||void 0===o?void 0:o.Telegram)||void 0===i?void 0:i.WebApp)||void 0===r||r.openTelegramLink(e):(0,u.sendOpenTelegramLink)(e):(0,l.getTestTwaUrl)()?window.open(e,"_blank"):window.open(e,"_self")}function w(e){try{return e=e.replace(/\+/g,"%20"),decodeURIComponent(e)}catch(t){return e}}function R(e){let t={};if(!e.length)return t;let n,o,i,r,s=e.split("&");for(n=0;n<s.length;n++)o=s[n].split("="),i=w(o[0]),r=null==o[1]?null:w(o[1]),t[i]=r;return t}function D(e){e=e.replace(/^#/,"");let t={};if(!e.length)return t;if(e.indexOf("=")<0&&e.indexOf("?")<0)return t._path=w(e),t;let n=e.indexOf("?");if(n>=0){let o=e.substr(0,n);t._path=w(o),e=e.substr(n+1)}let o=R(e);for(let i in o)t[i]=o[i];return t}let P={};try{let e=location.hash.toString();P=D(e)}catch(M){}let k="unknown";if((null===P||void 0===P?void 0:P.tgWebAppPlatform)&&(k=null!==(o=P.tgWebAppPlatform)&&void 0!==o?o:"unknown"),"unknown"===k){const e=_();k=null!==(s=null===(r=null===(i=null===e||void 0===e?void 0:e.Telegram)||void 0===i?void 0:i.WebApp)||void 0===r?void 0:r.platform)&&void 0!==s?s:"unknown"}function I(){var e;return"unknown"!==k||!!(null===(e=_())||void 0===e?void 0:e.TelegramWebviewProxy)}function K(){var e;const t=!!(null===(e=_())||void 0===e?void 0:e.TelegramWebview);return(I()||t)&&"unknown"===k}function A(e,t=!1,n){if((0,a.logDebug)(`url  getOKXLink() called connectRequest==> ${JSON.stringify(e)}  useMini=> ${t}  tmaReturnUrl==> ${n}`),t)return e?{universalLink:T(m(e),null!==n&&void 0!==n?n:"back")}:{universalLink:T(void 0,null!==n&&void 0!==n?n:"back")};{let t=e?`${c.standardDeeplink}?param=${y(e)}`:c.standardDeeplink;if((0,d.useShortLink)()){let n=e?b(e.topic,e.clientId):l.shortUniversalLink;return{universalLink:n,deepLink:t}}return{universalLink:f(t),deepLink:t}}}},8384:function(e,t,n){"use strict";n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.chainName2IdMap=t.isValidObject=t.RANDOM_LENGTH=t.isBrowser=t.resolveLocalStorage=t.hasLocalStorage=t.hasBuiltInWebSocket=t.resolveWebSocketImplementation=void 0,t.hexToByteArray=p,t.getChainId=f,t.toHexString=O,t.concatUint8Arrays=v,t.splitToUint8Arrays=_,t.base64encode=y,t.base64decode=m,t.checkWSUrl=N,t.hashKey=D,t.generateRandomBytes32=P,t.generateTopic=k,t.generateGroupId=I,t.isInIOSLine=A,t.isInIOSLark=M,t.isInIOSChrome=L,t.isInIOSWeChat=j,t.isIos=X,t.getLastSixMd5Hash=W,t.toSafeBase64FromBase64=x,t.useShortLink=U,t.replaceChainNameToChainId=H,t.replaceChainIdToChainName=J,t.getNamespaceKeyByChain=B,t.scopePollingDetectionStrategy=V;const i=o(n(998)),r=o(n(7294)),s=n(6876),c=n(3351),a=n(5058),l=n(9323),d=n(8991),u=o(n(4473)),g=n(852),h="base16";function p(e){if(e.length%2!==0)throw new Error(`Cannot convert ${e} to bytesArray`);const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.slice(n,n+2),16);return t}function f(e){return e.includes(":")?e.split(":")[1]:e}function O(e){let t="";return e.forEach((e=>{t+=("0"+(255&e).toString(16)).slice(-2)})),t}function v(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function _(e,t){if(t>=e.length)throw new Error("Index is out of buffer");const n=e.slice(0,t),o=e.slice(t);return[n,o]}function C(e,t){const n=r.default.encodeBase64(e);return t?encodeURIComponent(n):n}function E(e,t){return t&&(e=decodeURIComponent(e)),r.default.decodeBase64(e)}function y(e,t){let n;return e instanceof Uint8Array?n=e:("string"!==typeof e&&(e=(0,a.safeJsonStringify)(e)),n=r.default.decodeUTF8(e)),C(n,t)}function m(e,t){const n=E(e,t);return{toString(){return r.default.encodeUTF8(n)},toObject(){try{return(0,a.safeJsonParse)(r.default.encodeUTF8(n))}catch(e){return null}},toUint8Array(){return n}}}function N(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!t||!t.length)return!1;let n=t[0];return void 0!==n&&new RegExp("^wss?:").test(n)}const b=()=>"undefined"!==typeof WebSocket?WebSocket:"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket?n.g.WebSocket:"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket?window.WebSocket:"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket?self.WebSocket:WebSocket;t.resolveWebSocketImplementation=b;const T=()=>"undefined"!==typeof WebSocket||"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket||"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket||"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket;t.hasBuiltInWebSocket=T;const S=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage||"undefined"!==typeof window&&"undefined"!==typeof window.localStorage;t.hasLocalStorage=S;const w=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage?n.g.localStorage:"undefined"!==typeof window&&"undefined"!==typeof window.localStorage?window.localStorage:localStorage;t.resolveLocalStorage=w;const R=()=>"undefined"!==typeof window;function D(e,t=h){(0,l.logDebug)(`hash key called ${e}`);const n=(0,c.hash)((0,d.okxfromString)(e,t));return(0,s.toString)(n,t)}function P(){return i.default.randomBytes(t.RANDOM_LENGTH)}function k(){let e=P();return(0,l.logDebug)(`generate topic called ${e}`),D((0,s.toString)(e,h))}function I(){let e=i.default.randomBytes(16);return(0,l.logDebug)(`generate groupid called ${e}`),D((0,s.toString)(e,h))}t.isBrowser=R,t.RANDOM_LENGTH=32;const K=e=>Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length;function A(){const e=navigator.userAgent,t=e.includes("Safari Line/");return t&&X()}function M(){const e=navigator.userAgent,t=e.includes("Lark/");return t&&X()}function L(){const e=navigator.userAgent,t=e.includes("CriOS/");return t&&X()}function j(){const e=navigator.userAgent,t=e.includes("MicroMessenger/");return t&&X()}function X(){const e=navigator.userAgent,t=navigator.maxTouchPoints||0,n=/iPad|iPhone|iPod/.test(e)&&!window.MSStream,o=e.includes("Mac")&&t>1;return(0,l.logDebug)(`utils isIos >>>isIOSDevice: ${n}    >> isIPadOS: ${o}`),n||o}function W(e){const t=u.default.MD5(e).toString();return t.slice(-6)}function x(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function U(){return!0}function H(e){return t.chainName2IdMap.forEach(((t,n)=>{e.includes(n)&&(e=e.replace(n,t))})),e}function J(e){return t.chainName2IdMap.forEach(((t,n)=>{e.includes(t)&&(e=e.replace(t,n))})),e}function B(e){for(const[t,n]of Object.entries(g.NAMES_CHAINS))if(Object.values(n).includes(e))return t;return e}function V(e){if("undefined"===typeof window||"undefined"===typeof document)return;const t=[];function n(){const n=e();if(n)for(const e of t)e()}const o=setInterval(n,1e3);t.push((()=>clearInterval(o))),"loading"===document.readyState&&(document.addEventListener("DOMContentLoaded",n,{once:!0}),t.push((()=>document.removeEventListener("DOMContentLoaded",n)))),"complete"!==document.readyState&&(window.addEventListener("load",n,{once:!0}),t.push((()=>window.removeEventListener("load",n)))),n()}t.isValidObject=K,t.chainName2IdMap=new Map,t.chainName2IdMap.set("aptos:mainnet","aptos:637"),t.chainName2IdMap.set("movement:testnet","aptos:70000060"),t.chainName2IdMap.set("movement:mainnet","aptos:70000066"),t.chainName2IdMap.set("soon:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000069"),t.chainName2IdMap.set("soon:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","svm:70000067"),t.chainName2IdMap.set("eclipse:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000068"),t.chainName2IdMap.set("sonic:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000073")},8534:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.openLink=c,t.openLinkBlank=a,t.openDeeplinkWithFallback=l,t.isMobileUserAgent=d,t.getUserAgent=u,t.isOS=g,t.isBrowser=h;const i=o(n(6759)),r=n(9323),s=n(8294);function c(e,t="_self"){(0,r.logDebug)("openLink",e,t),window.open(e,t,"noopener noreferrer")}function a(e){c(e,"_blank")}function l(e,t){const n=()=>{h("safari")||g("android")&&h("firefox")||t()},o=setTimeout((()=>n()),500);window.addEventListener("blur",(()=>clearTimeout(o)),{once:!0}),g("android")&&(0,s.inTg)()?c(e,"_blank"):c(e,"_self")}function d(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.slice(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function u(){var e,t,n;const o=(new i.default).getResult(),r=null===(e=o.os.name)||void 0===e?void 0:e.toLowerCase(),s=null===(t=o.device.model)||void 0===t?void 0:t.toLowerCase();let c;switch(!0){case"ipad"===s:c="ipad";break;case"ios"===r:c="ios";break;case"android"===r:c="android";break;case"mac os"===r:c="macos";break;case"linux"===r:c="linux";break;case null===r||void 0===r?void 0:r.includes("windows"):c="windows";break}const a=null===(n=o.browser.name)||void 0===n?void 0:n.toLowerCase();let l;switch(!0){case"chrome"===a:l="chrome";break;case"firefox"===a:l="firefox";break;case null===a||void 0===a?void 0:a.includes("safari"):l="safari";break;case null===a||void 0===a?void 0:a.includes("opera"):l="opera";break}return{os:c,browser:l}}function g(...e){return e.includes(u().os)}function h(...e){return e.includes(u().browser)}},9507:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.toUserFriendlyAddress=t.removeUrlLastSlash=t.addPathToUrl=t.createVersionInfo=t.BrowserEventDispatcher=t.createTransactionSigningFailedEvent=t.createTransactionSignedEvent=t.createTransactionSentForSignatureEvent=t.createDisconnectionEvent=t.createConnectionStartedEvent=t.createConnectionRestoringStartedEvent=t.createConnectionRestoringErrorEvent=t.createConnectionRestoringCompletedEvent=t.createConnectionErrorEvent=t.createConnectionCompletedEvent=t.createResponseVersionEvent=t.createRequestVersionEvent=t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=t.OKXTonConnect=void 0;var r=n(662);Object.defineProperty(t,"OKXTonConnect",{enumerable:!0,get:function(){return r.OKXTonConnect}}),i(n(523),t);var s=n(7588);Object.defineProperty(t,"OKX_TON_CONNECTION_AND_TRANSACTION_EVENT",{enumerable:!0,get:function(){return s.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT}}),Object.defineProperty(t,"createRequestVersionEvent",{enumerable:!0,get:function(){return s.createRequestVersionEvent}}),Object.defineProperty(t,"createResponseVersionEvent",{enumerable:!0,get:function(){return s.createResponseVersionEvent}}),Object.defineProperty(t,"createConnectionCompletedEvent",{enumerable:!0,get:function(){return s.createConnectionCompletedEvent}}),Object.defineProperty(t,"createConnectionErrorEvent",{enumerable:!0,get:function(){return s.createConnectionErrorEvent}}),Object.defineProperty(t,"createConnectionRestoringCompletedEvent",{enumerable:!0,get:function(){return s.createConnectionRestoringCompletedEvent}}),Object.defineProperty(t,"createConnectionRestoringErrorEvent",{enumerable:!0,get:function(){return s.createConnectionRestoringErrorEvent}}),Object.defineProperty(t,"createConnectionRestoringStartedEvent",{enumerable:!0,get:function(){return s.createConnectionRestoringStartedEvent}}),Object.defineProperty(t,"createConnectionStartedEvent",{enumerable:!0,get:function(){return s.createConnectionStartedEvent}}),Object.defineProperty(t,"createDisconnectionEvent",{enumerable:!0,get:function(){return s.createDisconnectionEvent}}),Object.defineProperty(t,"createTransactionSentForSignatureEvent",{enumerable:!0,get:function(){return s.createTransactionSentForSignatureEvent}}),Object.defineProperty(t,"createTransactionSignedEvent",{enumerable:!0,get:function(){return s.createTransactionSignedEvent}}),Object.defineProperty(t,"createTransactionSigningFailedEvent",{enumerable:!0,get:function(){return s.createTransactionSigningFailedEvent}}),Object.defineProperty(t,"BrowserEventDispatcher",{enumerable:!0,get:function(){return s.BrowserEventDispatcher}}),Object.defineProperty(t,"createVersionInfo",{enumerable:!0,get:function(){return s.createVersionInfo}});var c=n(9325);Object.defineProperty(t,"addPathToUrl",{enumerable:!0,get:function(){return c.addPathToUrl}}),Object.defineProperty(t,"removeUrlLastSlash",{enumerable:!0,get:function(){return c.removeUrlLastSlash}}),Object.defineProperty(t,"toUserFriendlyAddress",{enumerable:!0,get:function(){return c.toUserFriendlyAddress}})},8519:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXTonConnectInner=void 0;const r=n(854),s=n(523),c=n(1213),a=n(8183),l=n(609),d=n(3281),u=n(7028);class g{constructor(e){if(this._wallet=null,this.provider=null,this.statusChangeSubscriptions=[],this.statusChangeErrorSubscriptions=[],this.openUniversalLink=!!this.provider&&this.provider.openUniversalLink,(0,s.checkMetaData)(e.metaData),!e.metaData)throw(0,s.logDebug)("OKXTonConnect constructor error: options.metaData is nil"),new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"dapp metaData can not be null");(0,s.logDebug)("OKXTonConnect constructor options:",JSON.stringify(e)),this.dappSettings={metaData:Object.assign(Object.assign({},e.metaData),{url:window.location.hostname,origin:window.location.origin})},e.connectors&&0!=e.connectors.length||(e.connectors=[new s.AppwalletConnector]),this.connectors=e.connectors,this.tracker=new a.TonConnectTracker({OKXtonConnectSdkVersion:u.OKXtonConnectSdkVersion}),this.storage=new s.Storage(u.OKXCONNECTOR_TON_KEY+this.dappSettings.metaData.name+u.OKXTON_STORAGE_PREFIX,u.OKXCONNECTOR_TON_KEY),this.bridgeConnectionStorage=new d.BridgeConnectionStorage(this.storage)}get connected(){return null!==this._wallet}get account(){var e;return(null===(e=this._wallet)||void 0===e?void 0:e.account)||null}get wallet(){return this._wallet}set wallet(e){this._wallet=e,this.statusChangeSubscriptions.forEach((e=>e(this._wallet)))}connect(e){return o(this,void 0,void 0,(function*(){var t;return(0,s.logDebug)("ton-Connect ==>> connect_1 >> request:",e),this.connected&&(0,s.logError)("It's already connected to OKX Wallet, please call disconnect() first"),yield null===(t=this.provider)||void 0===t?void 0:t.closeConnection(!1,!0),this.provider||(this.provider=new r.BridgeProvider(this.storage,this.dappSettings.metaData.name,this.connectors)),this.provider.listen(this.walletEventsListener.bind(this)),this.tracker.trackConnectionStarted(),yield this.provider.connect(this.createConnectRequest(e),null===e||void 0===e?void 0:e.redirect,null===e||void 0===e?void 0:e.openUniversalLink,null===e||void 0===e?void 0:e.tmaReturnUrl)}))}walletEventsListener(e){switch((0,s.logDebug)("ton-Connect ==>> walletEventsListener_1 >> e:",e),e.event){case"connect":this.onWalletConnected(e.payload);break;case"connect_error":this.onWalletConnectError(e.payload);break;case"disconnect":this.onWalletDisconnected("wallet")}}onWalletConnected(e){(0,s.logDebug)("ton-Connect ==>> onWalletConnected_1 >> connectEvent:",e);const t=e.items.find((e=>"ton_addr"===e.name)),n=e.items.find((e=>"ton_proof"===e.name));if(!t)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"ton_addr connection item was not found");const o={device:e.device,provider:this.provider.type,account:{address:t.address,chain:t.network,walletStateInit:t.walletStateInit,publicKey:t.publicKey}};n&&(o.connectItems={tonProof:n}),this.wallet=o,(0,s.logDebug)("ton-Connect ==>> onWalletConnected_2 >> wallet:",o),this.tracker.trackConnectionCompleted(o)}onWalletConnectError(e){var t;(0,s.logDebug)("ton-Connect ==>> onWalletConnectError_1 >> connectEventError:",e);const n=new s.OKXConnectError(e.code,e.message);(0,s.logDebug)("ton-Connect ==>> onWalletConnectError_1 >> error:",n),this.statusChangeErrorSubscriptions.forEach((e=>e(n))),this.tracker.trackConnectionError(null!==(t=e.message)&&void 0!==t?t:"",e.code)}onWalletDisconnected(e){this.tracker.trackDisconnection(this.wallet,e),this.wallet=null}disconnect(){return o(this,void 0,void 0,(function*(){var e;if((0,s.logDebug)("ton-Connect ==>> disconnect_1"),!this.connected)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,"wallet is not connected");(0,s.logDebug)("ton-Connect ==>> disconnect_222"),this.onWalletDisconnected("dapp"),yield null===(e=this.provider)||void 0===e?void 0:e.disconnect()}))}onStatusChange(e,t){return this.statusChangeSubscriptions.push(e),t&&this.statusChangeErrorSubscriptions.push(t),()=>{this.statusChangeSubscriptions=this.statusChangeSubscriptions.filter((t=>t!==e)),t&&(this.statusChangeErrorSubscriptions=this.statusChangeErrorSubscriptions.filter((e=>e!==t)))}}restoreConnection(){return o(this,void 0,void 0,(function*(){var e;(0,s.logDebug)("ton-Connect ==>> restoreConnection_1"),this.tracker.trackConnectionRestoringStarted();let t=null;try{t=yield r.BridgeProvider.fromStorage(this.storage,this.dappSettings.metaData.name,this.connectors)}catch(n){return this.tracker.trackConnectionRestoringError("Provider is not restored"),yield this.bridgeConnectionStorage.removeConnection(),null===t||void 0===t||t.closeConnection(),void(t=null)}if(!t)return(0,s.logError)("Provider is not restored"),void this.tracker.trackConnectionRestoringError("Provider is not restored");(0,s.logDebug)("ton-Connect ==>> restoreConnection_2 ==>> Provider is restored "),null===(e=this.provider)||void 0===e||e.closeConnection(!0,!1),this.provider=t,t.listen(this.walletEventsListener.bind(this)),yield this.provider.restoreConnection(),this.connected?this.tracker.trackConnectionRestoringCompleted(this.wallet):this.tracker.trackConnectionRestoringError("Connection restoring failed")}))}sendTransaction(e,t){return o(this,void 0,void 0,(function*(){var n;(0,s.logDebug)("ton-Connect ==>> sendTransaction_1",e),this.checkConnection(),(0,c.checkSendTransactionSupport)(this.wallet.device.features,{requiredMessagesNumber:e.messages.length}),this.tracker.trackTransactionSentForSignature(this.wallet,e),(0,s.logDebug)("ton-Connect ==>> sendTransaction_2 ==>> check params");const{validUntil:o}=e,r=i(e,["validUntil"]),a=e.from||this.account.address;let d=this.account.chain;(0,s.logDebug)("ton-Connect ==>> sendTransaction_2 ==>> await sendRequest",d),(0,s.isIos)()&&!(null===t||void 0===t?void 0:t.doNotOpenWallet)&&(null===(n=this.provider)||void 0===n||n.openOKXWallet());const u=yield this.provider.sendRequest(l.sendTransactionParser.convertToRpcRequest(Object.assign(Object.assign({},r),{valid_until:o,from:a,network:d})),{onRequestSent:()=>{var e,n;(0,s.isIos)()||(null===t||void 0===t?void 0:t.doNotOpenWallet)||null===(e=this.provider)||void 0===e||e.openOKXWallet(),null===(n=null===t||void 0===t?void 0:t.onRequestSent)||void 0===n||n.call(t)}});if((0,s.logDebug)("ton-Connect ==>> sendTransaction_3 ==>>sendRequest response:",u),l.sendTransactionParser.isError(u))throw this.tracker.trackTransactionSigningFailed(this.wallet,e,u.error.message,u.error.code),new s.OKXConnectError(u.error.code,u.error.message);const g=l.sendTransactionParser.convertFromRpcResponse(u);return this.tracker.trackTransactionSigned(this.wallet,e,g),g}))}checkConnection(){if((0,s.logDebug)("ton-Connect ==>> checkConnection"),!this.connected)throw new s.OKXConnectError(s.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,"Wallet not connected")}createConnectRequest(e){(0,s.logDebug)("ton-Connect ==>> createConnectRequest");const t={ton_addr:{name:"ton_addr"}};return(null===e||void 0===e?void 0:e.tonProof)&&(t.ton_proof={name:"ton_proof",payload:e.tonProof}),{dappInfo:this.dappSettings.metaData,params:t}}static getWallets(){return this.walletsList}}t.OKXTonConnectInner=g,g.walletsList=[(0,s.creatOKXWalletInfo)()]},662:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXTonConnect=void 0;const i=n(523),r=n(8519);class s{constructor(e){try{(0,i.logDebug)("OKXTonConnect constructor called"),window&&window.okxConnectTonsdkinwindow&&window.okxConnectTonsdkinwindow instanceof r.OKXTonConnectInner?(this.tonInner=window.okxConnectTonsdkinwindow,(0,i.logDebug)("OKXTonConnect constructor old called")):(this.tonInner=new r.OKXTonConnectInner(e),(0,i.logDebug)("OKXTonConnect constructor new called"),window&&(window.okxConnectTonsdkinwindow=this.tonInner))}catch(t){throw t}}get connected(){return this.tonInner.connected}get openUniversalLink(){return this.tonInner.openUniversalLink}get provider(){return this.tonInner.provider}get account(){return this.tonInner.account}get wallet(){return this.tonInner.wallet}set wallet(e){this.tonInner.wallet=e}connect(e){return o(this,void 0,void 0,(function*(){return this.tonInner.connect(e)}))}disconnect(){return o(this,void 0,void 0,(function*(){return this.tonInner.disconnect()}))}onStatusChange(e,t){return this.tonInner.onStatusChange(e,t)}restoreConnection(){return o(this,void 0,void 0,(function*(){return this.tonInner.restoreConnection()}))}sendTransaction(e,t){return o(this,void 0,void 0,(function*(){return this.tonInner.sendTransaction(e,t)}))}static getWallets(){return r.OKXTonConnectInner.getWallets()}}t.OKXTonConnect=s},9607:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RpcParser=void 0;class n{isError(e){return"error"in e}}t.RpcParser=n},609:function(e,t,n){"use strict";var o=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.sendTransactionParser=void 0;const i=n(9607);class r extends i.RpcParser{convertToRpcRequest(e){const{redirect:t}=e,n=o(e,["redirect"]);return{method:"ton_sendTransaction",redirect:t,params:n}}convertFromRpcResponse(e){return{boc:e.result.toString()}}}t.sendTransactionParser=new r},3281:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeConnectionStorage=void 0;const i=n(523);class r{constructor(e){this.storage=e,this.storeKey="ton_connect_info_adapter_universal"}storeConnection(e){return o(this,void 0,void 0,(function*(){return(0,i.logDebug)("BridgeConnectionStorage ==>> storeConnection ==>> connection:",e),this.storage.saveContent(JSON.stringify(e),this.storeKey)}))}removeConnection(){return o(this,void 0,void 0,(function*(){return(0,i.logDebug)("BridgeConnectionStorage ==>> removeConnection"),this.storage.clearCache(this.storeKey)}))}getConnection(){return o(this,void 0,void 0,(function*(){const e=this.storage.getItem(this.storeKey);if((0,i.logDebug)("BridgeConnectionStorage ==>> getConnection ==>>this.storage: ",this.storage),!e||!(null===e||void 0===e?void 0:e.content))return null;try{const t=null===e||void 0===e?void 0:e.content;if(t){let e;return e=JSON.parse(t),(0,i.logDebug)("BridgeConnectionStorage ==>> getConnection ==>>connection: ",e),e}return null}catch(t){return null}}))}getHttpConnection(){return o(this,void 0,void 0,(function*(){const e=yield this.getConnection();if(!e)throw new i.OKXConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Trying to read HTTP connection source while nothing is stored");return e}))}storeLastWalletEventId(e){return o(this,void 0,void 0,(function*(){const t=yield this.getConnection();if(t&&"connectEvent"in t)return t.lastWalletEventId=e,this.storeConnection(t)}))}getLastWalletEventId(){return o(this,void 0,void 0,(function*(){const e=yield this.getConnection();if(e&&"lastWalletEventId"in e)return e.lastWalletEventId}))}}t.BridgeConnectionStorage=r},854:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeProvider=void 0;const i=n(310),r=n(523),s=n(3281),c=n(7028),a=n(8183);class l{constructor(e,t=void 0,n){this.storage=e,this.type="http",this.listeners=[],this.walletConnectionSource={universalLink:r.standardUniversalLink},this.openUniversalLink=!1,this.engine=new r.Engine(t+c.OKXTON_STORAGE_PREFIX),this.engine.registerConnector(n),this.connectionStorage=new s.BridgeConnectionStorage(e),this.tracker=new a.TonConnectTracker({OKXtonConnectSdkVersion:c.OKXtonConnectSdkVersion}),(0,r.getDefaultReporter)().configVersionAndSide("tonsdk-1.5.2","dapp",t)}static fromStorage(e){return o(this,arguments,void 0,(function*(e,t=void 0,n){(0,r.logDebug)("bridge-provider ==>> fromStorage ==>>storage:",e),(0,r.reportLog)("bridge-provider ==>> fromStorage");const o=new s.BridgeConnectionStorage(e),c=yield o.getHttpConnection();if((0,i.isPendingConnectionHttp)(c))return null;const a=new l(e,t,n);return a.openUniversalLink=c.openUniversalLink,a}))}isCryptoEnable(){const e=this.engine.connectionManager.getCryptoKeyEnable();return e}connect(e,t,n,i){return o(this,void 0,void 0,(function*(){return(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>message:",e),(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>redirect:",t),(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>openUniversalLink:",n),(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>tmaReturnUrl:",i),(0,r.reportLog)("bridge-provider ==>> connect"),new Promise(((o,s)=>{try{this.openUniversalLink=n,void 0===this.openUniversalLink&&(this.openUniversalLink=(0,r.isMobileUserAgent)());let c={namespace:"ton",chains:["ton:-239"],params:e.params},a={name:"requestAccounts",requiredNamespaces:[c]},l=[];e.params.ton_addr&&l.push(e.params.ton_addr),e.params.ton_proof&&l.push(e.params.ton_proof),l.push(a);let d={dappInfo:e.dappInfo,openUniversalUrl:this.openUniversalLink,redirect:t,tmaReturnUrl:i};this.engine.universalConnect(l,d,(e=>{(0,r.logDebug)(`bridge-provider: connect: info>>>> ${JSON.stringify(e)}`);try{const{universalLink:t,deepLink:n}=(0,r.getOKXLink)(e.connectRequest);this.tracker.trackConnectionInfoBeforeJump(e),o(t)}catch(t){s(t)}})).then((e=>{(0,r.logDebug)(`bridge-provider: connect: success>>>> ${JSON.stringify(e)}`),this.connectSuccessHandle(e)})).catch((e=>{(0,r.logDebug)(`bridge-provider: connect: catch>>>> ${JSON.stringify(e)}`);const t={event:"connect_error",requestId:Number(Date.now()),payload:{code:e.code,message:e.message}};(0,r.logDebug)("bridge-provider ==>> connectListener_4 ==>>connect_error:",t),this.listeners.forEach((e=>e(t))),s(e)}))}catch(c){console.error("bridge-provider connect try catch error:>>>",JSON.stringify(c)),s(c)}}))}))}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter((t=>t!==e))}disconnectListener(){return o(this,void 0,void 0,(function*(){(0,r.logDebug)("bridge-provider ==>> disconnectListener"),(0,r.reportLog)("bridge-provider ==>> disconnectListener");const e={event:"disconnect",requestId:Number(1),payload:{}};this.listeners.forEach((t=>t(e))),yield this.closeConnection()}))}connectSuccessHandle(e){return o(this,void 0,void 0,(function*(){var t,n;try{const o=null===(t=e.namespaces)||void 0===t?void 0:t["ton"],i=o.payload,s=e.wallet;if(!o||!i||!s||!i.ton_addr)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);i.ton_addr;const c=e.sessionConfig;let a=[];i.ton_addr&&a.push(i.ton_addr),i.ton_proof&&a.push(i.ton_proof);const l={platform:s.platform,appName:s.appName,appVersion:s.appVersion,maxProtocolVersion:s.maxProtocolVersion,features:["ton_sendTransaction"]},d={type:"http",lastWalletEventId:Number(Date.now()),connectEvent:{event:"connect",payload:{items:a,device:l}},connectionSource:this.walletConnectionSource,channelId:e.topic,openUniversalLink:null===c||void 0===c?void 0:c.openUniversalUrl,dappInfo:null===c||void 0===c?void 0:c.dappInfo};(0,r.logDebug)("bridge-provider ==>> connectSuccessHandle_2 ==>>storeConnection:",d),yield this.connectionStorage.storeConnection(d),null===(n=this.engine)||void 0===n||n.addDisconnectListener(this.disconnectListener.bind(this));const u={event:"connect",requestId:d.lastWalletEventId,payload:d.connectEvent.payload};(0,r.logDebug)("bridge-provider ==>> connectSuccessHandle_3 ==>>listeners.forEach:",u),this.listeners.forEach((e=>e(u)))}catch(o){(0,r.logDebug)("bridge-provider ==>> connectSuccessHandle_4 ==>>error:",o);const e={event:"connect_error",requestId:Number(Date.now()),payload:{code:r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,message:"Connect success  connectSuccessHandle response error"}};(0,r.logDebug)("bridge-provider ==>> connectSuccessHandle_4 ==>>connect_error:",e),this.listeners.forEach((t=>t(e)))}}))}closeConnection(){return o(this,arguments,void 0,(function*(e=!1,t=!1){var n,o;(0,r.logDebug)("bridge-provider ==>> closeConnection ==>>fromRestore:",e," needOpenUrl:",t),(0,r.reportLog)("bridge-provider ==>> closeConnection"),this.listeners=[],t||(yield null===(n=this.engine)||void 0===n?void 0:n.connectManagerDisconnect(e)),e||(null===(o=this.engine)||void 0===o||o.clearData(),yield this.connectionStorage.removeConnection())}))}restoreConnection(){return o(this,void 0,void 0,(function*(){var e,t,n;(0,r.logDebug)("bridge-provider ==>> restoreConnection_1"),(0,r.reportLog)("bridge-provider ==>> restoreConnection");const o=yield this.connectionStorage.getHttpConnection();if((0,i.isPendingConnectionHttp)(o))return;const s=o.connectEvent.payload.device.appName,c=(0,r.getTagByappName)(s),a=c===r.OKX_INJECT_WALLET,l=this.engine.connectionManager.getCryptoKeyEnable();if(o&&(l||a))if((0,r.logDebug)("bridge-provider ==>> restoreConnection_2 ==>>storedConnection.channelId:",o.channelId),o.channelId)try{const i={event:"connect",requestId:Number(0),payload:o.connectEvent.payload};this.listeners.forEach((e=>e(i))),this.engine.setConnectConnector(o.connectEvent.payload.device);const s=o.channelId;(0,r.logDebug)("bridge-provider ==>> restoreConnection_3 ==>>this.engine.restoreConnect:",s),null===(e=this.engine)||void 0===e||e.addDisconnectListener(this.disconnectListener.bind(this)),yield this.engine.restoreconnectFromTopic(s),this.engine.deviceInfo=o.connectEvent.payload.device,(0,r.reportEvent)(r.OKXReportType.PAGE_IN,r.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,null!==(n=null===(t=this.engine.getConnector())||void 0===t?void 0:t.getTag())&&void 0!==n?n:"")}catch(d){(0,r.logDebug)("bridge-provider ==>> restoreConnection_4 ==>>closeConnection_1"),yield this.closeConnection()}else(0,r.logDebug)("bridge-provider ==>> restoreConnection_4 ==>>closeConnection_2"),yield this.closeConnection()}))}openOKXWallet(){(0,r.logDebug)("bridge-provider ==>> openOKXWallet",this.openUniversalLink),(0,r.reportLog)("bridge-provider ==>> openOKXWallet"),this.openUniversalLink&&(0,r.openOKXDeeplink)(r.standardDeeplink,r.shortUniversalLink,r.OpenAppLinkType.UniversalLink)}disconnect(){return o(this,void 0,void 0,(function*(){return(0,r.logDebug)("bridge-provider ==>> disconnect_1"),(0,r.reportLog)("bridge-provider ==>> disconnect"),new Promise((e=>o(this,void 0,void 0,(function*(){let t=!1;const n=()=>{t||(t=!0,this.closeConnection().then(e))};try{yield this.sendRequest({method:"disconnect"},{onRequestSent:n,attempts:1})}catch(o){t||this.closeConnection().then(e)}finally{n()}}))))}))}sendRequest(e,t,n){return(0,r.logDebug)("bridge-provider ==>> sendRequest"),(0,r.reportLog)("bridge-provider ==>> sendRequest"),new Promise(((i,s)=>o(this,void 0,void 0,(function*(){var o;try{yield null===(o=this.engine)||void 0===o?void 0:o.send(Object.assign(Object.assign({},e),{chainId:r.TON_CHAINS.MAINNET}),{resolve:function(e){i(e)},onAck:function(){var e;null===(e=null===t||void 0===t?void 0:t.onRequestSent)||void 0===e||e.call(t)}},n)}catch(c){s(c)}}))))}connectorOpenWallet(){this.engine.openWallet()}}t.BridgeProvider=l},310:function(e,t){"use strict";function n(e){return!("connectEvent"in e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPendingConnectionHttp=n},3267:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserEventDispatcher=void 0;class o{constructor(){this.window=window}dispatchEvent(e,t){return n(this,void 0,void 0,(function*(){var n;const o=new CustomEvent(e,{detail:t});null===(n=this.window)||void 0===n||n.dispatchEvent(o)}))}addEventListener(e,t,o){return n(this,void 0,void 0,(function*(){var n;return null===(n=this.window)||void 0===n||n.addEventListener(e,t,o),()=>{var n;return null===(n=this.window)||void 0===n?void 0:n.removeEventListener(e,t)}}))}}t.BrowserEventDispatcher=o},7588:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserEventDispatcher=t.createVersionInfo=t.createTransactionSigningFailedEvent=t.createTransactionSignedEvent=t.createTransactionSentForSignatureEvent=t.createDisconnectionEvent=t.createConnectionStartedEvent=t.createConnectionRestoringStartedEvent=t.createConnectionRestoringErrorEvent=t.createConnectionRestoringCompletedEvent=t.createConnectionErrorEvent=t.createConnectionCompletedEvent=t.createResponseVersionEvent=t.createRequestVersionEvent=t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=void 0;var o=n(8543);Object.defineProperty(t,"OKX_TON_CONNECTION_AND_TRANSACTION_EVENT",{enumerable:!0,get:function(){return o.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT}});var i=n(8593);Object.defineProperty(t,"createRequestVersionEvent",{enumerable:!0,get:function(){return i.createRequestVersionEvent}}),Object.defineProperty(t,"createResponseVersionEvent",{enumerable:!0,get:function(){return i.createResponseVersionEvent}}),Object.defineProperty(t,"createConnectionCompletedEvent",{enumerable:!0,get:function(){return i.createConnectionCompletedEvent}}),Object.defineProperty(t,"createConnectionErrorEvent",{enumerable:!0,get:function(){return i.createConnectionErrorEvent}}),Object.defineProperty(t,"createConnectionRestoringCompletedEvent",{enumerable:!0,get:function(){return i.createConnectionRestoringCompletedEvent}}),Object.defineProperty(t,"createConnectionRestoringErrorEvent",{enumerable:!0,get:function(){return i.createConnectionRestoringErrorEvent}}),Object.defineProperty(t,"createConnectionRestoringStartedEvent",{enumerable:!0,get:function(){return i.createConnectionRestoringStartedEvent}}),Object.defineProperty(t,"createConnectionStartedEvent",{enumerable:!0,get:function(){return i.createConnectionStartedEvent}}),Object.defineProperty(t,"createDisconnectionEvent",{enumerable:!0,get:function(){return i.createDisconnectionEvent}}),Object.defineProperty(t,"createTransactionSentForSignatureEvent",{enumerable:!0,get:function(){return i.createTransactionSentForSignatureEvent}}),Object.defineProperty(t,"createTransactionSignedEvent",{enumerable:!0,get:function(){return i.createTransactionSignedEvent}}),Object.defineProperty(t,"createTransactionSigningFailedEvent",{enumerable:!0,get:function(){return i.createTransactionSigningFailedEvent}}),Object.defineProperty(t,"createVersionInfo",{enumerable:!0,get:function(){return i.createVersionInfo}});var r=n(3267);Object.defineProperty(t,"BrowserEventDispatcher",{enumerable:!0,get:function(){return r.BrowserEventDispatcher}})},8183:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TonConnectTracker=void 0;const i=n(8593),r=n(3267);class s{get version(){return(0,i.createVersionInfo)({okx_ton_connect_sdk_lib:this.OKXtonConnectSdkVersion,okx_connect_ui_lib:this.OKXConnectUiVersion})}constructor(e){this.eventPrefix="okx-ton-connect-",this.OKXConnectUiVersion=null,this.eventDispatcher=new r.BrowserEventDispatcher,this.OKXtonConnectSdkVersion=e.OKXtonConnectSdkVersion,this.init().catch()}init(){return o(this,void 0,void 0,(function*(){try{yield this.setRequestVersionHandler(),this.OKXConnectUiVersion=yield this.requestTonConnectUiVersion()}catch(e){}}))}setRequestVersionHandler(){return o(this,void 0,void 0,(function*(){yield this.eventDispatcher.addEventListener("okx-ton-connect-request-version",(()=>o(this,void 0,void 0,(function*(){yield this.eventDispatcher.dispatchEvent("okx-ton-connect-response-version",(0,i.createResponseVersionEvent)(this.OKXtonConnectSdkVersion))}))))}))}requestTonConnectUiVersion(){return o(this,void 0,void 0,(function*(){return new Promise(((e,t)=>o(this,void 0,void 0,(function*(){try{yield this.eventDispatcher.addEventListener("okx-connect-ui-response-version",(t=>{e(t.detail.version)}),{once:!0}),yield this.eventDispatcher.dispatchEvent("okx-connect-ui-request-version",(0,i.createRequestVersionEvent)())}catch(n){t(n)}}))))}))}dispatchUserActionEvent(e){try{this.eventDispatcher.dispatchEvent(`${this.eventPrefix}${e.type}`,e).catch()}catch(t){}}trackConnectionStarted(...e){try{const t=(0,i.createConnectionStartedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionDeepLink(...e){try{const t=(0,i.createConnectionDeepLinkEvent)(...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionCompleted(...e){try{const t=(0,i.createConnectionCompletedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionInfoBeforeJump(e){try{const t=(0,i.createConnectionInfoBeforeJumpEvent)(e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionError(...e){try{const t=(0,i.createConnectionErrorEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringStarted(...e){try{const t=(0,i.createConnectionRestoringStartedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringCompleted(...e){try{const t=(0,i.createConnectionRestoringCompletedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringError(...e){try{const t=(0,i.createConnectionRestoringErrorEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackDisconnection(...e){try{const t=(0,i.createDisconnectionEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSentForSignature(...e){try{const t=(0,i.createTransactionSentForSignatureEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSigned(...e){try{const t=(0,i.createTransactionSignedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSigningFailed(...e){try{const t=(0,i.createTransactionSigningFailedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}}t.TonConnectTracker=s},8543:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=void 0,function(e){e["OKX_TON_CONNECTION_STARTED"]="okx-ton-connect-connection-started",e["OKX_TON_CONNECTION_COMPLETED"]="okx-ton-connect-connection-completed",e["OKX_TON_CONNECTION_ERROR"]="okx-ton-connect-connection-error",e["OKX_TON_CONNECTION_RESTORING_STARTED"]="okx-ton-connect-connection-restoring-started",e["OKX_TON_CONNECTION_RESTORING_COMPLETED"]="okx-ton-connect-connection-restoring-completed",e["OKX_TON_CONNECTION_RESTORING_ERROR"]="okx-ton-connect-connection-restoring-error",e["OKX_TON_DISCONNECTION"]="okx-ton-connect-disconnection",e["OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE"]="okx-ton-connect-transaction-sent-for-signature",e["OKX_TON_TRANSACTION_SIGNED"]="okx-ton-connect-transaction-signed",e["OKX_TON_TRANSACTION_SIGNING_FAILED"]="okx-ton-connect-transaction-signing-failed"}(n||(t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=n={}))},8593:function(e,t){"use strict";function n(){return{type:"request-version"}}function o(e){return{type:"response-version",version:e}}function i(e){return{okx_ton_connect_sdk_lib:e.okx_ton_connect_sdk_lib,okx_connect_ui_lib:e.okx_connect_ui_lib}}function r(e,t){var n,o,r,s,c,a,l,d;const u=(null===(n=null===t||void 0===t?void 0:t.connectItems)||void 0===n?void 0:n.tonProof)&&"proof"in t.connectItems.tonProof,g=u?"ton_proof":"ton_addr";return{wallet_address:null!==(r=null===(o=null===t||void 0===t?void 0:t.account)||void 0===o?void 0:o.address)&&void 0!==r?r:null,wallet_type:null!==(s=null===t||void 0===t?void 0:t.device.appName)&&void 0!==s?s:null,wallet_version:null!==(c=null===t||void 0===t?void 0:t.device.appVersion)&&void 0!==c?c:null,auth_type:g,custom_data:Object.assign({chain_id:null!==(l=null===(a=null===t||void 0===t?void 0:t.account)||void 0===a?void 0:a.chain)&&void 0!==l?l:null,provider:null!==(d=null===t||void 0===t?void 0:t.provider)&&void 0!==d?d:null},i(e))}}function s(e){return{type:"connection-started",custom_data:i(e)}}function c(e){return{type:"connection-get-deeplink",deeplinkUrl:e}}function a(e){return{type:"connection-info-before-jump",connectInfo:e}}function l(e,t){return Object.assign({type:"connection-completed",is_success:!0},r(e,t))}function d(e,t,n){return{type:"connection-error",is_success:!1,error_message:t,error_code:null!==n&&void 0!==n?n:null,custom_data:i(e)}}function u(e){return{type:"connection-restoring-started",custom_data:i(e)}}function g(e,t){return Object.assign({type:"connection-restoring-completed",is_success:!0},r(e,t))}function h(e,t){return{type:"connection-restoring-error",is_success:!1,error_message:t,custom_data:i(e)}}function p(e,t){var n,o,i,r;return{valid_until:null!==(n=String(t.validUntil))&&void 0!==n?n:null,from:null!==(r=null!==(o=t.from)&&void 0!==o?o:null===(i=null===e||void 0===e?void 0:e.account)||void 0===i?void 0:i.address)&&void 0!==r?r:null,messages:t.messages.map((e=>{var t,n;return{address:null!==(t=e.address)&&void 0!==t?t:null,amount:null!==(n=e.amount)&&void 0!==n?n:null}}))}}function f(e,t,n){return Object.assign(Object.assign({type:"transaction-sent-for-signature"},r(e,t)),p(t,n))}function O(e,t,n,o){return Object.assign(Object.assign({type:"transaction-signed",is_success:!0,signed_transaction:o.boc},r(e,t)),p(t,n))}function v(e,t,n,o,i){return Object.assign(Object.assign({type:"transaction-signing-failed",is_success:!1,error_message:o,error_code:null!==i&&void 0!==i?i:null},r(e,t)),p(t,n))}function _(e,t,n){return Object.assign({type:"disconnection",scope:n},r(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestVersionEvent=n,t.createResponseVersionEvent=o,t.createVersionInfo=i,t.createConnectionStartedEvent=s,t.createConnectionDeepLinkEvent=c,t.createConnectionInfoBeforeJumpEvent=a,t.createConnectionCompletedEvent=l,t.createConnectionErrorEvent=d,t.createConnectionRestoringStartedEvent=u,t.createConnectionRestoringCompletedEvent=g,t.createConnectionRestoringErrorEvent=h,t.createTransactionSentForSignatureEvent=f,t.createTransactionSignedEvent=O,t.createTransactionSigningFailedEvent=v,t.createDisconnectionEvent=_},505:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),Object.defineProperty(t,"__esModule",{value:!0}),t.toUserFriendlyAddress=s;const o=n(523),i=81,r=128;function s(e,t=!1){const{wc:n,hex:s}=c(e);let l=i;t&&(l|=r);const d=new Int8Array(34);d[0]=l,d[1]=n,d.set(s,2);const u=new Uint8Array(36);u.set(d),u.set(a(d),34);let g=(0,o.base64encode)(u,!1);return g.replace(/\+/g,"-").replace(/\//g,"_")}function c(e){if(!e.includes(":"))throw new Error(`Wrong address ${e}. Address must include ":".`);const t=e.split(":");if(2!==t.length)throw new Error(`Wrong address ${e}. Address must include ":" only once.`);const n=parseInt(t[0]);if(0!==n&&-1!==n)throw new Error(`Wrong address ${e}. WC must be eq 0 or -1, but ${n} received.`);const o=t[1];if(64!==(null===o||void 0===o?void 0:o.length))throw new Error(`Wrong address ${e}. Hex part must be 64bytes length, but ${null===o||void 0===o?void 0:o.length} received.`);return{wc:n,hex:d(o)}}function a(e){const t=4129;let n=0;const o=new Uint8Array(e.length+2);o.set(e);for(let i of o){let e=128;while(e>0)n<<=1,i&e&&(n+=1),e>>=1,n>65535&&(n&=65535,n^=t)}return new Uint8Array([Math.floor(n/256),n%256])}const l={};for(let u=0;u<=255;u++){let e=u.toString(16);e.length<2&&(e="0"+e),l[e]=u}function d(e){e=e.toLowerCase();const t=e.length;if(t%2!==0)throw new Error("Hex string must have length a multiple of 2: "+e);const n=t/2,o=new Uint8Array(n);for(let i=0;i<n;i++){const t=2*i,n=e.substring(t,t+2);if(!l.hasOwnProperty(n))throw new Error("Invalid hex character: "+n);o[i]=l[n]}return o}},7028:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXTON_STORAGE_PREFIX=t.OKXCONNECTOR_TON_KEY=t.OKXtonConnectSdkVersion=void 0,t.OKXtonConnectSdkVersion="1",t.OKXCONNECTOR_TON_KEY="OKXStorage_ctc",t.OKXTON_STORAGE_PREFIX="_okxton"},1213:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkSendTransactionSupport=i;const o=n(523);function i(e,t){const n=e.includes("ton_sendTransaction");if(!n)throw new o.OKXConnectError(o.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,"Wallet doesn't support SendTransaction feature.");if(4<t.requiredMessagesNumber)throw new o.OKXConnectError(o.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`Wallet is not able to handle such SendTransaction request. Max support messages number is 4, but ${t.requiredMessagesNumber} is required.`)}},9325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toUserFriendlyAddress=t.removeUrlLastSlash=t.addPathToUrl=void 0;var o=n(1980);Object.defineProperty(t,"addPathToUrl",{enumerable:!0,get:function(){return o.addPathToUrl}}),Object.defineProperty(t,"removeUrlLastSlash",{enumerable:!0,get:function(){return o.removeUrlLastSlash}});var i=n(505);Object.defineProperty(t,"toUserFriendlyAddress",{enumerable:!0,get:function(){return i.toUserFriendlyAddress}})},1980:function(e,t){"use strict";function n(e){return"/"===e.slice(-1)?e.slice(0,-1):e}function o(e,t){return n(e)+"/"+t}Object.defineProperty(t,"__esModule",{value:!0}),t.removeUrlLastSlash=n,t.addPathToUrl=o},9277:function(e,t,n){"use strict";var o=n(5130),i=n(2098),r=(n(4188),n(6768)),s=n(4232);const c={id:"app"};function a(e,t,n,i,a,l){const d=(0,r.g2)("el-header"),u=(0,r.g2)("el-col"),g=(0,r.g2)("el-row"),h=(0,r.g2)("el-card"),p=(0,r.g2)("el-checkbox"),f=(0,r.g2)("el-option"),O=(0,r.g2)("el-select"),v=(0,r.g2)("el-input"),_=(0,r.g2)("el-button"),C=(0,r.g2)("qrcode-vue"),E=(0,r.g2)("el-main"),y=(0,r.g2)("el-container");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",c,[(0,r.bF)(y,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.eW)("OKX Connect")]))),_:1}),(0,r.bF)(E,null,{default:(0,r.k6)((()=>[(0,r.bF)(h,{class:"wallet-info"},{header:(0,r.k6)((()=>t[13]||(t[13]=[(0,r.Lk)("div",null,"钱包信息",-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(g,{class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[t[14]||(t[14]=(0,r.Lk)("strong",null,"Wallet Address:",-1)),(0,r.eW)(" "+(0,s.v_)(l.getWalletAddress),1)])),_:1})])),_:1}),(0,r.bF)(g,{class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[t[15]||(t[15]=(0,r.Lk)("strong",null,"当前状态 :",-1)),(0,r.eW)(" "+(0,s.v_)(e.currentStatus),1)])),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{class:"wallet-actions"},{header:(0,r.k6)((()=>t[16]||(t[16]=[(0,r.Lk)("div",null,"钱包操作",-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(g,{class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(p,{modelValue:e.withUI,"onUpdate:modelValue":t[0]||(t[0]=t=>e.withUI=t),onChange:e.handleWithUI},{default:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.eW)("是否展示UI")]))),_:1},8,["modelValue","onChange"])])),_:1})])),_:1}),(0,r.bF)(g,{style:{"align-items":"center","justify-content":"space-between"}},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:4,style:{gap:"2px"}},{default:(0,r.k6)((()=>t[18]||(t[18]=[(0,r.Lk)("p",{style:{"font-size":"11pt",margin:"0px"}},"Return Strategy",-1),(0,r.Lk)("p",{style:{"font-size":"9pt",margin:"0px"}},"(Mobile only)",-1)]))),_:1}),(0,r.bF)(u,{span:10},{default:(0,r.k6)((()=>[(0,r.bF)(O,{modelValue:e.returnStrategy,"onUpdate:modelValue":t[1]||(t[1]=t=>e.returnStrategy=t),onChange:l.handleReturnStrategySelect,placeholder:"Return Strategy"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.returnStrategies,(e=>((0,r.uX)(),(0,r.Wv)(f,{key:`return-strategy-select-option-${e}`,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,r.bF)(u,{span:10},{default:(0,r.k6)((()=>["deeplink"===e.returnStrategy?((0,r.uX)(),(0,r.Wv)(v,{key:0,modelValue:e.deeplink,"onUpdate:modelValue":t[2]||(t[2]=t=>e.deeplink=t),onChange:l.handleReturnStrategyDeeplink,placeholder:"Deeplink",disabled:"deeplink"!==e.returnStrategy,style:{margin:"0px"}},null,8,["modelValue","onChange","disabled"])):(0,r.Q3)("",!0)])),_:1})])),_:1}),(0,r.bF)(g,{gutter:12},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.testProofPayload,"onUpdate:modelValue":t[3]||(t[3]=t=>e.testProofPayload=t),placeholder:"proofPayload"},null,8,["modelValue"])])),_:1})])),_:1}),e.showVerifyRow?((0,r.uX)(),(0,r.Wv)(g,{key:0,class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[t[19]||(t[19]=(0,r.Lk)("strong",null,"签名验证:",-1)),(0,r.eW)(" "+(0,s.v_)(e.ProofPayloadVerify),1)])),_:1})])),_:1})):(0,r.Q3)("",!0),(0,r.bF)(g,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"warning",onClick:l.walletInit,icon:"el-icon-refresh-right"},{default:(0,r.k6)((()=>t[20]||(t[20]=[(0,r.eW)("钱包初始化")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,r.bF)(g,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"primary",onClick:l.connectBtnClicked,icon:"el-icon-connection"},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(e.connectStatusStr),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[e.showModal?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:t[6]||(t[6]=(...e)=>l.closeModal&&l.closeModal(...e))},[(0,r.Lk)("div",{class:"modal-content",onClick:t[5]||(t[5]=(0,o.D$)((()=>{}),["stop"]))},[(0,r.Lk)("button",{class:"close-button",onClick:t[4]||(t[4]=(...e)=>l.closeModal&&l.closeModal(...e))},"×"),t[21]||(t[21]=(0,r.Lk)("h2",null,"扫描二维码",-1)),(0,r.bF)(C,{value:e.qrValue,size:200,level:"H"},null,8,["value"])])])):(0,r.Q3)("",!0)])),(0,r.bF)(g,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"warning",onClick:l.resotreConnectAction,icon:"el-icon-refresh-right"},{default:(0,r.k6)((()=>t[22]||(t[22]=[(0,r.eW)("尝试重连")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,r.bF)(g,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"danger",onClick:l.disconnectAction,icon:"el-icon-switch-button",disabled:0==e.walletAddress.length},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(e.disconnectStatusStr),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{class:"transaction"},{header:(0,r.k6)((()=>t[23]||(t[23]=[(0,r.Lk)("div",null,"交易",-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(g,{gutter:12},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:8},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"primary",onClick:t[7]||(t[7]=e=>l.mockSwap())},{default:(0,r.k6)((()=>t[24]||(t[24]=[(0,r.eW)("swap")]))),_:1})])),_:1}),(0,r.bF)(u,{span:8},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"success",onClick:t[8]||(t[8]=e=>l.mockTransaction())},{default:(0,r.k6)((()=>t[25]||(t[25]=[(0,r.eW)("转账")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(u,{xs:24,sm:12},{default:(0,r.k6)((()=>[t[26]||(t[26]=(0,r.Lk)("div",{class:"input-label"},"交易数据:",-1)),(0,r.bF)(v,{modelValue:e.testTransaction,"onUpdate:modelValue":t[9]||(t[9]=t=>e.testTransaction=t),placeholder:"sendTransactions"},null,8,["modelValue"])])),_:1}),(0,r.bF)(u,{xs:24,sm:12},{default:(0,r.k6)((()=>[t[27]||(t[27]=(0,r.Lk)("div",{class:"input-label"},"签名结果 :",-1)),(0,r.bF)(v,{modelValue:e.testboc,"onUpdate:modelValue":t[10]||(t[10]=t=>e.testboc=t),placeholder:"boc"},null,8,["modelValue"])])),_:1}),(0,r.bF)(g,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(_,{type:"primary",onClick:t[11]||(t[11]=e=>l.sendTransaction())},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(e.testTransactionStr),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})]),t[28]||(t[28]=(0,r.Lk)("div",{id:"button-root"},null,-1))],64)}var l=n(9507),d=n(7805),u=n(9877),g="none",h="tg://resolve",p="en_US",f=d.THEME.LIGHT,O={name:"App",components:{QrcodeVue:u.Ay},data:()=>({testTopic:"",testPublicKey:"",testProofPayload:"",pendingDeepLink:"-",logList:[],connectReady:!1,connectStatusStr:"连接钱包",disconnectStatusStr:"断开钱包",localPubKey:"",localSecKey:"",testTransaction:"",testTransactionStr:"发送交易",walletAddress:"",testboc:"",ProofPayloadVerify:"",showModal:!1,showVerifyRow:!1,qrValue:"https://www.okx.com/download",currentStatus:"",language:p,theme:f,THEME:d.THEME,withUI:"true"==localStorage.getItem("autoRefresh"),returnStrategies:["none","back","deeplink"],returnStrategy:g,deeplink:h,handleWithUI:e=>{localStorage.setItem("autoRefresh",`${e}`),location.reload()}}),computed:{getWalletAddress:function(){return this.walletAddress}},methods:{async connectBtnClicked(){console.log(`encryptStoreMsg   connectBtnClicked  ${Date.now()}`),this.testTonSdk()},async disconnectAction(){try{console.log("get disconnect wallet btn clicked"),await window.provider.disconnect()}catch(e){console.log("Disconnect  error ==>> ",e.message),this.currentStatus=e.message}},async walletInit(){var e;this.withUI?(console.log("---init wallet UI--"),e=new d.OKXTonConnectUI({dappMetaData:{name:"OKX TON Connect Demo",icon:"https://avatars.githubusercontent.com/u/37784886",manifestUrl:"https://app.ston.fi/tonconnect-manifest.json"},actionsConfiguration:{returnStrategy:"tg://resolve",tmaReturnUrl:"back",modals:"all"},uiPreferences:{theme:d.THEME.LIGHT},buttonRootId:"button-root",language:"en_US"})):(console.log("---init wallet---"),e=new l.OKXTonConnect({metaData:{name:"OKX TON Connect Demo",icon:"https://avatars.githubusercontent.com/u/37784886"}})),window.tonTest=e},async resotreConnectAction(){console.log("get restore wallet btn clicked"),window.provider.restoreConnection()},async mockSwap(){var e={messages:[{address:"EQARULUYsmJq1RiZ-YiH-IJLcAZUVkVff-KBPwEmmaQGH6aC",amount:"205000000",payload:"te6cckEBAgEAhwABbQ+KfqUAAADNgG7tIEATEtAIAO87mQKicbKgHIk4pSPP4k5xhHqutqYgAB7USnesDnCcECwbgQMBAJUlk4VhgBD3JEg1TUr75iTijBghOKm/sxNDXUBl7CD6WMut0Q85x4RafwA/Es89DBXoTxuqxVFxyBbzt9Rav2HBUKl7hmkvLuKHLBCW57aK"}],validUntil:1792481054,network:-239};this.testTransaction=JSON.stringify(e)},async mockTransaction(){let e=window.provider.account,t=e.address;var n={messages:[{address:"UQDXlIPZgiC7ugBqdg68ZQ4zBVGaTEfTQd1ywCDB8exACtQK",amount:11e5}],valid_until:1792481054,from:t,network:"-239"};this.testTransaction=JSON.stringify(n)},async mockTransactionNFT(){var e={from:"EQD8Szz0MFehPG6rFUXHIFvO31Fq_YcFQqXuGaS8u4ocsMqN",messages:[{address:"EQBpDpRrE3b4g01AXoyCQbnUGTpVCCgCBGyTPWvKvwDyQKqZ",amount:"20000000",payload:"te6cckEBAQEAUwAAoV/MPRQAAAAAAAAAAIAa8pB7MEQXd0ANTsHXjKHGYKozSYj6aDuuWAQYPj2IAVAD8Szz0MFehPG6rFUXHIFvO31Fq/YcFQqXuGaS8u4ocsAgKGBCo0E="}],valid_until:1792481054,network:"-239"};this.testTransaction=JSON.stringify(e)},async sendTransaction(){if(console.log("sendTransaction"),console.log("sendTransaction内容------",this.testTransaction),this.testTransaction){const n=JSON.parse(this.testTransaction);try{var e=await window.provider.sendTransaction(n);this.testboc=e.boc}catch(t){t.code===l.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR?this.testboc="用户拒绝交易":this.testboc="签名错误！"}}else alert("交易数据为空，请选则或输入交易数据。")},async testTonSdk(){if(window.provider.connected)console.log("you have connected wallet");else{console.log("APP ---connect Proof---\x3e>>>----",this.testProofPayload);let e={tonProof:this.testProofPayload,redirect:"tg://resolve",tmaReturnUrl:"tg://resolve"};this.isPC(),!this.isSafariOrChrome()||window?.TelegramWebview||window?.TelegramWebviewProxy||(e.redirect=null),console.log("Is Mobile ==>",e),window.provider instanceof d.OKXTonConnectUI?(this.testProofPayload&&window.provider.setConnectRequestParameters({state:"ready",value:{tonProof:this.testProofPayload}}),await window.provider.openModal().catch((e=>console.error("发生了错误：",e)))):window.provider instanceof l.OKXTonConnect&&window.provider.connect(e).then((e=>{console.log("Current Url ---:",e),e&&this.isPC()&&(this.qrValue=e,this.showModal=!0)}))}},closeModal(){this.showModal=!1},isPC(){const e=navigator.userAgent;console.log("current device ua is ===>",e);const t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let n=!0;for(let o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=!1;break}return n},isSafariOrChrome(){const e=navigator.userAgent,t=["Safari","Chrome"];let n=!1;for(let o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=!0;break}return n},handleReturnStrategySelect(e){console.log("handleReturnStrat",window.provider),g="deeplink"===e?this.deeplink:e,this.withUI&&(window.provider.uiOptions={actionsConfiguration:{returnStrategy:g,modals:"all"},buttonRootId:"button-root"})},handleReturnStrategyDeeplink(e){console.log(window.provider),g=e,this.withUI&&(window.provider.uiOptions={actionsConfiguration:{returnStrategy:e,modals:"all"},buttonRootId:"button-root"})}},created(){for(const e of Object.values(l.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT))console.log(e),window.addEventListener(e,(t=>{console.log(e,t.detail),this.currentStatus=e}));window.addEventListener("okx-ton-connect-connection-info-before-jump",(e=>{console.log("链接详情   :::",e.detail)}))},mounted(){var e,t=document.createElement("script");t.src="https://telegram.org/js/telegram-web-app.js",t.id="tgsdk",document.getElementsByTagName("head")[0].appendChild(t),window.okxLogDebug=!0,this.connectReady=!0,document.title="OKX Connect TON",this.withUI?(console.log("---init wallet UI--"),e=new d.OKXTonConnectUI({dappMetaData:{name:"OKX TON Connect Demo",icon:"https://avatars.githubusercontent.com/u/37784886",manifestUrl:"https://app.ston.fi/tonconnect-manifest.json"},actionsConfiguration:{returnStrategy:"tg://resolve",tmaReturnUrl:"back",modals:"all"},uiPreferences:{theme:d.THEME.LIGHT},buttonRootId:"button-root",language:"en_US"})):(console.log("---init wallet------"),e=new l.OKXTonConnect({metaData:{name:"OKX TON Connect Demo",icon:"https://avatars.githubusercontent.com/u/37784886"}})),window.provider=e,window.provider.onStatusChange((e=>{if(console.log("APP ---TON.onStatusChange>>----",e),e){if(this.walletAddress=e.account.address,this.testProofPayload){var t={address:this.walletAddress,network:e.account.chain,public_key:e.account.publicKey,proof:{...e.connectItems.tonProof.proof,state_init:e.account.walletStateInit}};console.log(`checkProof => ${JSON.stringify(t)}`)}else this.ProofPayloadVerify=": no proof";this.showModal=!1}else this.walletAddress="disconnected"}),(e=>{this.showModal=!1,e.code===l.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR?this.walletAddress=`用户拒绝链接: code(${e.code}) `:this.walletAddress=`链接报错: code(${e.code})  ${e.message}`}))}},v=n(1241);const _=(0,v.A)(O,[["render",a],["__scopeId","data-v-aad3e5d2"]]);var C=_;const E=(0,o.Ef)(C);E.use(i.A),E.mount("#app")},8730:function(){},8103:function(){},515:function(){},3636:function(e){"use strict";e.exports=JSON.parse('{"name":"@okxconnect/core","version":"1.8.6","description":"OKX Connect core","main":"./src/index.js","keywords":["OKXConnect","OKX Connect"],"scripts":{"build":"npx tsc","local":"yarn install && npx tsc","remove":"rm -rf ./src  && rm -rf ./node_modules"},"author":"OKX Wallet","license":"MIT","dependencies":{"@stablelib/ed25519":"^1.0.2","@stablelib/random":"^1.0.1","@stablelib/sha256":"1.0.1","bs58":"^5.0.0","core-js":"2.6.12","cross-fetch":"^4.0.0","crypto-js":"^4.2.0","eventemitter3":"^5.0.1","isutf8":"^4.0.0","localforage":"^1.10.0","multiformats":"9.4.2","process":"^0.11.10","tweetnacl":"^1.0.3","tweetnacl-util":"^0.15.1","ua-parser-js":"^1.0.35","uint8arrays":"3.1.0","@wallet-standard/core":"^1.1.0"},"devDependencies":{"@types/crypto-js":"^4.2.2","@types/ua-parser-js":"^0.7.36","assert":"^2.1.0","eslint":"^9.7.0","events":"^3.3.0","jest":"^29.7.0","ts-loader":"^9.5.1","typescript":"^5.5.2"}}')}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){n.amdO={}}(),function(){var e=[];n.O=function(t,o,i,r){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],i=e[d][1],r=e[d][2];for(var c=!0,a=0;a<o.length;a++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](o[a])}))?o.splice(a--,1):(c=!1,r<s&&(s=r));if(c){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,i,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,r,s=o[0],c=o[1],a=o[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(i in c)n.o(c,i)&&(n.m[i]=c[i]);if(a)var d=a(n)}for(t&&t(o);l<s.length;l++)r=s[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},o=self["webpackChunkokxconnectdemo"]=self["webpackChunkokxconnectdemo"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(9277)}));o=n.O(o)})();
//# sourceMappingURL=app.fae367c0.js.map